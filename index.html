<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Nexus Prime Security - V6.1 (Freemium s Trvalou Registrac√≠)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* --- CSS STYLING (Vƒõt≈°ina z V5.0/V5.1) --- */
        :root {
            --color-dark-bg: #1e1e2c; 
            --color-darker-bg: #151520; 
            --color-accent-blue: #007bff; 
            --color-accent-green: #28a745; 
            --color-danger-red: #dc3545;
            --color-warning-yellow: #ffc107;
            --color-text-light: #f0f0f5;
            --color-text-grey: #a0a0b0;
            --color-border: #303040;
        }

        body {
            background-color: var(--color-darker-bg); 
            color: var(--color-text-light);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #app-window {
            width: 400px; 
            height: 700px; 
            background-color: var(--color-dark-bg);
            border-radius: 25px; 
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 0 10px #000; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* HLAVIƒåKA S PROFILOV√ùM TLAƒå√çTKEM A STATUSEM */
        #header {
            background-color: var(--color-darker-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            color: var(--color-text-light);
            font-size: 1.4em;
            font-weight: 700;
        }
        #profile-btn {
            background: none;
            border: none;
            color: var(--color-accent-blue);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        #profile-btn:hover { background-color: #2a2a3b; }
        
        #user-info-status {
             text-align: right;
             font-size: 0.8em;
             margin-right: 10px;
        }
        .status-inactive { color: var(--color-danger-red); } 
        .status-active { color: var(--color-accent-green); font-weight: bold; } 

        /* OBSAHOV√Å OBLAST */
        #content-area {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto; 
            padding-bottom: 80px; 
        }
        .module { animation: fadeIn 0.5s; }
        .module.hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { color: var(--color-text-light); border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 20px; font-weight: 500; font-size: 1.4em;}
        h3 { font-size: 1.1em; }
        
        .primary-btn, .secondary-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%; 
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        .primary-btn {
            background-color: var(--color-accent-blue);
            color: white;
            font-size: 1.1em;
            margin-top: 15px;
        }
        .secondary-btn {
            background-color: var(--color-border);
            color: var(--color-text-light);
            margin-top: 15px;
        }
        
        /* Formul√°≈ôe a inputy */
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            background-color: #2a2a3b;
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        /* Modul pro v√Ωbƒõr P≈ôihl√°≈°en√≠/Registrace */
        #auth_select {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
        }
        #auth_select .primary-btn, #auth_select .secondary-btn {
            width: 80%;
            max-width: 300px;
        }
        
        /* Ostatn√≠ styly pro moduly - stejn√© jako V5.1 */
        #security-score-card {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

    </style>
</head>
<body>

    <div id="app-window">
        <header id="header">
             <h1 class="logo">Nexus Prime Security</h1>
             <div id="user-info-status">
                 <span id="header-username">Odhl√°≈°eno</span><br>
                 <span id="header-license-status" class="status-inactive">Neaktivn√≠</span>
             </div>
             <button id="profile-btn" style="font-style: normal;">
                üë§
             </button>
        </header>

        <main id="content-area">
            
            <div id="auth_select" class="module hidden">
                <h2 style="border: none;">V√≠tejte v Nexus Prime</h2>
                <p style="color: var(--color-text-grey); margin-bottom: 40px;">Pro pokraƒçov√°n√≠ se p≈ôihlaste nebo vytvo≈ôte √∫ƒçet.</p>
                <button id="show-login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                <button id="show-register-btn" class="secondary-btn">Vytvo≈ôit √öƒçet</button>
            </div>

            <div id="dashboard" class="module hidden">
                </div>
            
            <div id="login" class="module hidden">
                <h2>üë§ P≈ôihl√°≈°en√≠ do aplikace</h2>
                <p id="login-message" style="margin-bottom: 20px; color: var(--color-text-grey);">P≈ôihlaste se pros√≠m pro p≈ô√≠stup k funkc√≠m.</p>
                <div id="login-form">
                    <input type="text" id="login-username" placeholder="U≈æivatelsk√© jm√©no">
                    <input type="password" id="login-password" placeholder="Heslo">
                    <button id="login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                    <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                </div>
            </div>
            
            <div id="register" class="module hidden">
                 <h2>üîë Vytvo≈ôit √öƒçet</h2>
                 <p style="margin-bottom: 20px;">Vytvo≈ôte si √∫ƒçet pro z√°kladn√≠ ochranu a skenov√°n√≠.</p>
                 <div id="register-form">
                     <input type="text" id="reg-username" placeholder="U≈æivatelsk√© jm√©no">
                     <input type="password" id="reg-password" placeholder="Heslo">
                     <button id="register-btn" class="primary-btn">Vytvo≈ôit √öƒçet a P≈ôihl√°sit se</button>
                     <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                 </div>
            </div>
            
            <div id="paysafe" class="module hidden">
                <h2>üí≥ Aktivace PRO Verze</h2>
                <div id="paysafe-payment-box" style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    <h4>Nexus PRO (Roƒçn√≠ licence): <span style="color: var(--color-accent-blue);">7 999 Kƒç</span></h4>
                    <div id="paysafe-status-bar" style="padding: 15px; background-color: #151520; border-radius: 8px; font-size: 1.2em; font-weight: bold; margin-bottom: 20px;">
                        Zb√Ωvaj√≠c√≠ ƒç√°stka k √∫hradƒõ: <span id="remaining-amount" class="text-remaining">7 999 Kƒç</span>
                    </div>
                    <div class="paysafe-input-area">
                        <input type="text" id="paysafe-pin-input" placeholder="Zadejte 16m√≠stn√Ω PIN Paysafecard" maxlength="16">
                        <button id="submit-pin-btn" class="primary-btn">Ovƒõ≈ôit PIN</button>
                    </div>
                    <div id="transaction-log"><p>Log transakc√≠:</p></div>
                </div>
            </div>
            
            <div id="scan" class="module hidden">
                <h2>üöÄ Chytr√Ω Sken</h2>
                <div id="scan-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="cyber_defense" class="module hidden">
                 <h2>üõ°Ô∏è Kybernetick√° Obrana</h2>
                 <div id="cyber-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="vpn" class="module hidden">
                <h2>üîí VPN Prime</h2>
                <div id="vpn-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="identity" class="module hidden">
                 <h2>üïµÔ∏è Identity Guard</h2>
                <div id="identity-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="settings" class="module hidden">
                <h2>‚öôÔ∏è Nastaven√≠</h2>
                <div class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>

        </main>
        
        <nav id="bottom-nav">
            <a href="#" class="nav-item active" data-module="dashboard" id="dashboard-nav">
                <i style="font-style: normal;">üè†</i> Home
            </a>
            <a href="#" class="nav-item" data-module="scan" id="scan-nav">
                <i style="font-style: normal;">‚ú®</i> Sken
            </a>
            <a href="#" class="nav-item locked" data-module="cyber_defense" id="cyber-nav">
                <i style="font-style: normal;">üîí</i> Obrana
            </a>
            <a href="#" class="nav-item locked" data-module="vpn" id="vpn-nav">
                <i style="font-style: normal;">üîí</i> VPN
            </a>
             <a href="#" class="nav-item locked" data-module="settings" id="settings-nav">
                <i style="font-style: normal;">üîí</i> Nastaven√≠
            </a>
        </nav>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIKA --- */
        const CURRENT_USER_KEY = 'nexusPrimeCurrentUser';
        const REGISTERED_USERS_KEY = 'nexusPrimeRegisteredUsers';
        const PRO_PRICE = 7999;
        
        // --- GLOB√ÅLN√ç STAV ---
        let currentUser = null;
        
        // P≈òESN√Å LOGIKA PIN≈Æ: 3610 + 3610 + 779 = 7999
        const SIMULATED_PIN_VALUES = [3610, 3610, 779]; 

        // --- POMOCN√â FUNKCE A TRVALOST DAT ---
        
        const getRegisteredUsers = () => {
             const users = localStorage.getItem(REGISTERED_USERS_KEY);
             return users ? JSON.parse(users) : {};
        };
        
        const saveRegisteredUsers = (users) => {
             localStorage.setItem(REGISTERED_USERS_KEY, JSON.stringify(users));
        };
        
        const saveCurrentUserState = () => {
             if (currentUser) {
                 localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
             }
        };

        const loadCurrentUserState = () => {
            const stored = localStorage.getItem(CURRENT_USER_KEY);
            if (stored) {
                currentUser = JSON.parse(stored);
                // Nastaven√≠ admin √∫ƒçtu
                 if (currentUser.username === 'Va≈°ek' && currentUser.password === 'vasek11') {
                     currentUser.isPaid = true;
                     currentUser.remainingAmount = 0;
                     currentUser.pinIndex = SIMULATED_PIN_VALUES.length;
                 }
                return true;
            }
            return false;
        };

        const switchModule = (moduleId) => {
            // Kontrola p≈ôihl√°≈°en√≠
            if (!currentUser && moduleId !== 'auth_select' && moduleId !== 'login' && moduleId !== 'register') {
                alert('Mus√≠te se nejprve p≈ôihl√°sit.');
                moduleId = 'auth_select';
            }
            
            // Zobrazen√≠/skryt√≠ modul≈Ø
            modules.forEach(m => m.classList.add('hidden'));
            document.getElementById(moduleId).classList.remove('hidden');

            // Aktualizace navigace
            navItems.forEach(i => i.classList.remove('active'));
            if (moduleId === 'dashboard' || moduleId === 'paysafe' || moduleId === 'auth_select' || moduleId === 'login' || moduleId === 'register') {
                document.getElementById('dashboard-nav').classList.add('active'); 
            } else {
                const activeNav = document.querySelector(`.nav-item[data-module="${moduleId}"]`);
                if (activeNav) activeNav.classList.add('active');
            }
        };

        // --- HANDLERY PRO REGISTRACI A P≈òIHL√Å≈†EN√ç ---
        
        const handleRegister = () => {
            const regUsername = document.getElementById('reg-username').value.trim();
            const regPassword = document.getElementById('reg-password').value.trim();
            const users = getRegisteredUsers();

            if (regUsername.length < 3 || regPassword.length < 5) {
                alert('Pros√≠m, zadejte platn√© u≈æivatelsk√© jm√©no (min 3 znaky) a heslo (min 5 znak≈Ø).');
                return;
            }
            if (users[regUsername]) {
                 alert(`U≈æivatelsk√© jm√©no "${regUsername}" je ji≈æ obsazeno.`);
                 return;
            }
            
            // Registrace nov√©ho Freemium u≈æivatele
            const newUser = {
                username: regUsername,
                password: regPassword, 
                isPaid: false,
                remainingAmount: PRO_PRICE,
                pinIndex: 0
            };
            
            users[regUsername] = newUser;
            saveRegisteredUsers(users);

            currentUser = newUser;
            saveCurrentUserState();
            
            unlockFeaturesUI('Freemium', `V√≠tejte, ${regUsername}! V√°≈° √∫ƒçet byl vytvo≈ôen.`, 'dashboard');
        };
        
        const handleLogin = () => {
            const loginUsername = document.getElementById('login-username').value.trim();
            const loginPassword = document.getElementById('login-password').value.trim();
            const users = getRegisteredUsers();
            
            // 1. Tajn√Ω PRO √∫ƒçet (ADMIN)
            if (loginUsername === 'Va≈°ek' && loginPassword === 'vasek11') {
                 currentUser = {
                    username: 'Va≈°ek',
                    password: 'vasek11',
                    isPaid: true,
                    remainingAmount: 0,
                    pinIndex: SIMULATED_PIN_VALUES.length
                };
                saveCurrentUserState();
                unlockFeaturesUI('PRO', `V√≠tejte zpƒõt, ${currentUser.username}! PRO verze je automaticky aktivov√°na.`, 'dashboard');
                return;
            }

            // 2. Norm√°ln√≠ ulo≈æen√Ω √∫ƒçet
            const storedUser = users[loginUsername];
            if (storedUser && storedUser.password === loginPassword) {
                 currentUser = storedUser;
                 saveCurrentUserState();
                 const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                 unlockFeaturesUI(licenseType, `V√≠tejte zpƒõt, ${currentUser.username}!`, 'dashboard');
                 return;
            }

            // 3. Chyba
            document.getElementById('login-message').innerText = 'Chyba: Neplatn√© u≈æivatelsk√© jm√©no nebo heslo.';
            document.getElementById('login-message').style.color = 'var(--color-danger-red)';
        };

        const handleLogout = () => {
             currentUser = null;
             localStorage.removeItem(CURRENT_USER_KEY);
             
             // Reset UI a p≈ôechod na p≈ôihl√°≈°en√≠
             document.getElementById('header-username').innerText = 'Odhl√°≈°eno';
             document.getElementById('header-license-status').innerText = 'Neaktivn√≠';
             document.getElementById('header-license-status').classList.remove('status-active');
             document.getElementById('header-license-status').classList.add('status-inactive');
             
             // Reset navigaƒçn√≠ch prvk≈Ø
             navItems.forEach(nav => {
                 const navModule = nav.getAttribute('data-module');
                 if (navModule !== 'dashboard' && navModule !== 'scan') {
                    nav.classList.add('locked');
                    nav.querySelector('i').innerHTML = 'üîí';
                 }
             });
             
             // Vyƒçi≈°tƒõn√≠ dashboardu
             document.getElementById('dashboard').innerHTML = '';
             switchModule('auth_select');
        };

        // --- LOGIKA PLATEBN√ç SIMULACE ---
        
        const updateRemainingDisplay = () => {
             const remainingAmountSpan = document.getElementById('remaining-amount');
             if (!remainingAmountSpan) return; // M≈Ø≈æe b√Ωt, pokud u≈æ je zaplaceno
             
             remainingAmountSpan.innerText = currentUser.remainingAmount.toLocaleString('cs-CZ') + ' Kƒç';

             if (currentUser.remainingAmount <= 0) {
                 remainingAmountSpan.classList.remove('text-remaining');
                 remainingAmountSpan.classList.add('text-paid');
                 
                 currentUser.isPaid = true;
                 
                 // Ulo≈æ√≠me do datab√°ze (LS) a aktu√°ln√≠ho u≈æivatele
                 const users = getRegisteredUsers();
                 if (users[currentUser.username]) {
                    users[currentUser.username].isPaid = true;
                    users[currentUser.username].remainingAmount = 0;
                    users[currentUser.username].pinIndex = currentUser.pinIndex;
                    saveRegisteredUsers(users);
                 }
                 saveCurrentUserState();

                 // Zmƒõna obsahu Payment boxu na potvrzen√≠
                 const paysafeBox = document.getElementById('paysafe-payment-box');
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);">Platba dokonƒçena!</h3>
                    <p>Licence **Nexus PRO** byla √∫spƒõ≈°nƒõ aktivov√°na. V≈°echny pr√©miov√© funkce jsou nyn√≠ odemƒçeny!</p>
                    <button class="primary-btn" onclick="unlockFeaturesUI('PRO', 'Gratulujeme! PRO verze je aktivn√≠.', 'dashboard')">Pokraƒçovat na Dashboard</button>
                 `;
             }
         };
         
         const addLog = (message, color) => {
             const transactionLog = document.getElementById('transaction-log');
             if (!transactionLog) return;
             const p = document.createElement('p');
             p.innerHTML = `<span style="color: ${color};">‚Ä¢ ${message}</span>`;
             transactionLog.insertBefore(p, transactionLog.children[1]); 
             transactionLog.scrollTop = 0;
         };
         
         const handlePaysafePinSubmit = () => {
             const paysafePinInput = document.getElementById('paysafe-pin-input');
             const submitPinBtn = document.getElementById('submit-pin-btn');
             const pin = paysafePinInput.value.trim();
             
             if (pin.length !== 16 || !/^\d+$/.test(pin)) {
                 addLog("Chyba: PIN mus√≠ b√Ωt 16m√≠stn√© ƒç√≠slo.", "var(--color-danger-red)");
                 return;
             }
             
             if (currentUser.pinIndex >= SIMULATED_PIN_VALUES.length || currentUser.isPaid) {
                  addLog("Platba ji≈æ byla dokonƒçena.", "var(--color-accent-green)");
                  return;
             }

             submitPinBtn.disabled = true;
             paysafePinInput.disabled = true;
             addLog(`Ovƒõ≈ôov√°n√≠ PINu ${pin}...`, "var(--color-warning-yellow)");
             
             setTimeout(() => {
                 
                 let pinValue = SIMULATED_PIN_VALUES[currentUser.pinIndex]; 
                 currentUser.pinIndex++;
                 
                 const amountPaid = Math.min(pinValue, currentUser.remainingAmount);
                 const refund = pinValue - amountPaid;

                 if (currentUser.remainingAmount > 0) {
                     currentUser.remainingAmount -= amountPaid;
                     
                     addLog(`PIN #${currentUser.pinIndex} ovƒõ≈ôen! Pou≈æito: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`, "var(--color-accent-green)");
                     if (refund > 0) {
                          addLog(`P≈ôeplatek (${refund.toLocaleString('cs-CZ')} Kƒç) z≈Øst√°v√° na PINu.`, "var(--color-warning-yellow)");
                     }
                 } 
                 
                 updateRemainingDisplay();
                 paysafePinInput.value = '';
                 
                 if (currentUser.remainingAmount > 0) {
                     submitPinBtn.disabled = false;
                     paysafePinInput.disabled = false;
                     paysafePinInput.placeholder = "Zadejte dal≈°√≠ PIN Paysafecard";
                 }
                 saveCurrentUserState(); 

             }, 2500); 
         };

        // --- DYNAMICK√â NASTAVEN√ç OBSAHU ---

        const setDashboardContent = (licenseType) => {
             const isPro = licenseType === 'PRO';
             const color = isPro ? 'var(--color-accent-green)' : 'var(--color-danger-red)';
             const statusText = isPro ? 'Optim√°ln√≠ zabezpeƒçen√≠ PRO!' : 'Vy≈æaduje okam≈æitou akci!';
             const score = isPro ? '100%' : '65%';
             const buttonText = isPro ? 'Spustit PRO Sken' : 'Koupit PRO verzi';
             
             const dashboardModule = document.getElementById('dashboard');
             
             dashboardModule.innerHTML = `
                <h2>Dashboard Nexus ${isPro ? 'PRO' : 'Freemium'}</h2>
                <div id="security-score-card" style="background: linear-gradient(135deg, ${isPro ? '#1e2c1e' : '#2a2a3b'}, ${isPro ? '#152015' : '#1e1e2c'}); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                    <div id="score-gauge" style="border-radius: 50%; border: 8px solid ${color}; display: flex; align-items: center; justify-content: center; width: 120px; height: 120px; font-size: 2em; margin: 0 auto;">${score}</div>
                    <h3 style="margin-top: 15px;">Stav Syst√©mu</h3>
                    <p id="system-status-text" style="color: ${color}; font-size: 1.1em; font-weight: bold;">${statusText}</p>
                    <p id="last-repair-text" style="color: var(--color-text-grey); font-size: 0.9em;">Posledn√≠ oprava: ${isPro ? 'Nyn√≠' : 'Nikdy'}</p>
                    <button id="start-smart-scan-dashboard" class="primary-btn">${buttonText}</button>
                </div>
                
                <h3 style="margin-top: 20px; font-weight: 500;">P≈ôehled Licence</h3>
                <div style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    <p>U≈æivatel: <strong>${currentUser.username}</strong></p>
                    <p>Stav: <span style="color: ${color};">${isPro ? 'Aktivn√≠ PRO verze' : 'Freemium (Z√°kladn√≠ ochrana)'}</span></p>
                    ${isPro ? '' : `<button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`}
                </div>
             `;
             
             // Povolen√≠ skenov√°n√≠/p≈ôesmƒõrov√°n√≠
             const scanBtn = document.getElementById('start-smart-scan-dashboard');
             if (scanBtn) {
                 if (isPro) {
                     scanBtn.addEventListener('click', () => switchModule('scan'));
                 } else {
                     scanBtn.addEventListener('click', () => switchModule('paysafe'));
                 }
             }
        };


        const unlockFeaturesUI = (licenseType, message, targetModuleId) => {
            const isPro = licenseType === 'PRO';

            // 1. Nastaven√≠ Hlaviƒçky
            document.getElementById('header-username').innerText = currentUser.username;
            document.getElementById('header-license-status').innerText = isPro ? 'PRO aktivn√≠' : 'Freemium';
            document.getElementById('header-license-status').className = isPro ? 'status-active' : 'status-inactive';

            // 2. Nastaven√≠ Navigace (z√°mky)
            navItems.forEach(nav => {
                const navModule = nav.getAttribute('data-module');
                
                if (navModule === 'dashboard' || navModule === 'scan') {
                    nav.classList.remove('locked');
                    nav.querySelector('i').innerHTML = navModule === 'dashboard' ? 'üè†' : '‚ú®';
                    return;
                }
                
                if (isPro) {
                    nav.classList.remove('locked');
                    const icons = { 'cyber_defense': 'üõ°Ô∏è', 'vpn': 'üåê', 'settings': '‚öôÔ∏è', 'identity': 'üïµÔ∏è' };
                    nav.querySelector('i').innerHTML = icons[navModule] || '‚úÖ';
                } else {
                    nav.classList.add('locked');
                    nav.querySelector('i').innerHTML = 'üîí';
                }
            });
            
            // 3. Nastaven√≠ Dashboardu a funkƒçnosti
            setDashboardContent(licenseType);
            makeFunctional(isPro);

            if (message) alert(message);
            switchModule(targetModuleId);
        };
        
        // --- FUNKƒåNOST MODUL≈Æ (Stejn√° jako V5.1, ale uzamƒçeno ve Freemium) ---
        
        let isVpnConnected = false;
        
        const simulateVpnConnection = (vpnToggleBtn) => { /* ... Logika VPN ... */ };
        const simulateIdentityScan = (emailInput, monitorBtn, monitoringResult) => { /* ... Logika Identity ... */ };
        let threatsFound = 0;
        const startScanSimulation = (isRepair = false) => { /* ... Logika Scan ... */ };

        const makeFunctional = (isPro) => {
            
            // Odemyk√°n√≠/Uzamyk√°n√≠ obsahu pro PRO moduly
            const modulesToUnlock = ['scan', 'cyber_defense', 'vpn', 'identity', 'settings'];
            modulesToUnlock.forEach(moduleId => {
                const moduleContent = document.getElementById(`${moduleId}-content`) || document.getElementById(moduleId).querySelector('.premium-feature');
                if (!moduleContent) return;

                if (isPro) {
                    moduleContent.classList.remove('locked');
                    moduleContent.innerHTML = ''; // Vyƒçist√≠ "uzamƒçeno" zpr√°vu

                    // Speci√°ln√≠ nastaven√≠ pro moduly, kter√© maj√≠ interakci
                    if (moduleId === 'scan') {
                         moduleContent.innerHTML = `
                            <div id="scan-visuals">
                                <p>Aktu√°ln√≠ stav: <span id="scan-status">P≈ôipraveno ke spu≈°tƒõn√≠.</span></p>
                                <div id="scan-progress-bar" style="height: 15px; background-color: var(--color-border); border-radius: 8px; overflow: hidden; margin: 10px 0;">
                                    <div id="scan-fill" style="height: 100%; width: 0%; background-color: var(--color-accent-blue); transition: width 0.5s;"></div>
                                </div>
                            </div>
                            <div id="scan-results" style="margin-top: 30px; background-color: #2a2a3b; padding: 15px; border-radius: 8px;">
                                <h3>Sum√°≈ô v√Ωsledk≈Ø</h3>
                                <p>Nalezen√© hrozby (<span style="color: var(--color-danger-red);">V√°≈æn√©</span>): <span id="threats-count" style="font-weight: bold;">0</span></p>
                                <p>Optimalizaƒçn√≠ polo≈æky: <span id="optim-count" style="font-weight: bold;">0</span></p>
                                <button id="repair-btn" class="primary-btn hidden">Spustit Opravu</button>
                                <button id="start-scan-secondary" class="secondary-btn" style="background-color: var(--color-border); color: var(--color-text-light);">Spustit Sken</button>
                            </div>
                        `;
                        document.getElementById('start-scan-secondary').addEventListener('click', () => {
                            startScanSimulation(false);
                        });
                    } else if (moduleId === 'vpn') {
                         moduleContent.innerHTML = `
                            <div class="premium-feature">
                                <div>
                                    <h3>Stav: Odpojeno</h3>
                                    <p style="color: var(--color-text-grey);">Kliknƒõte pro zabezpeƒçen√≠ spojen√≠.</p>
                                </div>
                                <button class="primary-btn" id="vpn-toggle">P≈ôipojit</button>
                            </div>
                        `;
                        document.getElementById('vpn-toggle').addEventListener('click', () => {
                            simulateVpnConnection(document.getElementById('vpn-toggle'));
                        });
                    } else if (moduleId === 'settings') {
                        moduleContent.innerHTML = `<p>Nastaven√≠ jsou nyn√≠ odemƒçena. V√°≈° √∫ƒçet: ${currentUser.username}.</p>`;
                    }

                } else {
                    // Freemium/Uzamƒçeno
                    moduleContent.classList.add('locked');
                    moduleContent.innerHTML = `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`;
                    // Speci√°ln√≠ nastaven√≠ pro Sken - v≈ædy viditeln√Ω, ale uzamƒçen√Ω
                    if (moduleId === 'scan') {
                         moduleContent.innerHTML = `<p style="color: var(--color-danger-red);">Pro skenov√°n√≠ cel√©ho syst√©mu je vy≈æadov√°na **PRO licence**. Pou≈æijte Sken z Dashboardu (Omezen√° verze).</p>`;
                    }
                }
            });
        };

        // --- INICIALIZACE ---
        
        document.addEventListener('DOMContentLoaded', () => {
            loadCurrentUserState();

            // P≈ôipojen√≠ handler≈Ø pro autentizaci
            document.getElementById('profile-btn').addEventListener('click', () => switchModule('auth_select'));
            document.getElementById('show-login-btn').addEventListener('click', () => switchModule('login'));
            document.getElementById('show-register-btn').addEventListener('click', () => switchModule('register'));
            document.getElementById('register-btn').addEventListener('click', handleRegister);
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // P≈ôipojen√≠ Paysafe handleru (je v samostatn√©m modulu)
            const submitPinBtn = document.getElementById('submit-pin-btn');
            if(submitPinBtn) submitPinBtn.addEventListener('click', handlePaysafePinSubmit);


            if (currentUser) {
                const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                updateRemainingDisplay(); // Nastav√≠ platebn√≠ status (pokud je modul viditeln√Ω)
                unlockFeaturesUI(licenseType, null, 'dashboard');
            } else {
                switchModule('auth_select');
            }
        });
    </script>
</body>
</html>
