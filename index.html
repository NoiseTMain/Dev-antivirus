<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Nexus Prime Security - V7.0 (Opraven√° Navigace a Formul√°≈ôe)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* --- CSS STYLING --- */
        :root {
            --color-dark-bg: #1e1e2c; 
            --color-darker-bg: #151520; 
            --color-accent-blue: #007bff; 
            --color-accent-green: #28a745; 
            --color-danger-red: #dc3545;
            --color-warning-yellow: #ffc107;
            --color-text-light: #f0f0f5;
            --color-text-grey: #a0a0b0;
            --color-border: #303040;
        }

        body {
            background-color: var(--color-darker-bg); 
            color: var(--color-text-light);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #app-window {
            width: 400px; 
            height: 700px; 
            background-color: var(--color-dark-bg);
            border-radius: 25px; 
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 0 10px #000; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* HLAVIƒåKA */
        #header {
            background-color: var(--color-darker-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            color: var(--color-text-light);
            font-size: 1.4em;
            font-weight: 700;
        }
        #profile-btn {
            background: none;
            border: none;
            color: var(--color-text-light);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        #profile-btn:hover { color: var(--color-accent-blue); }
        
        #user-info-status {
             font-size: 0.8em;
             line-height: 1.3;
             text-align: right;
        }
        .status-inactive { color: var(--color-danger-red); } 
        .status-active { color: var(--color-accent-green); font-weight: bold; } 

        /* OBSAHOV√Å OBLAST */
        #content-area {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; 
            padding-bottom: 80px; 
        }
        .module { animation: fadeIn 0.5s; }
        .module.hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { color: var(--color-text-light); border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 20px; font-weight: 500; font-size: 1.4em;}
        
        .primary-btn, .secondary-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%; 
            box-sizing: border-box;
            margin-bottom: 10px;
            transition: background-color 0.2s;
        }
        .primary-btn {
            background-color: var(--color-accent-blue);
            color: white;
            font-size: 1.1em;
            margin-top: 15px;
        }
        .secondary-btn {
            background-color: var(--color-border);
            color: var(--color-text-light);
            margin-top: 15px;
        }
        
        /* Formul√°≈ôe - Nov√Ω blokov√Ω design */
        #auth_select, #login, #register {
            padding: 20px 0;
        }
        .auth-form-container {
             background-color: #2a2a3b;
             padding: 30px 20px;
             border-radius: 12px;
             margin-top: 30px;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            background-color: var(--color-darker-bg);
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        /* NAVIGACE - OPRAVA VZHLEDU */
        #bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background-color: var(--color-darker-bg);
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 5px 0;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--color-text-grey);
            font-size: 0.75em;
            transition: color 0.2s;
            cursor: pointer;
            flex: 1;
        }
        .nav-item.active { color: var(--color-accent-blue); }
        .nav-item.locked {
            opacity: 0.6;
            color: var(--color-danger-red);
            cursor: not-allowed;
        }
        .nav-item i {
            font-size: 1.5em;
            margin-bottom: 3px;
        }
    </style>
</head>
<body>

    <div id="app-window">
        <header id="header">
             <h1 class="logo">Nexus Prime Security</h1>
             <div style="display: flex; align-items: center;">
                 <div id="user-info-status">
                     <span id="header-username">Odhl√°≈°eno</span><br>
                     <span id="header-license-status" class="status-inactive">Neaktivn√≠</span>
                 </div>
                 <button id="profile-btn">
                    üë§
                 </button>
             </div>
        </header>

        <main id="content-area">
            
            <div id="auth_select" class="module hidden">
                <h2 style="border: none;">V√≠tejte v Nexus Prime</h2>
                <p style="color: var(--color-text-grey); margin-bottom: 20px;">Zabezpeƒçte sv√© mobiln√≠ za≈ô√≠zen√≠. Pro p≈ô√≠stup k ochranƒõ se p≈ôihlaste nebo vytvo≈ôte nov√Ω √∫ƒçet.</p>
                <div class="auth-form-container">
                    <button id="show-login-btn" class="primary-btn">P≈ôihl√°sit se k √∫ƒçtu</button>
                    <button id="show-register-btn" class="secondary-btn">Vytvo≈ôit √öƒçet</button>
                </div>
            </div>

            <div id="login" class="module hidden">
                <h2>üë§ P≈ôihl√°≈°en√≠ k √∫ƒçtu</h2>
                <div class="auth-form-container">
                    <p id="login-message" style="margin-bottom: 20px; color: var(--color-text-grey);">Zadejte sv√© u≈æivatelsk√© jm√©no a heslo:</p>
                    <div id="login-form">
                        <input type="text" id="login-username" placeholder="U≈æivatelsk√© jm√©no">
                        <input type="password" id="login-password" placeholder="Heslo">
                        <button id="login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                        <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                    </div>
                </div>
            </div>
            
            <div id="register" class="module hidden">
                 <h2>üîë Vytvo≈ôen√≠ Nov√©ho √öƒçtu</h2>
                 <div class="auth-form-container">
                     <p style="margin-bottom: 20px;">Z√≠skejte p≈ô√≠stup k funkc√≠m Freemium verze.</p>
                     <div id="register-form">
                         <input type="text" id="reg-username" placeholder="U≈æivatelsk√© jm√©no">
                         <input type="password" id="reg-password" placeholder="Heslo">
                         <button id="register-btn" class="primary-btn">Vytvo≈ôit √öƒçet a P≈ôihl√°sit se</button>
                         <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                     </div>
                 </div>
            </div>
            
            <div id="dashboard" class="module hidden">
                </div>
            
            <div id="paysafe" class="module hidden">
                <h2>üí≥ Aktivace PRO Verze</h2>
                <div id="paysafe-payment-box" style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    <button class="secondary-btn" onclick="switchModule('dashboard')">Zpƒõt na Dashboard</button>
                </div>
            </div>
            
            <div id="scan" class="module hidden">
                <h2>üöÄ Chytr√Ω Sken</h2>
                <div id="scan-content" class="premium-feature"></div>
            </div>
            <div id="cyber_defense" class="module hidden">
                 <h2>üõ°Ô∏è Kybernetick√° Obrana</h2>
                 <div id="cyber-content" class="premium-feature"></div>
            </div>
            <div id="vpn" class="module hidden">
                <h2>üîí VPN Prime</h2>
                <div id="vpn-content" class="premium-feature"></div>
            </div>
            <div id="identity" class="module hidden">
                 <h2>üïµÔ∏è Identity Guard</h2>
                <div id="identity-content" class="premium-feature"></div>
            </div>
            <div id="settings" class="module hidden">
                <h2>‚öôÔ∏è Nastaven√≠</h2>
                <div id="settings-content" class="premium-feature"></div>
            </div>

        </main>
        
        <nav id="bottom-nav">
            <a href="#" class="nav-item active" data-module="dashboard" id="dashboard-nav">
                <i style="font-style: normal;">üè†</i> Home
            </a>
            <a href="#" class="nav-item locked" data-module="scan" id="scan-nav">
                <i style="font-style: normal;">‚ú®</i> Sken
            </a>
            <a href="#" class="nav-item locked" data-module="cyber_defense" id="cyber-nav">
                <i style="font-style: normal;">üîí</i> Obrana
            </a>
            <a href="#" class="nav-item locked" data-module="vpn" id="vpn-nav">
                <i style="font-style: normal;">üîí</i> VPN
            </a>
             <a href="#" class="nav-item locked" data-module="settings" id="settings-nav">
                <i style="font-style: normal;">üîí</i> Nastaven√≠
            </a>
        </nav>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIKA --- */
        const CURRENT_USER_KEY = 'nexusPrimeCurrentUser';
        const REGISTERED_USERS_KEY = 'nexusPrimeRegisteredUsers';
        const PRO_PRICE = 7999;
        
        // --- GLOB√ÅLN√ç STAV ---
        let currentUser = null;
        
        // P≈òESN√Å LOGIKA PIN≈Æ: 3610 + 3610 + 779 = 7999
        const SIMULATED_PIN_VALUES = [3610, 3610, 779]; 

        // --- POMOCN√â FUNKCE A TRVALOST DAT ---
        
        const getRegisteredUsers = () => {
             const users = localStorage.getItem(REGISTERED_USERS_KEY);
             return users ? JSON.parse(users) : {};
        };
        
        const saveRegisteredUsers = (users) => {
             localStorage.setItem(REGISTERED_USERS_KEY, JSON.stringify(users));
        };
        
        const saveCurrentUserState = () => {
             if (currentUser) {
                 // Neukl√°d√°me heslo v currentUser do LS pro bezpeƒçnostn√≠ simulaci, jen pro ovƒõ≈ôen√≠ na zaƒç√°tku
                 const userToSave = {...currentUser};
                 delete userToSave.password; 
                 localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userToSave));
             }
        };

        const loadCurrentUserState = () => {
            const stored = localStorage.getItem(CURRENT_USER_KEY);
            if (stored) {
                const storedUser = JSON.parse(stored);
                // Pro znovup≈ôihl√°≈°en√≠ pou≈æijeme ulo≈æen√© hodnoty
                currentUser = storedUser;
                // Nastaven√≠ admin √∫ƒçtu (pokud je, ujist√≠me se, ≈æe m√° PRO)
                 if (currentUser.username === 'Va≈°ek') {
                     currentUser.isPaid = true;
                     currentUser.remainingAmount = 0;
                     currentUser.pinIndex = SIMULATED_PIN_VALUES.length;
                 }
                return true;
            }
            return false;
        };

        const switchModule = (moduleId) => {
            // Kontrola p≈ôihl√°≈°en√≠
            if (!currentUser && moduleId !== 'auth_select' && moduleId !== 'login' && moduleId !== 'register') {
                alert('Mus√≠te se nejprve p≈ôihl√°sit.');
                moduleId = 'auth_select';
            }
            
            // Zobrazen√≠/skryt√≠ modul≈Ø
            document.querySelectorAll('.module').forEach(m => m.classList.add('hidden'));
            document.getElementById(moduleId).classList.remove('hidden');

            // Aktualizace navigace
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            // Aktivace spr√°vn√©ho nav-itemu, Home je v≈ædy dashboard
            const activeNav = document.querySelector(`.nav-item[data-module="${moduleId}"]`) || document.getElementById('dashboard-nav');
            if (activeNav) activeNav.classList.add('active');
        };

        // --- HANDLERY PRO REGISTRACI A P≈òIHL√Å≈†EN√ç ---
        
        const handleRegister = () => {
            const regUsername = document.getElementById('reg-username').value.trim();
            const regPassword = document.getElementById('reg-password').value.trim();
            const users = getRegisteredUsers();

            if (regUsername.length < 3 || regPassword.length < 5) {
                alert('Pros√≠m, zadejte platn√© u≈æivatelsk√© jm√©no (min 3 znaky) a heslo (min 5 znak≈Ø).');
                return;
            }
            if (users[regUsername] || (regUsername === 'Va≈°ek')) {
                 alert(`U≈æivatelsk√© jm√©no "${regUsername}" je ji≈æ obsazeno.`);
                 return;
            }
            
            const newUser = {
                username: regUsername,
                password: regPassword, // Ukl√°d√°me heslo jen pro ovƒõ≈ôen√≠ p≈ôi dal≈°√≠m p≈ôihl√°≈°en√≠
                isPaid: false,
                remainingAmount: PRO_PRICE,
                pinIndex: 0
            };
            
            users[regUsername] = newUser;
            saveRegisteredUsers(users);

            currentUser = newUser;
            saveCurrentUserState();
            
            unlockFeaturesUI('Freemium', `V√≠tejte, ${regUsername}! V√°≈° √∫ƒçet byl vytvo≈ôen.`, 'dashboard');
        };
        
        const handleLogin = () => {
            const loginUsername = document.getElementById('login-username').value.trim();
            const loginPassword = document.getElementById('login-password').value.trim();
            const users = getRegisteredUsers();
            
            // 1. Tajn√Ω PRO √∫ƒçet (ADMIN)
            if (loginUsername === 'Va≈°ek' && loginPassword === 'vasek11') {
                 currentUser = {
                    username: 'Va≈°ek',
                    password: 'vasek11',
                    isPaid: true,
                    remainingAmount: 0,
                    pinIndex: SIMULATED_PIN_VALUES.length
                };
                saveCurrentUserState();
                unlockFeaturesUI('PRO', `V√≠tejte zpƒõt, ${currentUser.username}! PRO verze je automaticky aktivov√°na.`, 'dashboard');
                return;
            }

            // 2. Norm√°ln√≠ ulo≈æen√Ω √∫ƒçet
            const storedUser = users[loginUsername];
            if (storedUser && storedUser.password === loginPassword) {
                 currentUser = storedUser;
                 saveCurrentUserState();
                 const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                 unlockFeaturesUI(licenseType, `V√≠tejte zpƒõt, ${currentUser.username}!`, 'dashboard');
                 return;
            }

            // 3. Chyba
            document.getElementById('login-message').innerText = 'Chyba: Neplatn√© u≈æivatelsk√© jm√©no nebo heslo.';
            document.getElementById('login-message').style.color = 'var(--color-danger-red)';
        };

        const handleLogout = () => {
             currentUser = null;
             localStorage.removeItem(CURRENT_USER_KEY);
             
             // Reset UI a p≈ôechod na p≈ôihl√°≈°en√≠
             document.getElementById('header-username').innerText = 'Odhl√°≈°eno';
             document.getElementById('header-license-status').innerText = 'Neaktivn√≠';
             document.getElementById('header-license-status').className = 'status-inactive';
             
             // Reset navigaƒçn√≠ch prvk≈Ø
             document.querySelectorAll('.nav-item').forEach(nav => {
                 const navModule = nav.getAttribute('data-module');
                 if (navModule !== 'dashboard') {
                    nav.classList.add('locked');
                    nav.querySelector('i').innerHTML = 'üîí';
                 }
             });
             
             document.getElementById('dashboard').innerHTML = '';
             switchModule('auth_select');
        };

        // --- LOGIKA PLATEBN√ç SIMULACE ---
        
        const updateRemainingDisplay = () => {
             // Dynamicky naƒçte z Paysafe modulu, i kdy≈æ je v dashboardu
             const remainingAmountSpan = document.getElementById('remaining-amount');
             if (!remainingAmountSpan) return;
             
             remainingAmountSpan.innerText = currentUser.remainingAmount.toLocaleString('cs-CZ') + ' Kƒç';

             if (currentUser.remainingAmount <= 0) {
                 remainingAmountSpan.classList.remove('text-remaining');
                 remainingAmountSpan.classList.add('text-paid');
                 
                 currentUser.isPaid = true;
                 
                 // Ulo≈æ√≠me do datab√°ze (LS) a aktu√°ln√≠ho u≈æivatele
                 const users = getRegisteredUsers();
                 if (users[currentUser.username]) {
                    users[currentUser.username].isPaid = true;
                    users[currentUser.username].remainingAmount = 0;
                    users[currentUser.username].pinIndex = currentUser.pinIndex;
                    saveRegisteredUsers(users);
                 }
                 saveCurrentUserState();

                 // Zmƒõna obsahu Payment boxu na potvrzen√≠
                 const paysafeBox = document.getElementById('paysafe-payment-box');
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);">Platba dokonƒçena!</h3>
                    <p>Licence **Nexus PRO** byla √∫spƒõ≈°nƒõ aktivov√°na. V≈°echny pr√©miov√© funkce jsou nyn√≠ odemƒçeny!</p>
                    <button class="primary-btn" onclick="unlockFeaturesUI('PRO', 'Gratulujeme! PRO verze je aktivn√≠.', 'dashboard')">Pokraƒçovat na Dashboard</button>
                 `;
             }
         };
         
         const addLog = (message, color) => {
             const transactionLog = document.getElementById('transaction-log');
             if (!transactionLog) return;
             const p = document.createElement('p');
             p.innerHTML = `<span style="color: ${color};">‚Ä¢ ${message}</span>`;
             transactionLog.insertBefore(p, transactionLog.children[1]); 
             transactionLog.scrollTop = 0;
         };
         
         const handlePaysafePinSubmit = () => {
             const paysafePinInput = document.getElementById('paysafe-pin-input');
             const submitPinBtn = document.getElementById('submit-pin-btn');
             const pin = paysafePinInput.value.trim();
             
             if (pin.length !== 16 || !/^\d+$/.test(pin)) {
                 addLog("Chyba: PIN mus√≠ b√Ωt 16m√≠stn√© ƒç√≠slo.", "var(--color-danger-red)");
                 return;
             }
             
             if (currentUser.pinIndex >= SIMULATED_PIN_VALUES.length || currentUser.isPaid) {
                  addLog("Platba ji≈æ byla dokonƒçena.", "var(--color-accent-green)");
                  return;
             }

             submitPinBtn.disabled = true;
             paysafePinInput.disabled = true;
             addLog(`Ovƒõ≈ôov√°n√≠ PINu ${pin}...`, "var(--color-warning-yellow)");
             
             setTimeout(() => {
                 
                 let pinValue = SIMULATED_PIN_VALUES[currentUser.pinIndex]; 
                 currentUser.pinIndex++;
                 
                 const amountPaid = Math.min(pinValue, currentUser.remainingAmount);
                 const refund = pinValue - amountPaid;

                 if (currentUser.remainingAmount > 0) {
                     currentUser.remainingAmount -= amountPaid;
                     
                     addLog(`PIN #${currentUser.pinIndex} ovƒõ≈ôen! Pou≈æito: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`, "var(--color-accent-green)");
                     if (refund > 0) {
                          addLog(`P≈ôeplatek (${refund.toLocaleString('cs-CZ')} Kƒç) z≈Øst√°v√° na PINu.`, "var(--color-warning-yellow)");
                     }
                 } 
                 
                 updateRemainingDisplay();
                 paysafePinInput.value = '';
                 
                 if (currentUser.remainingAmount > 0) {
                     submitPinBtn.disabled = false;
                     paysafePinInput.disabled = false;
                     paysafePinInput.placeholder = "Zadejte dal≈°√≠ PIN Paysafecard";
                 }
                 saveCurrentUserState(); 

             }, 2500); 
         };

        // --- DYNAMICK√â NASTAVEN√ç OBSAHU MODUL≈Æ ---

        const setPaysafeModuleContent = () => {
             const paysafeBox = document.getElementById('paysafe-payment-box');
             paysafeBox.innerHTML = `
                <h4>Nexus PRO (Roƒçn√≠ licence): <span style="color: var(--color-accent-blue);">7 999 Kƒç</span></h4>
                <div id="paysafe-status-bar" style="padding: 15px; background-color: #151520; border-radius: 8px; font-size: 1.2em; font-weight: bold; margin-bottom: 20px;">
                    Zb√Ωvaj√≠c√≠ ƒç√°stka k √∫hradƒõ: <span id="remaining-amount" class="text-remaining">7 999 Kƒç</span>
                </div>
                <div class="paysafe-input-area">
                    <input type="text" id="paysafe-pin-input" placeholder="Zadejte 16m√≠stn√Ω PIN Paysafecard" maxlength="16">
                    <button id="submit-pin-btn" class="primary-btn">Ovƒõ≈ôit PIN</button>
                </div>
                <div id="transaction-log"><p>Log transakc√≠:</p></div>
                <button class="secondary-btn" onclick="switchModule('dashboard')">Zpƒõt na Dashboard</button>
             `;
             // P≈ôipojen√≠ handleru
             document.getElementById('submit-pin-btn').addEventListener('click', handlePaysafePinSubmit);
             updateRemainingDisplay();
        };

        const setDashboardContent = (licenseType) => {
             const isPro = licenseType === 'PRO';
             const color = isPro ? 'var(--color-accent-green)' : 'var(--color-danger-red)';
             const statusText = isPro ? 'Optim√°ln√≠ zabezpeƒçen√≠ PRO!' : 'Vy≈æaduje okam≈æitou akci!';
             const score = isPro ? '100%' : '65%';
             const buttonText = isPro ? 'Spustit PRO Sken' : 'Koupit PRO verzi';
             
             const dashboardModule = document.getElementById('dashboard');
             
             dashboardModule.innerHTML = `
                <h2>Domovsk√° Obrazovka</h2>
                <div id="security-score-card" style="background: linear-gradient(135deg, ${isPro ? '#1e2c1e' : '#2a2a3b'}, ${isPro ? '#152015' : '#1e1e2c'}); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                    <div id="score-gauge" style="border-radius: 50%; border: 8px solid ${color}; display: flex; align-items: center; justify-content: center; width: 120px; height: 120px; font-size: 2em; margin: 0 auto;">${score}</div>
                    <h3 style="margin-top: 15px;">Stav Syst√©mu</h3>
                    <p id="system-status-text" style="color: ${color}; font-size: 1.1em; font-weight: bold;">${statusText}</p>
                    <p id="last-repair-text" style="color: var(--color-text-grey); font-size: 0.9em;">Posledn√≠ oprava: ${isPro ? 'Nyn√≠' : 'Nikdy'}</p>
                    <button id="start-smart-scan-dashboard" class="primary-btn">${buttonText}</button>
                </div>
                
                <h3 style="margin-top: 20px; font-weight: 500;">P≈ôehled √öƒçtu</h3>
                <div style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    <p>U≈æivatel: <strong>${currentUser.username}</strong></p>
                    <p>Stav licence: <span style="color: ${color};">${isPro ? 'Aktivn√≠ PRO verze' : 'Freemium (Z√°kladn√≠ ochrana)'}</span></p>
                    ${isPro ? '' : `<button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`}
                    <button class="secondary-btn" onclick="handleLogout()">Odhl√°sit se</button>
                </div>
             `;
             
             // Povolen√≠ skenov√°n√≠/p≈ôesmƒõrov√°n√≠
             const scanBtn = document.getElementById('start-smart-scan-dashboard');
             if (scanBtn) {
                 if (isPro) {
                     scanBtn.addEventListener('click', () => switchModule('scan'));
                 } else {
                     scanBtn.addEventListener('click', () => switchModule('paysafe'));
                 }
             }
        };


        const unlockFeaturesUI = (licenseType, message, targetModuleId) => {
            const isPro = licenseType === 'PRO';

            // 1. Nastaven√≠ Hlaviƒçky
            document.getElementById('header-username').innerText = currentUser.username;
            document.getElementById('header-license-status').innerText = isPro ? 'PRO aktivn√≠' : 'Freemium';
            document.getElementById('header-license-status').className = isPro ? 'status-active' : 'status-inactive';

            // 2. Nastaven√≠ Navigace (z√°mky)
            document.querySelectorAll('.nav-item').forEach(nav => {
                const navModule = nav.getAttribute('data-module');
                
                if (navModule === 'dashboard') {
                    nav.classList.remove('locked');
                    nav.querySelector('i').innerHTML = 'üè†';
                    return;
                }
                
                if (isPro) {
                    nav.classList.remove('locked');
                    const icons = { 'scan': 'üöÄ', 'cyber_defense': 'üõ°Ô∏è', 'vpn': 'üåê', 'settings': '‚öôÔ∏è' };
                    nav.querySelector('i').innerHTML = icons[navModule] || '‚úÖ';
                } else {
                    nav.classList.add('locked');
                    nav.querySelector('i').innerHTML = 'üîí';
                }
            });
            
            // 3. Nastaven√≠ Dashboardu a funkƒçnosti
            setPaysafeModuleContent(); // V≈ædy p≈ôiprav√≠me Paysafe, aby byl p≈ôipraven k platbƒõ
            setDashboardContent(licenseType);
            makeFunctional(isPro);

            if (message) alert(message);
            switchModule(targetModuleId);
        };
        
        // --- FUNKƒåNOST MODUL≈Æ (Simulace z V5.1) ---
        // (Tyto funkce mus√≠ b√Ωt definov√°ny, i kdy≈æ jsou zde zkr√°cen√© pro p≈ôehlednost)
        
        let isVpnConnected = false;
        
        const simulateVpnConnection = (vpnToggleBtn) => {
             // Simulace p≈ôipojov√°n√≠ VPN...
             alert("Simulace VPN p≈ôipojen√≠...");
             if (!isVpnConnected) {
                vpnToggleBtn.disabled = true;
                vpnToggleBtn.innerText = 'P≈ôipojov√°n√≠...';
                vpnToggleBtn.style.backgroundColor = 'var(--color-warning-yellow)';
                
                setTimeout(() => {
                    isVpnConnected = true;
                    vpnToggleBtn.disabled = false;
                    vpnToggleBtn.innerText = 'Odpojit';
                    vpnToggleBtn.style.backgroundColor = 'var(--color-danger-red)';
                    document.querySelector('#vpn-content h3').innerText = 'Stav: P≈ôipojeno (Praha)';
                    document.querySelector('#vpn-content p').innerText = 'IP Adresa: 192.168.1.1 (Maskov√°no)';
                }, 3500);
            } else {
                isVpnConnected = false;
                vpnToggleBtn.innerText = 'P≈ôipojit';
                vpnToggleBtn.style.backgroundColor = 'var(--color-accent-blue)';
                document.querySelector('#vpn-content h3').innerText = 'Stav: Odpojeno';
                document.querySelector('#vpn-content p').innerText = 'Kliknƒõte pro zabezpeƒçen√≠ spojen√≠.';
            }
        };

        const startScanSimulation = (isRepair = false) => {
            // Simulace skenov√°n√≠...
            alert("Simulace spu≈°tƒõn√≠ skenu...");
            // Logika skenov√°n√≠ je zde zkr√°cena, ale odkazuje na funkƒçnost z V6.1
             const scanStatus = document.getElementById('scan-status');
             if(scanStatus) scanStatus.innerText = 'Skenov√°n√≠ prob√≠h√°...';
             setTimeout(() => {
                 if(scanStatus) scanStatus.innerText = isRepair ? 'Oprava dokonƒçena!' : 'Skenov√°n√≠ dokonƒçeno!';
             }, 3000);
        };

        const makeFunctional = (isPro) => {
            
            // Moduly s dynamick√Ωm obsahem
            const modulesConfig = {
                'scan': {
                    proHtml: `
                        <div id="scan-visuals">
                            <p>Aktu√°ln√≠ stav: <span id="scan-status">P≈ôipraveno ke spu≈°tƒõn√≠.</span></p>
                            <div id="scan-progress-bar" style="height: 15px; background-color: var(--color-border); border-radius: 8px; overflow: hidden; margin: 10px 0;">
                                <div id="scan-fill" style="height: 100%; width: 0%; background-color: var(--color-accent-blue); transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <div id="scan-results" style="margin-top: 30px; background-color: #2a2a3b; padding: 15px; border-radius: 8px;">
                            <h3>Sum√°≈ô v√Ωsledk≈Ø</h3>
                            <p>Nalezen√© hrozby: <span id="threats-count" style="font-weight: bold;">0</span></p>
                            <button id="start-scan-secondary" class="primary-btn">Spustit Sken</button>
                        </div>
                    `,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Pro skenov√°n√≠ cel√©ho syst√©mu je vy≈æadov√°na **PRO licence**.</p>`
                },
                'vpn': {
                    proHtml: `
                        <div class="premium-feature">
                            <div><h3>Stav: Odpojeno</h3><p style="color: var(--color-text-grey);">Kliknƒõte pro zabezpeƒçen√≠ spojen√≠.</p></div>
                            <button class="primary-btn" id="vpn-toggle">P≈ôipojit</button>
                        </div>
                    `,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`
                },
                'cyber_defense': {
                    proHtml: `<p>Pokroƒçil√° ochrana je aktivn√≠. Nastaven√≠:</p><p style="margin-top: 10px;">Firewall: <span style="color: var(--color-accent-green);">Zapnuto</span></p>`,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`
                },
                'identity': {
                    proHtml: `<p>Monitoring Dark Webu pro v√°≈° e-mail je aktivn√≠.</p><p style="margin-top: 10px;">Posledn√≠ kontrola: P≈ôed 5 minuty</p>`,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`
                },
                'settings': {
                    proHtml: `<p>Nastaven√≠ jsou nyn√≠ odemƒçena. V√°≈° √∫ƒçet: ${currentUser.username}.</p>`,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`
                }
            };

            // Nastaven√≠ obsahu pro moduly
            for (const moduleId in modulesConfig) {
                const moduleContentDiv = document.getElementById(`${moduleId}-content`);
                if (moduleContentDiv) {
                    moduleContentDiv.innerHTML = isPro ? modulesConfig[moduleId].proHtml : modulesConfig[moduleId].freemiumHtml;
                }
            }

            // P≈ôipojen√≠ handler≈Ø pro PRO funkce
            if (isPro) {
                const vpnToggle = document.getElementById('vpn-toggle');
                if (vpnToggle) vpnToggle.addEventListener('click', () => simulateVpnConnection(vpnToggle));
                
                const scanBtnSecondary = document.getElementById('start-scan-secondary');
                if (scanBtnSecondary) scanBtnSecondary.addEventListener('click', () => startScanSimulation(false));
            }
        };

        // --- INICIALIZACE ---
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // P≈ôipojen√≠ handler≈Ø pro autentizaci
            document.getElementById('profile-btn').addEventListener('click', () => switchModule('auth_select'));
            document.getElementById('show-login-btn').addEventListener('click', () => switchModule('login'));
            document.getElementById('show-register-btn').addEventListener('click', () => switchModule('register'));
            document.getElementById('register-btn').addEventListener('click', handleRegister);
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // P≈ôipojen√≠ navigaƒçn√≠ch handler≈Ø
            document.querySelectorAll('#bottom-nav .nav-item').forEach(nav => {
                nav.addEventListener('click', (e) => {
                    e.preventDefault();
                    const moduleId = e.currentTarget.getAttribute('data-module');
                    if (e.currentTarget.classList.contains('locked')) {
                        alert("Tato funkce je uzamƒçena v Freemium verzi. Kupte PRO licenci!");
                    } else {
                        switchModule(moduleId);
                    }
                });
            });

            // Hlavn√≠ spu≈°tƒõn√≠ aplikace
            loadCurrentUserState();

            if (currentUser) {
                const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                unlockFeaturesUI(licenseType, null, 'dashboard');
            } else {
                switchModule('auth_select');
            }
        });
    </script>
</body>
</html>
