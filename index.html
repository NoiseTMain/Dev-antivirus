<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Nexus Prime Security - V9.5 (Profesion√°ln√≠ Komplet)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- CSS STYLING --- */
        :root {
            /* P≈Øvodn√≠ Dark Mode */
            --color-dark-bg: #1e1e2c; 
            --color-darker-bg: #151520; 
            --color-text-light: #f0f0f5;
            --color-text-grey: #a0a0b0;
            --color-border: #303040;
            
            /* Spoleƒçn√© barvy */
            --color-accent-blue: #007bff; 
            --color-accent-green: #28a745; 
            --color-danger-red: #dc3545;
            --color-warning-yellow: #ffc107;
            
            /* Nov√© - Svƒõtl√Ω re≈æim */
            --color-light-bg: #f5f5f5;
            --color-lighter-bg: #ffffff;
            --color-light-text-dark: #333333;
            --color-light-text-grey: #555555;
            --color-light-border: #cccccc;

            /* Dynamick√© promƒõnn√© pro t√©ma (defaultnƒõ DARK) */
            --app-bg: var(--color-darker-bg);
            --module-bg: var(--color-dark-bg);
            --content-bg: #2a2a3b;
            --text-color: var(--color-text-light);
            --text-muted: var(--color-text-grey);
            --input-bg: var(--color-darker-bg);
            --input-border: var(--color-border);
            --nav-active: var(--color-accent-blue);
            --nav-inactive: var(--color-text-grey);
            --hr-color: var(--color-border);
        }
        
        /* T√©ma LIGHT MODE */
        .light-mode {
            --app-bg: var(--color-lighter-bg);
            --module-bg: var(--color-light-bg);
            --content-bg: var(--color-lighter-bg);
            --text-color: var(--color-light-text-dark);
            --text-muted: var(--color-light-text-grey);
            --input-bg: var(--color-lighter-bg);
            --input-border: var(--color-light-border);
            --nav-active: var(--color-accent-blue);
            --nav-inactive: var(--color-light-text-grey);
            --hr-color: var(--color-light-border);
        }


        body {
            background-color: var(--app-bg); 
            color: var(--text-color);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            transition: background-color 0.3s;
        }

        #app-window {
            width: 400px; 
            height: 700px; 
            background-color: var(--module-bg);
            border-radius: 25px; 
            box-shadow: 0 20px 50px rgba(0 0 0 / 50%), 0 0 0 10px #000; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: background-color 0.3s;
        }

        /* HLAVIƒåKA */
        #header {
            background-color: var(--app-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--hr-color);
            position: sticky;
            top: 0;
            z-index: 10;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .logo {
            color: var(--text-color);
            font-size: 1.4em;
            font-weight: 700;
        }
        #profile-btn, #notifications-btn, #theme-toggle-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        #profile-btn:hover, #notifications-btn:hover, #theme-toggle-btn:hover { color: var(--color-accent-blue); }
        
        #user-info-status {
             font-size: 0.8em;
             line-height: 1.3;
             text-align: right;
        }
        .status-inactive { color: var(--color-danger-red); } 
        .status-active { color: var(--color-accent-green); font-weight: bold; } 
        
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .notification-indicator {
            position: relative;
        }
        .notification-indicator::after {
            content: attr(data-count);
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--color-danger-red);
            color: white;
            border-radius: 50%;
            padding: 1px 5px;
            font-size: 0.7em;
            font-weight: bold;
            display: none; 
        }
        .notification-indicator.active::after {
             display: inline-block;
        }

        /* OBSAHOV√Å OBLAST */
        #content-area {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; 
            padding-bottom: 80px; 
        }
        .module { animation: fadeIn 0.5s; }
        .module.hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1); } }

        h2 { color: var(--text-color); border-bottom: 1px solid var(--hr-color); padding-bottom: 10px; margin-bottom: 20px; font-weight: 500; font-size: 1.4em;}
        
        .primary-btn, .secondary-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%; 
            box-sizing: border-box;
            margin-bottom: 10px;
            transition: background-color 0.2s, color 0.2s;
        }
        .primary-btn {
            background-color: var(--color-accent-blue);
            color: white;
            font-size: 1.1em;
            margin-top: 15px;
        }
        .secondary-btn {
            background-color: var(--input-border);
            color: var(--text-color);
            margin-top: 15px;
        }
        .primary-btn:disabled, .secondary-btn:disabled {
             opacity: 0.5;
             cursor: not-allowed;
        }
        
        /* Formul√°≈ôe */
        .auth-form-container {
             background-color: var(--content-bg);
             padding: 30px 20px;
             border-radius: 12px;
             margin-top: 30px;
             transition: background-color 0.3s;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        
        /* NAVIGACE */
        #bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background-color: var(--app-bg);
            border-top: 1px solid var(--hr-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 5px 0;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--nav-inactive);
            font-size: 0.75em;
            flex: 1;
            cursor: pointer;
            transition: color 0.3s;
        }
        .nav-item.active { color: var(--nav-active); }
        .nav-item.locked { opacity: 0.6; color: var(--color-danger-red); cursor: not-allowed; }
        .nav-item i { font-size: 1.5em; margin-bottom: 3px; }

        /* --- STYLY PRO KONFIGURACE (Identity, Scan) --- */
        .config-group {
             background-color: var(--content-bg);
             padding: 15px;
             border-radius: 10px;
             margin-bottom: 20px;
             transition: background-color 0.3s;
        }
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--hr-color);
        }
        .config-item:last-child { border-bottom: none; }
        .item-info strong { display: block; }
        .item-info span { font-size: 0.8em; color: var(--text-muted); }
        .config-item:hover { background-color: rgba(128, 128, 128, 0.1); border-radius: 5px; padding: 10px; margin: -5px 0;}

        /* Toggle/Checkbox styly */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 25px;
        }
        .toggle-switch input { display: none; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--input-border); transition: 0.4s; border-radius: 25px;
        }
        .slider:before {
            position: absolute; content: ""; height: 19px; width: 19px; left: 3px; bottom: 3px;
            background-color: var(--text-color); transition: 0.4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--color-accent-green); }
        input:checked + .slider:before { transform: translateX(20px); }
        
        /* Historie */
        .activity-log-item {
            background-color: var(--input-bg);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }
        .activity-log-item strong { color: var(--color-accent-blue); }
        
        /* Dashboard Cards */
        .dashboard-card {
            background-color: var(--content-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: background-color 0.3s;
        }
        .stat-widget {
             display: flex;
             justify-content: space-between;
             padding: 5px 0;
             font-size: 0.9em;
             color: var(--text-muted);
        }
        
        /* VPN */
        #vpn-status-header {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        #vpn-ip-display {
             color: var(--color-warning-yellow);
        }
        .item-row {
             display: flex;
             justify-content: space-between;
             padding: 5px 0;
             align-items: center;
        }

    </style>
</head>
<body>

    <div id="app-window" class="dark-mode">
        <header id="header">
             <h1 class="logo">Nexus Prime Security</h1>
             <div class="header-controls">
                 <button id="notifications-btn" class="notification-indicator" data-count="0" onclick="switchModule('notifications')">
                    <i class="fas fa-bell"></i>
                 </button>
                 <button id="theme-toggle-btn" onclick="handleThemeSwitch()">
                    <i class="fas fa-moon"></i>
                 </button>
                 <div id="user-info-status">
                     <span id="header-username">Odhl√°≈°eno</span><br>
                     <span id="header-license-status" class="status-inactive">Neaktivn√≠</span>
                 </div>
                 <button id="profile-btn" onclick="switchModule('settings')">
                    <i class="fas fa-user-circle"></i>
                 </button>
             </div>
        </header>

        <main id="content-area">
            
            <div id="auth_select" class="module hidden">
                <h2>V√≠tejte v Nexus Prime</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">Zabezpeƒçte sv√© mobiln√≠ za≈ô√≠zen√≠. Pro p≈ô√≠stup k ochranƒõ se p≈ôihlaste nebo vytvo≈ôte nov√Ω √∫ƒçet.</p>
                <div class="auth-form-container">
                    <button id="show-login-btn" class="primary-btn">P≈ôihl√°sit se k √∫ƒçtu</button>
                    <button id="show-register-btn" class="secondary-btn">Vytvo≈ôit √öƒçet</button>
                </div>
            </div>

            <div id="login" class="module hidden">
                <h2><i class="fas fa-sign-in-alt"></i> P≈ôihl√°≈°en√≠ k √∫ƒçtu</h2>
                <div class="auth-form-container">
                    <p id="login-message" style="margin-bottom: 20px; color: var(--text-muted);">Zadejte sv√© u≈æivatelsk√© jm√©no a heslo:</p>
                    <div id="login-form">
                        <input type="text" id="login-username" placeholder="U≈æivatelsk√© jm√©no">
                        <input type="password" id="login-password" placeholder="Heslo">
                        <button id="login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                        <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                    </div>
                </div>
            </div>
            
            <div id="register" class="module hidden">
                 <h2><i class="fas fa-user-plus"></i> Vytvo≈ôen√≠ Nov√©ho √öƒçtu</h2>
                 <div class="auth-form-container">
                     <p style="margin-bottom: 20px;">Z√≠skejte p≈ô√≠stup k funkc√≠m Freemium verze.</p>
                     <div id="register-form">
                         <input type="text" id="reg-username" placeholder="U≈æivatelsk√© jm√©no">
                         <input type="password" id="reg-password" placeholder="Heslo">
                         <button id="register-btn" class="primary-btn">Vytvo≈ôit √öƒçet a P≈ôihl√°sit se</button>
                         <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                     </div>
                 </div>
            </div>
            
            <div id="dashboard" class="module hidden">
                </div>
            
            <div id="paysafe" class="module hidden">
                <h2><i class="fas fa-credit-card"></i> Aktivace PRO Verze</h2>
                <div id="paysafe-payment-box" class="config-group">
                    </div>
            </div>
            
            <div id="scan" class="module hidden">
                <h2><i class="fas fa-rocket"></i> Chytr√Ω Sken</h2>
                <div id="scan-content" class="premium-feature"></div>
            </div>
            
            <div id="vpn" class="module hidden">
                <h2><i class="fas fa-globe"></i> VPN Prime</h2>
                <div id="vpn-content" class="premium-feature"></div>
            </div>
            
            <div id="identity" class="module hidden">
                 <h2><i class="fas fa-user-shield"></i> Identity Guard</h2>
                <div id="identity-content" class="premium-feature">
                     </div>
            </div>
            
            <div id="settings" class="module hidden">
                <h2><i class="fas fa-cogs"></i> Profil a Historie</h2>
                <div id="settings-content" class="premium-feature">
                    </div>
            </div>
            
            <div id="notifications" class="module hidden">
                 <h2><i class="fas fa-bell"></i> Centrum Upozornƒõn√≠</h2>
                 <div id="notifications-list" class="config-group">
                     </div>
                 <button class="secondary-btn" id="clear-notifications-btn" onclick="clearNotifications()" disabled>Vymazat v≈°echna upozornƒõn√≠</button>
            </div>
            
            <div id="optimization" class="module hidden">
                 <h2><i class="fas fa-tachometer-alt"></i> Optimalizace V√Ωkonu</h2>
                 <div id="optimization-content" class="premium-feature"></div>
            </div>
            
            <div id="web_shield" class="module hidden">
                 <h2><i class="fas fa-shield-alt"></i> Web Shield & Anti-Phishing</h2>
                 <div id="web-shield-content" class="premium-feature"></div>
            </div>
            
            <div id="vault" class="module hidden">
                 <h2><i class="fas fa-lock"></i> Zabezpeƒçen√Ω Trezor</h2>
                 <div id="vault-content" class="premium-feature"></div>
            </div>
            
            <div id="backup" class="module hidden">
                 <h2><i class="fas fa-cloud-upload-alt"></i> Cloudov√© Z√°lohov√°n√≠</h2>
                 <div id="backup-content" class="premium-feature"></div>
            </div>
            
             <div id="privacy" class="module hidden">
                 <h2><i class="fas fa-user-secret"></i> Ochrana Soukrom√≠</h2>
                 <div id="privacy-content" class="premium-feature"></div>
            </div>
            
             <div id="payment_shield" class="module hidden">
                 <h2><i class="fas fa-money-check-alt"></i> ≈†t√≠t pro Platby</h2>
                 <div id="payment-shield-content" class="premium-feature">
                     <div class="dashboard-card">
                         <h3><i class="fas fa-shield-virus"></i> Ochrana Bankovn√≠ch Aplikac√≠</h3>
                         <p style="color: var(--text-muted);">Zaji≈°≈•uje bezpeƒçn√© prost≈ôed√≠ pro bankovn√≠ a platebn√≠ aplikace. **PRO aktivn√≠**</p>
                         <div class="config-group">
                             <div class="config-item">
                                 <div class="item-info">
                                     <strong>Kontrola Wi-Fi p≈ôipojen√≠</strong>
                                     <span>Ovƒõ≈ôuje zabezpeƒçen√≠ s√≠tƒõ p≈ôed spu≈°tƒõn√≠m aplikace.</span>
                                 </div>
                                 <label class="toggle-switch"><input type="checkbox" checked><span class="slider round"></span></label>
                             </div>
                             <div class="config-item">
                                 <div class="item-info">
                                     <strong>Ochrana proti sn√≠m√°n√≠ obrazovky</strong>
                                     <span>Br√°n√≠ aplikac√≠m t≈ôet√≠ch stran ve sn√≠m√°n√≠ obsahu.</span>
                                 </div>
                                 <label class="toggle-switch"><input type="checkbox" checked><span class="slider round"></span></label>
                             </div>
                         </div>
                         <button class="secondary-btn">Spravovat chr√°nƒõn√© aplikace</button>
                     </div>
                 </div>
            </div>


        </main>
        
        <nav id="bottom-nav">
            <a href="#" class="nav-item active" data-module="dashboard" id="dashboard-nav">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="#" class="nav-item locked" data-module="scan" id="scan-nav">
                <i class="fas fa-rocket"></i> Sken
            </a>
            <a href="#" class="nav-item locked" data-module="vpn" id="vpn-nav">
                <i class="fas fa-globe"></i> VPN
            </a>
            <a href="#" class="nav-item locked" data-module="identity" id="identity-nav">
                <i class="fas fa-user-shield"></i> Identity
            </a>
            <a href="#" class="nav-item locked" data-module="optimization" id="optimization-nav">
                <i class="fas fa-tachometer-alt"></i> Optimalizace
            </a>
            <a href="#" class="nav-item locked" data-module="web_shield" id="web_shield-nav">
                <i class="fas fa-shield-alt"></i> Web
            </a>
             <a href="#" class="nav-item locked" data-module="settings" id="settings-nav">
                <i class="fas fa-cogs"></i> Profil
            </a>
             <a href="#" class="nav-item locked" data-module="payment_shield" id="payment_shield-nav">
                <i class="fas fa-money-check-alt"></i> Platby
            </a>
        </nav>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIKA V9.5 --- */
        const CURRENT_USER_KEY = 'nexusPrimeCurrentUser';
        const REGISTERED_USERS_KEY = 'nexusPrimeRegisteredUsers';
        const ACTIVITY_LOG_KEY = 'nexusPrimeActivityLog';
        const NOTIFICATIONS_KEY = 'nexusPrimeNotifications';
        
        // --- CENA A NOV√â LICENCE (Upraveno dle po≈æadavku) ---
        const SUBSCRIPTION_PLANS = {
            'half_year': { days: 182, fullPrice: 3999, discountedPrice: 3799, name: "P≈Øl roku (5% Sleva)" },
            'one_year': { days: 365, fullPrice: 7999, discountedPrice: 7599, name: "Jeden rok (5% Sleva)" },
            'lifetime': { days: 9999, fullPrice: 19999, discountedPrice: 18999, name: "Do≈æivotnƒõ (5% Sleva)" }
        };
        const DEFAULT_PRICE = SUBSCRIPTION_PLANS.one_year.discountedPrice;
        const SIMULATED_PIN_VALUES = [3610, 3610, 779]; 

        let currentUser = null;
        
        // --- DATA A JAZYKOV√â PROMƒöNN√â ---
        
        const i18n = {
            "cs": {
                "welcome": "V√≠tejte zpƒõt,", "paid_active": "PRO aktivn√≠", "freemium_active": "Freemium", 
                "lock_title": "Tato funkce je uzamƒçena!", "lock_msg": "K odemƒçen√≠ je nutn√° **PRO licence**.",
                "status_active": "Aktivn√≠ PRO verze", "status_free": "Freemium (Z√°kladn√≠ ochrana)",
                "buy_pro": "Koupit PRO licenci", "logout": "Odhl√°sit se", "scan_run": "Spustit Sken",
                "scan_repair": "Opravit V≈°e (1 kliknut√≠)", "threats_found": "Nalezen√© hrozby:",
                "scan_status_ready": "P≈ôipraveno ke spu≈°tƒõn√≠.", "scan_status_running": "Skenov√°n√≠ prob√≠h√°...",
                "repair_done": "Oprava dokonƒçena! V≈°echny hrozby byly odstranƒõny.", "scan_done": "Skenov√°n√≠ dokonƒçeno! Nalezeno %s hrozeb.",
                "app_perm_scan": "Kontrola opr√°vnƒõn√≠ aplikac√≠", "app_perm_info": "Tyto aplikace maj√≠ opr√°vnƒõn√≠ k p≈ô√≠stupu k citliv√Ωm dat≈Øm. Mƒõli byste je zkontrolovat.",
                "app_perm_title": "Opr√°vnƒõn√≠ aplikace", "app_perm_toggle": "Omezit p≈ô√≠stup",
                "app_perm_toggle_on": "Povolit", "app_perm_toggle_off": "Omezit",
                "vault_title": "Simulovan√Ω Trezor", "vault_desc": "Bezpeƒçnƒõ ulo≈æte p≈ôihla≈°ovac√≠ √∫daje a dokumenty."
            },
            "en": {
                "welcome": "Welcome back,", "paid_active": "PRO Active", "freemium_active": "Freemium",
                "lock_title": "This feature is locked!", "lock_msg": "PRO license is required to unlock.",
                "status_active": "Active PRO Version", "status_free": "Freemium (Basic Protection)",
                "buy_pro": "Buy PRO License", "logout": "Log Out", "scan_run": "Run Scan",
                "scan_repair": "Repair All (1 Click)", "threats_found": "Threats Found:",
                "scan_status_ready": "Ready to run.", "scan_status_running": "Scanning in progress...",
                "repair_done": "Repair completed! All threats removed.", "scan_done": "Scanning complete! %s threats found.",
                "app_perm_scan": "Application Permissions Check", "app_perm_info": "These apps have access to sensitive data. You should review them.",
                "app_perm_title": "App Permission", "app_perm_toggle": "Limit Access",
                "app_perm_toggle_on": "Allow", "app_perm_toggle_off": "Limit",
                "vault_title": "Simulated Vault", "vault_desc": "Securely store your login credentials and documents."
            }
        };

        const SIMULATION_DATA = {
            // Idea 1/23 - Podrobn√© hrozby
            SIMULATED_THREATS: [
                 { name: "Cookie_ID: 45A-87Z", type: "Tracking", location: "/data/user/cache/chrome" },
                 { name: "Nezabezpeƒçen√Ω WiFi Port (8080)", type: "Network Vulnerability", location: "Router Settings" },
                 { name: "Zastaral√Ω syst√©mov√Ω patch (Kernel)", type: "System Vulnerability", location: "System Core" },
                 { name: "FakeSystemUpdater.apk", type: "Malware/PUP", location: "/storage/downloads" },
                 { name: "Naru≈°en√≠: Primary email", type: "Identity Breach", location: "Dark Web Report" }
            ],
            // Idea 11/26 - Opr√°vnƒõn√≠ aplikac√≠
            APP_PERMISSIONS: [
                 { name: "Facebook", type: "Social", permissions: ["Poloha", "Mikrofon", "Kontakty"], restricted: false },
                 { name: "Bankovn√≠ App", type: "Finance", permissions: ["S√≠≈•", "Stav telefonu"], restricted: false },
                 { name: "Hra XYZ", type: "Game", permissions: ["Kontakty", "Galerie"], restricted: false },
                 { name: "Kamera", type: "System", permissions: ["Poloha", "Mikrofon", "Galerie"], restricted: false },
                 { name: "Simulovan√° ≈†pehovac√≠ App", type: "Malware", permissions: ["Poloha", "Mikrofon", "S√≠≈•", "Galerie"], restricted: false }
            ],
            // Idea 6 - VPN Protokoly
            VPN_PROTOCOLS: ["WireGuard (Doporuƒçeno)", "OpenVPN", "IKEv2"],
            // Idea 13 - Technick√© detaily
            SYSTEM_INFO: {
                KERNEL_VERSION: "5.15.0-94-generic",
                PATCH_DATE: new Date('2025-11-01'), // Simulace star√©ho patche
                LAST_IP: "192.168.1.100",
                QUARANTINE_CODE: "E3C4-F9D2-A1B7"
            },
            // Idea 8 - HW widgety
            HW_STATS: {
                 RAM: { total: 8000, used: 5200 },
                 BATTERY: { health: 98, temp: 35.5 }
            },
            
            IDENTITY_ITEMS: [
                { name: "Prim√°rn√≠ e-mail", type: "email", defaultChecked: true },
                { name: "Z√°lo≈æn√≠ e-mail", type: "email", defaultChecked: false },
                { name: "ƒå√≠slo kreditn√≠ karty (4 cifry)", type: "card", defaultChecked: true },
                { name: "Rodn√© ƒç√≠slo", type: "social", defaultChecked: true },
                { name: "Telefonn√≠ ƒç√≠slo", type: "phone", defaultChecked: true },
                { name: "U≈æivatelsk√© jm√© (soci√°ln√≠ s√≠tƒõ)", type: "username", defaultChecked: true },
            ],
            SCAN_AREAS: [
                { name: "Syst√©mov√© soubory (j√°dro OS)", default: true },
                { name: "Aplikace t≈ôet√≠ch stran", default: true },
                { name: "Registry a datab√°ze", default: true },
                { name: "Simulovan√© Adware skripty", default: true },
                { name: "Potenci√°lnƒõ ne≈æ√°douc√≠ programy (PUP)", default: true },
            ],
            VPN_SERVERS: [
                "Automaticky (Nejrychlej≈°√≠)", "ƒåesk√° republika (Praha 1)", "Nƒõmecko (Frankfurt)", 
                "USA (New York)", "Japonsko (Tokio)", "Singapur"
            ],
            // Idea 22 - Simulace Phishingu
            PHISHING_URLS: {
                "google.com": false,
                "banka.cz": false,
                "phishing.com": true,
                "securelogin.net": true
            },
            // NOV√â: Pl√°nov√°n√≠ Skenu
            SCAN_SCHEDULES: ["Vypnuto", "T√Ωdnƒõ (Nedƒõle 2:00)", "Dennƒõ (23:00)"],
            
        };

        let currentLang = 'cs';
        const _ = (key) => i18n[currentLang][key] || key;
        
        // --- NOV√â GLOB√ÅLN√ç STAVY ---
        let vpnInterval = null;
        let isVpnConnected = false;
        let simulatedThreats = [];
        let selectedPlan = 'one_year'; // Defaultn√≠ pl√°n pro platbu
        
        // --- FUNKCE PRO V√ùPOƒåET A TRVALOST DAT ---
        const calculateExpirationDate = (planKey) => {
            const plan = SUBSCRIPTION_PLANS[planKey];
            if (!plan) return null;
            
            const today = new Date();
            if (planKey === 'lifetime') {
                // Do≈æivotn√≠ licence se nastav√≠ na velmi vzd√°len√© datum
                today.setFullYear(today.getFullYear() + 20); 
                return today.toLocaleDateString('cs-CZ');
            }
            
            today.setDate(today.getDate() + plan.days);
            return today.toLocaleDateString('cs-CZ');
        };
        
        const calculateSimulatedIP = (serverName) => {
             const parts = serverName.match(/\((.*?)\)/);
             let base = '104.28.';
             if (parts && parts[1].includes('Praha')) base = '85.15.';
             if (parts && parts[1].includes('New York')) base = '23.227.';
             
             // Generuje n√°hodn√© posledn√≠ dva bloky
             const randomPart = Math.floor(Math.random() * 255) + '.' + Math.floor(Math.random() * 255);
             return base + randomPart;
        };
        
        const getRegisteredUsers = () => { return JSON.parse(localStorage.getItem(REGISTERED_USERS_KEY)) || {}; };
        const saveRegisteredUsers = (users) => { localStorage.setItem(REGISTERED_USERS_KEY, JSON.stringify(users)); };
        const saveCurrentUserState = () => { if (currentUser) localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser)); };
        
        // Kontrola Expirace a downgrade
        const checkLicenseExpiration = (user) => {
            if (user.isPaid && user.license_expiration_date) {
                const parts = user.license_expiration_date.split('.');
                // P≈ôevod z DD. MM. RRRR na RRRR-MM-DD pro spr√°vnou konstrukci Data
                if (parts.length === 3) {
                    const expiry = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0); 
                    
                    if (expiry < today) {
                        user.isPaid = false;
                        user.remainingAmount = SUBSCRIPTION_PLANS.one_year.discountedPrice;
                        user.license_expiration_date = null;
                        user.license_key = null; // Odstranƒõn√≠ kl√≠ƒçe
                        logActivity(`VAROV√ÅN√ç: PRO licence vypr≈°ela. P≈ôepnuto na Freemium.`, 'var(--color-danger-red)');
                        // Nealertovat automaticky, aby se to chovalo nen√°padnƒõji
                        return false; 
                    }
                }
            }
            return user.isPaid; 
        };

        const loadCurrentUserState = () => { 
             const stored = localStorage.getItem(CURRENT_USER_KEY);
             if (stored) {
                 let storedUser = JSON.parse(stored);
                 const users = getRegisteredUsers();
                 const fullUser = users[storedUser.username] || storedUser;
                 
                 currentUser = {
                     username: fullUser.username,
                     password: fullUser.password,
                     isPaid: fullUser.isPaid || false,
                     remainingAmount: fullUser.remainingAmount || DEFAULT_PRICE,
                     pinIndex: fullUser.pinIndex || 0,
                     license_expiration_date: fullUser.license_expiration_date || null,
                     currentTheme: fullUser.currentTheme || 'dark',
                     vpnIp: fullUser.vpnIp || SIMULATION_DATA.SYSTEM_INFO.LAST_IP,
                     hasBreach: fullUser.hasBreach || false,
                     threatsFound: fullUser.threatsFound || (fullUser.isPaid ? 0 : 5),
                     license_key: fullUser.license_key || null, // NOV√â: Licenƒçn√≠ kl√≠ƒç
                     scan_schedule: fullUser.scan_schedule || 'Vypnuto', // NOV√â: Pl√°n skenu
                     
                 };
                 
                 checkLicenseExpiration(currentUser);
                 saveCurrentUserState();
                 return true;
             }
             return false;
        };
        
        const switchModule = (moduleId) => {
            if (!currentUser && moduleId !== 'auth_select' && moduleId !== 'login' && moduleId !== 'register') {
                alert(_('Must_login')); 
                moduleId = 'auth_select';
            }
            // Zamyk√°n√≠ PRO modul≈Ø p≈ôi Freemium
            const isPro = currentUser ? currentUser.isPaid : false;
            // P≈ôid√°n payment_shield
            const proModules = ['scan', 'vpn', 'identity', 'optimization', 'web_shield', 'vault', 'privacy', 'backup', 'payment_shield'];
            if (!isPro && proModules.includes(moduleId) && moduleId !== 'settings') {
                 alert(`${_('lock_title')} ${_('lock_msg')}`);
                 return;
            }

            document.querySelectorAll('.module').forEach(m => m.classList.add('hidden'));
            document.getElementById(moduleId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[data-module="${moduleId}"]`) || document.getElementById('dashboard-nav');
            if (activeNav) activeNav.classList.add('active');
            
            // Speci√°ln√≠ funkce pro nov√© moduly
            if (moduleId === 'paysafe') setPaysafeModuleContent();
            if (moduleId === 'optimization') document.getElementById('optimization-content').innerHTML = generateOptimizationHtml();
            if (moduleId === 'web_shield') document.getElementById('web-shield-content').innerHTML = generateWebShieldHtml();
            if (moduleId === 'vault') document.getElementById('vault-content').innerHTML = generateVaultHtml();
            if (moduleId === 'backup') document.getElementById('backup-content').innerHTML = generateBackupHtml();
            if (moduleId === 'privacy') document.getElementById('privacy-content').innerHTML = generatePrivacyHtml();
            if (moduleId === 'settings') document.getElementById('settings-content').innerHTML = generateSettingsHtml();
            if (moduleId === 'notifications') displayNotifications();
            if (moduleId === 'scan') document.getElementById('scan-content').innerHTML = generateScanHtml();
        };

        // --- REALISTICK√ù LOG AKTIVIT ---
        // UPOZORNƒöN√ç: Odstranƒõno automatick√© p≈ôid√°v√°n√≠ do Notifikac√≠ pro bƒõ≈æn√© logy
        const logActivity = (description, color = 'var(--color-text-light)', isNotification = false) => {
            if (!currentUser) return;
            const logEntry = {
                timestamp: new Date().toLocaleDateString('cs-CZ') + ' ' + new Date().toLocaleTimeString('cs-CZ'),
                description: description,
                color: color
            };
            
            let logs = JSON.parse(localStorage.getItem(ACTIVITY_LOG_KEY)) || [];
            logs.unshift(logEntry); 
            localStorage.setItem(ACTIVITY_LOG_KEY, JSON.stringify(logs.slice(0, 50)));
            
            // Notifikace pouze pro explicitnƒõ oznaƒçen√© nebo kritick√© ud√°losti
            if (isNotification || color === 'var(--color-danger-red)') {
                addNotification(description);
            }
        };

        // --- NOTIFIKACE (Vypnuto pro bƒõ≈æn√© logy) ---
        const getNotifications = () => { return JSON.parse(localStorage.getItem(NOTIFICATIONS_KEY)) || []; };
        const saveNotifications = (notes) => { localStorage.setItem(NOTIFICATIONS_KEY, JSON.stringify(notes)); };
        
        const addNotification = (message) => {
             let notes = getNotifications();
             const newNote = {
                 message: message,
                 timestamp: new Date().toLocaleTimeString('cs-CZ'),
                 read: false
             };
             notes.unshift(newNote);
             saveNotifications(notes);
             updateNotificationUI();
        };
        
        const updateNotificationUI = () => {
             let notes = getNotifications();
             const unreadCount = notes.filter(n => !n.read).length;
             const indicator = document.getElementById('notifications-btn');
             indicator.setAttribute('data-count', unreadCount);
             
             if (unreadCount > 0) {
                 indicator.classList.add('active');
                 indicator.style.color = 'var(--color-danger-red)';
             } else {
                 indicator.classList.remove('active');
                 indicator.style.color = 'var(--text-color)';
             }
        };
        
        const displayNotifications = () => {
            let notes = getNotifications();
            const listElement = document.getElementById('notifications-list');
            const clearBtn = document.getElementById('clear-notifications-btn');
            
            if (notes.length === 0) {
                 listElement.innerHTML = `<p style="color: var(--text-muted);">≈Ω√°dn√° nov√° upozornƒõn√≠.</p>`;
                 clearBtn.disabled = true;
                 return;
            }
            
            listElement.innerHTML = notes.map(note => `
                <div class="activity-log-item" style="border: 1px solid ${note.read ? 'transparent' : 'var(--color-danger-red)'}; opacity: ${note.read ? 0.7 : 1};">
                    <p style="margin: 0;">${note.message}</p>
                    <span style="font-size: 0.7em; color: var(--text-muted);">${note.timestamp}</span>
                </div>
            `).join('');
            
            // Oznaƒçit jako p≈ôeƒçten√© p≈ôi zobrazen√≠
            notes = notes.map(n => ({ ...n, read: true }));
            saveNotifications(notes);
            updateNotificationUI();
            clearBtn.disabled = false;
        };

        const clearNotifications = () => {
             saveNotifications([]);
             displayNotifications();
             logActivity("Upozornƒõn√≠ vymaz√°na z Centra Notifikac√≠.", 'var(--color-text-light)', true);
        };

        // --- AUTENTIZACE ---
        const handleRegister = () => { 
             const regUsername = document.getElementById('reg-username').value.trim();
             const regPassword = document.getElementById('reg-password').value.trim();
             const users = getRegisteredUsers();

             if (regUsername.length < 3 || regPassword.length < 5) {
                 alert('Pros√≠m, zadejte platn√© u≈æivatelsk√© jm√©no (min 3 znaky) a heslo (min 5 znak≈Ø).');
                 return;
             }
             if (users[regUsername] || (regUsername === 'Va≈°ek')) {
                  alert(`U≈æivatelsk√© jm√©no "${regUsername}" je ji≈æ obsazeno.`);
                  return;
             }
             
             // Nastaven√≠ nov√Ωch pol√≠
             const newUser = { 
                 username: regUsername, 
                 password: regPassword, 
                 isPaid: false, 
                 remainingAmount: DEFAULT_PRICE, 
                 pinIndex: 0, 
                 license_expiration_date: null,
                 currentTheme: 'dark',
                 vpnIp: SIMULATION_DATA.SYSTEM_INFO.LAST_IP,
                 hasBreach: false,
                 threatsFound: 5,
                 license_key: null,
                 scan_schedule: 'Vypnuto'
             };
             users[regUsername] = newUser;
             saveRegisteredUsers(users);
             currentUser = newUser;
             saveCurrentUserState();
             logActivity(`Registrace nov√©ho √∫ƒçtu: ${regUsername}.`, 'var(--color-text-light)', true);
             unlockFeaturesUI('Freemium', `${_('welcome')} ${regUsername}! V√°≈° √∫ƒçet byl vytvo≈ôen.`, 'dashboard');
        };
        
        const generateLicenseKey = () => {
             // Generuje fiktivn√≠ 5x5 licenƒçn√≠ kl√≠ƒç
             const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
             let key = '';
             for (let i = 0; i < 5; i++) {
                 for (let j = 0; j < 5; j++) {
                     key += chars.charAt(Math.floor(Math.random() * chars.length));
                 }
                 if (i < 4) key += '-';
             }
             return key;
        };

        const handleLogin = () => { 
             const loginUsername = document.getElementById('login-username').value.trim();
             const loginPassword = document.getElementById('login-password').value.trim();
             const users = getRegisteredUsers();
             
             // Speci√°ln√≠ √∫ƒçet pro testov√°n√≠ PRO verze
             if (loginUsername === 'Va≈°ek' && loginPassword === 'vasek11') {
                  const existingVa≈°ek = users['Va≈°ek'];
                  let expirationDate = existingVa≈°ek ? existingVa≈°ek.license_expiration_date : null;
                  
                  if (!expirationDate || checkLicenseExpiration({ isPaid: true, license_expiration_date: expirationDate })) {
                       expirationDate = calculateExpirationDate('one_year');
                  }
                  
                  const licenseKey = existingVa≈°ek && existingVa≈°ek.license_key ? existingVa≈°ek.license_key : generateLicenseKey();

                  currentUser = { 
                      username: 'Va≈°ek', 
                      password: 'vasek11', 
                      isPaid: true, 
                      remainingAmount: 0, 
                      pinIndex: SIMULATED_PIN_VALUES.length,
                      license_expiration_date: expirationDate,
                      currentTheme: existingVa≈°ek ? existingVa≈°ek.currentTheme : 'dark',
                      vpnIp: SIMULATION_DATA.SYSTEM_INFO.LAST_IP,
                      hasBreach: false,
                      threatsFound: 0,
                      license_key: licenseKey,
                      scan_schedule: existingVa≈°ek ? existingVa≈°ek.scan_schedule : 'T√Ωdnƒõ (Nedƒõle 2:00)'
                  };
                  
                  users['Va≈°ek'] = currentUser;
                  saveRegisteredUsers(users);
                  saveCurrentUserState();
                  logActivity(`P≈ôihl√°≈°en√≠ u≈æivatele Va≈°ek (PRO licence - Testovac√≠).`, 'var(--color-text-light)', true);
                  unlockFeaturesUI('PRO', `${_('welcome')} ${currentUser.username}! PRO verze je automaticky aktivov√°na.`, 'dashboard');
                  return;
             }

             const storedUser = users[loginUsername];
             if (storedUser && storedUser.password === loginPassword) {
                  currentUser = storedUser;
                  
                  const wasPaid = currentUser.isPaid;
                  checkLicenseExpiration(currentUser);
                  
                  saveCurrentUserState();
                  const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                  const message = (wasPaid && !currentUser.isPaid) ? `Licence vypr≈°ela. ${_('welcome')} ${currentUser.username}!` : `${_('welcome')} ${currentUser.username}!`;
                  
                  logActivity(`√öspƒõ≈°n√© p≈ôihl√°≈°en√≠ u≈æivatele ${currentUser.username}.`, 'var(--color-text-light)');
                  unlockFeaturesUI(licenseType, message, 'dashboard');
                  return;
             }

             document.getElementById('login-message').innerText = 'Chyba: Neplatn√© u≈æivatelsk√© jm√©no nebo heslo.';
             document.getElementById('login-message').style.color = 'var(--color-danger-red)';
        };
        
        const handleLogout = () => { 
             logActivity(`Odhl√°≈°en√≠ u≈æivatele ${currentUser.username}.`, 'var(--color-text-light)', true);
             currentUser = null;
             isVpnConnected = false;
             if(vpnInterval) clearInterval(vpnInterval);
             localStorage.removeItem(CURRENT_USER_KEY);
             localStorage.removeItem(NOTIFICATIONS_KEY); 
             
             document.getElementById('header-username').innerText = 'Odhl√°≈°eno';
             document.getElementById('header-license-status').innerText = 'Neaktivn√≠';
             document.getElementById('header-license-status').className = 'status-inactive';
             document.getElementById('app-window').className = 'dark-mode'; 
             document.querySelectorAll('.nav-item').forEach(nav => {
                 nav.classList.add('locked'); nav.querySelector('i').innerHTML = 'üîí'; 
             });
             document.getElementById('dashboard').innerHTML = '';
             updateNotificationUI();
             switchModule('auth_select');
        };

        // --- PLATEBN√ç MODUL LOGIKA (Nov√© pl√°ny) ---
         const updateRemainingDisplay = () => {
             const remainingAmountSpan = document.getElementById('remaining-amount');
             const currentPlanKey = document.getElementById('plan-select').value;
             const price = SUBSCRIPTION_PLANS[currentPlanKey].discountedPrice;
             
             if (!remainingAmountSpan || !currentUser) return;
             
             // Nastav√≠ zb√Ωvaj√≠c√≠ ƒç√°stku k zaplacen√≠ pro vybran√Ω pl√°n
             currentUser.remainingAmount = price;
             remainingAmountSpan.innerText = currentUser.remainingAmount.toLocaleString('cs-CZ') + ' Kƒç';
             selectedPlan = currentPlanKey;
             
             const submitPinBtn = document.getElementById('submit-pin-btn');
             const paysafePinInput = document.getElementById('paysafe-pin-input');
             if (submitPinBtn) submitPinBtn.disabled = false;
             if (paysafePinInput) paysafePinInput.disabled = false;
             
             // Pokud byla zaplacena cel√° ƒç√°stka, aktivovat PRO
             if (currentUser.remainingAmount <= 0) {
                 const expirationDate = calculateExpirationDate(selectedPlan);
                 const licenseKey = generateLicenseKey();

                 currentUser.isPaid = true;
                 currentUser.license_expiration_date = expirationDate;
                 currentUser.threatsFound = 0;
                 currentUser.license_key = licenseKey;
                 
                 const users = getRegisteredUsers();
                 if (users[currentUser.username]) {
                    users[currentUser.username].isPaid = true;
                    users[currentUser.username].remainingAmount = 0;
                    users[currentUser.username].license_expiration_date = expirationDate; 
                    users[currentUser.username].threatsFound = 0;
                    users[currentUser.username].license_key = licenseKey;
                    saveRegisteredUsers(users);
                 }
                 saveCurrentUserState();
                 logActivity(`Aktivace PRO licence (${SUBSCRIPTION_PLANS[selectedPlan].name}) dokonƒçena. Platnost do ${expirationDate}.`, 'var(--color-accent-green)', true);

                 const paysafeBox = document.getElementById('paysafe-payment-box');
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);"><i class="fas fa-check-circle"></i> Platba dokonƒçena!</h3>
                    <p>Licence **Nexus PRO** na **${SUBSCRIPTION_PLANS[selectedPlan].name}** byla √∫spƒõ≈°nƒõ aktivov√°na s platnost√≠ do **${expirationDate}**.</p>
                    <button class="primary-btn" onclick="unlockFeaturesUI('PRO', 'Gratulujeme! PRO verze je aktivn√≠.', 'dashboard')">Pokraƒçovat na Dashboard</button>
                 `;
             }
         };
         
         const addLog = (message, color) => {
             const transactionLog = document.getElementById('transaction-log');
             if (!transactionLog) return;
             const p = document.createElement('p');
             p.innerHTML = `<span style="color: ${color};">‚Ä¢ ${message}</span>`;
             transactionLog.insertBefore(p, transactionLog.children[1]); 
             transactionLog.scrollTop = 0;
         };
         
         const handlePaysafePinSubmit = () => {
             const paysafePinInput = document.getElementById('paysafe-pin-input');
             const submitPinBtn = document.getElementById('submit-pin-btn');
             const pin = paysafePinInput.value.trim();
             
             if (pin.length !== 16 || !/^\d+$/.test(pin)) {
                 addLog("Chyba: PIN mus√≠ b√Ωt 16m√≠stn√© ƒç√≠slo.", "var(--color-danger-red)");
                 return;
             }
             
             if (currentUser.pinIndex >= SIMULATED_PIN_VALUES.length || currentUser.remainingAmount <= 0) {
                  addLog("Platba ji≈æ byla dokonƒçena nebo vyƒçerp√°n poƒçet testovac√≠ch PIN≈Ø.", "var(--color-accent-green)");
                  return;
             }

             submitPinBtn.disabled = true;
             paysafePinInput.disabled = true;
             addLog(`Ovƒõ≈ôov√°n√≠ PINu ${pin}...`, "var(--color-warning-yellow)");
             logActivity(`Pokus o zad√°n√≠ PINu Paysafecard (PIN #${currentUser.pinIndex + 1}).`);
             
             setTimeout(() => {
                 let pinValue = SIMULATED_PIN_VALUES[currentUser.pinIndex]; 
                 currentUser.pinIndex++;
                 
                 const amountPaid = Math.min(pinValue, currentUser.remainingAmount);
                 const refund = pinValue - amountPaid;

                 if (currentUser.remainingAmount > 0) {
                     currentUser.remainingAmount -= amountPaid;
                     
                     addLog(`PIN #${currentUser.pinIndex} ovƒõ≈ôen! Pou≈æito: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`, "var(--color-accent-green)");
                     logActivity(`Platba p≈ôijata: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`);
                     if (refund > 0) {
                          addLog(`P≈ôeplatek (${refund.toLocaleString('cs-CZ')} Kƒç) z≈Øst√°v√° na PINu.`, "var(--color-warning-yellow)");
                     }
                 } 
                 
                 updateRemainingDisplay();
                 paysafePinInput.value = '';
                 
                 if (currentUser.remainingAmount > 0) {
                     submitPinBtn.disabled = false;
                     paysafePinInput.disabled = false;
                     paysafePinInput.placeholder = "Zadejte dal≈°√≠ PIN Paysafecard";
                 }
                 saveCurrentUserState(); 

             }, 2500); 
         };
        
        const setPaysafeModuleContent = () => {
             const paysafeBox = document.getElementById('paysafe-payment-box');
             
             if (currentUser && currentUser.isPaid) {
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);"><i class="fas fa-check-circle"></i> PRO licence je aktivn√≠.</h3>
                    <p>Platnost do: <strong>${currentUser.license_expiration_date || 'Nezn√°m√© datum'}</strong>.</p>
                    <h4 style="margin-top: 20px;"><i class="fas fa-file-invoice"></i> Spr√°va P≈ôedplatn√©ho</h4>
                    <p>Licenƒçn√≠ Kl√≠ƒç: <strong>${currentUser.license_key || 'Nen√≠ definov√°n'}</strong></p>
                    <p>Typ Platby: Paysafecard (Posledn√≠ PIN: ${currentUser.pinIndex})</p>
                 `;
                 return;
             }
             
             const planOptions = Object.keys(SUBSCRIPTION_PLANS).map(key => {
                 const plan = SUBSCRIPTION_PLANS[key];
                 return `<option value="${key}">
                            ${plan.name} - ${plan.discountedPrice.toLocaleString('cs-CZ')} Kƒç 
                            (P≈Øvodn√≠: ${plan.fullPrice.toLocaleString('cs-CZ')} Kƒç)
                         </option>`;
             }).join('');


             paysafeBox.innerHTML = `
                <h4>Vybrat P≈ôedplatn√© s 5% Slevou</h4>
                <div class="form-group">
                    <select id="plan-select" onchange="updateRemainingDisplay()">
                        ${planOptions}
                    </select>
                </div>
                <div id="paysafe-status-bar" style="padding: 15px; background-color: var(--input-bg); border-radius: 8px; font-size: 1.2em; font-weight: bold; margin-bottom: 20px; transition: background-color 0.3s;">
                    Zb√Ωvaj√≠c√≠ ƒç√°stka k √∫hradƒõ: <span id="remaining-amount" class="text-remaining">${DEFAULT_PRICE.toLocaleString('cs-CZ')} Kƒç</span>
                </div>
                <div class="paysafe-input-area">
                    <input type="text" id="paysafe-pin-input" placeholder="Zadejte 16m√≠stn√Ω PIN Paysafecard" maxlength="16">
                    <button id="submit-pin-btn" class="primary-btn">Ovƒõ≈ôit PIN</button>
                </div>
                <div id="transaction-log"><p>Log transakc√≠:</p></div>
                <button class="secondary-btn" onclick="switchModule('dashboard')">Zpƒõt na Dashboard</button>
             `;
             
             document.getElementById('submit-pin-btn').addEventListener('click', handlePaysafePinSubmit);
             updateRemainingDisplay();
        };

        // --- DASHBOARD (Vylep≈°en√Ω) ---
        const calculateSecurityScore = (isPro, threats) => {
             let score = isPro ? 100 : 65;
             if (threats > 0) {
                 score -= (threats * 10);
             }
             if (!isPro && currentUser.threatsFound > 0) score = 65; 
             if (SIMULATION_DATA.SYSTEM_INFO.PATCH_DATE < new Date(new Date().setDate(new Date().getDate() - 30))) { 
                 score -= 5;
             }
             return Math.max(50, score) + '%';
        };

        const setDashboardContent = (licenseType) => {
             const isPro = licenseType === 'PRO';
             const color = currentUser.threatsFound > 0 ? 'var(--color-danger-red)' : isPro ? 'var(--color-accent-green)' : 'var(--color-danger-red)';
             const statusText = currentUser.threatsFound > 0 ? 'NEBEZPEƒå√ç! Zji≈°tƒõno naru≈°en√≠.' : isPro ? 'Optim√°ln√≠ zabezpeƒçen√≠ PRO!' : 'Vy≈æaduje okam≈æitou akci!';
             const score = calculateSecurityScore(isPro, currentUser.threatsFound);
             const buttonText = isPro ? `${_('scan_run')}` : `${_('buy_pro')}`;
             
             const dashboardModule = document.getElementById('dashboard');
             
             const licenseDetail = isPro 
                ? `
                    <p>Stav licence: <span style="color: ${color};">${_('status_active')}</span></p>
                    <p>Platnost do: <strong>${currentUser.license_expiration_date || _('unknown_date')}</strong></p>
                  ` 
                : `
                    <p>Stav licence: <span style="color: ${color};">${_('status_free')}</span></p>
                  `;
                  
            const ramUsed = SIMULATION_DATA.HW_STATS.RAM.used;
            const ramTotal = SIMULATION_DATA.HW_STATS.RAM.total;
            const batteryTemp = SIMULATION_DATA.HW_STATS.BATTERY.temp;
            
            const recommendation = currentUser.threatsFound > 0 ? 
                 `<p style="color: var(--color-danger-red); font-weight: bold; margin-top: 10px;">DOPORUƒåEN√ç: Okam≈æitƒõ spus≈•te "Opravit V≈°e" ve Skenu!</p>` :
                 isPro ? 
                 `<p style="color: var(--color-accent-blue); margin-top: 10px;">DOPORUƒåEN√ç: Zkontrolujte stav Identity Guard.</p>` :
                 `<p style="color: var(--color-warning-yellow); margin-top: 10px;">DOPORUƒåEN√ç: Kupte PRO verzi pro 100% ochranu!</p>`;
             
             const updateNeeded = SIMULATION_DATA.SYSTEM_INFO.PATCH_DATE < new Date(new Date().setDate(new Date().getDate() - 30));

             dashboardModule.innerHTML = `
                <h2><i class="fas fa-home"></i> Domovsk√° Obrazovka</h2>
                <div id="security-score-card" class="dashboard-card" style="border: 1px solid ${color}; text-align: center;">
                    <div id="score-gauge" style="border-radius: 50%; border: 8px solid ${color}; display: flex; align-items: center; justify-content: center; width: 120px; height: 120px; font-size: 2em; margin: 0 auto; color: ${color};">${score}</div>
                    <h3 style="margin-top: 15px;">Stav Syst√©mu</h3>
                    <p id="system-status-text" style="color: ${color}; font-size: 1.1em; font-weight: bold;">${statusText}</p>
                    ${recommendation}
                    <button id="start-smart-scan-dashboard" class="primary-btn" style="background-color: ${currentUser.threatsFound > 0 ? 'var(--color-danger-red)' : 'var(--color-accent-blue)'};">${buttonText}</button>
                </div>
                
                <h3 style="margin-top: 20px; font-weight: 500;"><i class="fas fa-desktop"></i> ≈Ωiv√© Statistiky</h3>
                <div class="dashboard-card">
                    <div class="stat-widget">
                         <span>RAM Vyu≈æit√≠:</span>
                         <span style="color: var(--color-accent-green);">${ramUsed}MB / ${ramTotal}MB (${((ramUsed / ramTotal) * 100).toFixed(0)}%)</span>
                    </div>
                    <div class="stat-widget">
                         <span>Teplota Baterie:</span>
                         <span style="color: var(--color-accent-green);">${batteryTemp}¬∞C</span>
                    </div>
                    <div class="stat-widget">
                         <span>Status Kernelu:</span>
                         <span style="color: ${updateNeeded ? 'var(--color-danger-red)' : 'var(--color-accent-green)'};">${updateNeeded ? 'Zastaral√Ω!' : 'Aktu√°ln√≠'}</span>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px; font-weight: 500;"><i class="fas fa-user-circle"></i> P≈ôehled √öƒçtu</h3>
                <div class="dashboard-card">
                    <p>U≈æivatel: <strong>${currentUser.username}</strong></p>
                    ${licenseDetail}
                    <p>Aktu√°ln√≠ IP: <strong style="color: var(--color-warning-yellow);">${isVpnConnected ? currentUser.vpnIp : SIMULATION_DATA.SYSTEM_INFO.LAST_IP}</strong></p>
                    <button class="secondary-btn" onclick="handleLogout()">${_('logout')}</button>
                </div>
             `;
             
             const scanBtn = document.getElementById('start-smart-scan-dashboard');
             if (scanBtn) {
                 if (isPro) {
                     scanBtn.addEventListener('click', () => {
                         switchModule('scan');
                         logActivity(`Spu≈°tƒõn Chytr√Ω Sken z Dashboardu.`);
                     });
                 } else {
                     scanBtn.addEventListener('click', () => switchModule('paysafe'));
                 }
             }
             
             const header = document.getElementById('header');
             if (currentUser.threatsFound > 0) {
                 header.style.backgroundColor = 'rgba(220, 53, 69, 0.4)'; 
             } else {
                 header.style.backgroundColor = 'var(--app-bg)'; 
             }
        };


        // --- VPN ---
        const generateVpnHtml = () => {
             const options = SIMULATION_DATA.VPN_SERVERS.map(server => 
                 `<option value="${server.replace(/\s/g, '-')}" ${server.includes('Automaticky') ? 'selected' : ''}>${server}</option>`
             ).join('');
             
             const protocols = SIMULATION_DATA.VPN_PROTOCOLS.map(protocol => 
                 `<option value="${protocol}" ${protocol.includes('WireGuard') ? 'selected' : ''}>${protocol}</option>`
             ).join('');

             return `
                <div class="dashboard-card">
                    <div>
                        <h3 id="vpn-status-header"><i class="fas fa-power-off"></i> Stav: Odpojeno</h3>
                        <p style="color: var(--text-muted);">Kliknƒõte pro zabezpeƒçen√≠ spojen√≠ a vyberte server.</p>
                        <p id="vpn-ip-display">Va≈°e IP: ${SIMULATION_DATA.SYSTEM_INFO.LAST_IP}</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Nastaven√≠ P≈ôipojen√≠</h3>
                <div class="config-group">
                    <div class="server-list">
                        <label for="vpn-protocol-select" style="display: block; margin-bottom: 5px;">Vybrat Protokol:</label>
                        <select id="vpn-protocol-select">
                            ${protocols}
                        </select>
                    </div>
                    <div class="server-list">
                        <label for="vpn-server-select" style="display: block; margin-bottom: 5px;">Vybrat Server (Geolokace):</label>
                        <select id="vpn-server-select">
                            ${options}
                        </select>
                    </div>
                </div>
                <button class="primary-btn" id="vpn-toggle">P≈ôipojit</button>
             `;
        };
        
        const simulateVpnConnection = (vpnToggleBtn) => {
             const selectedServer = document.getElementById('vpn-server-select').value.replace(/-/g, ' ');
             const selectedProtocol = document.getElementById('vpn-protocol-select').value;
             const vpnStatusHeader = document.getElementById('vpn-status-header');
             const vpnIpDisplay = document.getElementById('vpn-ip-display');
             
             if (!isVpnConnected) {
                vpnToggleBtn.disabled = true;
                vpnToggleBtn.innerText = 'Prob√≠h√° p≈ôipojov√°n√≠...';
                vpnToggleBtn.style.backgroundColor = 'var(--color-warning-yellow)';
                vpnStatusHeader.innerHTML = `<i class="fas fa-hourglass-half"></i> Stav: P≈ôipojov√°n√≠...`;
                vpnIpDisplay.innerText = 'Navazuji ≈°ifrovan√© spojen√≠...';
                
                logActivity(`Pokus o p≈ôipojen√≠ k VPN serveru: ${selectedServer} (${selectedProtocol}).`);
                
                setTimeout(() => {
                    isVpnConnected = true;
                    vpnToggleBtn.disabled = false;
                    vpnToggleBtn.innerText = 'Odpojit';
                    vpnToggleBtn.style.backgroundColor = 'var(--color-danger-red)';
                    
                    const newIp = calculateSimulatedIP(selectedServer);
                    currentUser.vpnIp = newIp;
                    saveCurrentUserState();
                    
                    vpnStatusHeader.innerHTML = `<i class="fas fa-check-circle"></i> Stav: P≈ôipojeno (${selectedServer})`;
                    vpnIpDisplay.innerText = `IP Adresa: ${newIp} (Protokol: ${selectedProtocol})`;
                    
                    logActivity(`√öspƒõ≈°nƒõ p≈ôipojeno k VPN: ${selectedServer}.`, 'var(--color-accent-green)', true);
                    setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium'); 
                    
                    // Simulace toku dat
                    let usage = 0;
                    if(vpnInterval) clearInterval(vpnInterval);
                    vpnInterval = setInterval(() => {
                        usage += Math.floor(Math.random() * 5) + 1; // 1-5 MB/s
                        // logActivity(`VPN aktivn√≠. Tok dat: ${usage} MB sta≈æeno.`, 'var(--color-text-grey)'); // Vypnuto - p≈ô√≠li≈° ƒçast√Ω log
                    }, 5000);

                }, 3500);
            } else {
                isVpnConnected = false;
                if(vpnInterval) clearInterval(vpnInterval);
                vpnToggleBtn.innerText = 'P≈ôipojit';
                vpnToggleBtn.style.backgroundColor = 'var(--color-accent-blue)';
                vpnStatusHeader.innerHTML = `<i class="fas fa-power-off"></i> Stav: Odpojeno`;
                vpnIpDisplay.innerText = `Va≈°e IP: ${SIMULATION_DATA.SYSTEM_INFO.LAST_IP}`;
                logActivity(`Odpojeno od VPN serveru: ${selectedServer}.`, 'var(--color-text-light)');
                setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium'); 
            }
        };


        // --- IDENTITY GUARD (Opraven√°) ---
        
        const generateIdentityGuardHtml = () => {
             const isPro = currentUser.isPaid;
             const items = SIMULATION_DATA.IDENTITY_ITEMS.map((item, index) => {
                 return `<div class="config-item">
                            <div class="item-info">
                                <strong>${item.name}</strong>
                                <span>Typ: ${item.type}</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="identity-${index}" ${item.defaultChecked ? 'checked' : ''} onchange="logActivity('Zmƒõnƒõno monitorov√°n√≠ pro: ${item.name}.')">
                                <span class="slider round"></span>
                            </label>
                        </div>`;
             }).join('');
             
             const isPaidContent = `<p style="margin-bottom: 20px;">Vyberte, kter√© osobn√≠ √∫daje chcete monitorovat v Dark Webu.</p>
                     ${generateBreachWarning()}
                     <div class="config-group" id="identity-checkbox-list">
                        ${items}
                     </div>
                     <button id="start-identity-protection-btn" class="primary-btn" style="margin-top: 15px;"><i class="fas fa-search-dollar"></i> Spustit Kontrolu Naru≈°en√≠</button>
                     <div id="identity-status-area" style="margin-top: 15px;">
                         <p style="color: var(--text-muted);">Kontrola je spu≈°tƒõna na pozad√≠. Kliknƒõte pro **manu√°ln√≠ spu≈°tƒõn√≠**.</p>
                     </div>
                     `;
            return isPro ? isPaidContent : `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>`;
        };

        const handleIdentityProtection = (btn) => {
            btn.disabled = true;
            btn.innerText = 'Prob√≠h√° hloubkov√° kontrola Dark Webu...';
            logActivity(`Spu≈°tƒõna manu√°ln√≠ kontrola Identity Guard.`);
            const statusArea = document.getElementById('identity-status-area');
            statusArea.innerHTML = `<p style="color: var(--color-warning-yellow);">Kontrola prob√≠h√°, ƒçekejte...</p>`;
            
            setTimeout(() => {
                btn.disabled = false;
                btn.innerText = 'Spustit Kontrolu Naru≈°en√≠';
                
                // Simulace n√°lezu naru≈°en√≠ po aktivaci (Idea 2) - men≈°√≠ ≈°ance po manu√°ln√≠ kontrole
                if (!currentUser.hasBreach && Math.random() < 0.4) { 
                    currentUser.hasBreach = true;
                    currentUser.threatsFound++;
                    saveCurrentUserState();
                    const breachMessage = `üö® **N√ÅLEZ √öNIKU DAT!** V√°≈° Prim√°rn√≠ e-mail byl nalezen v datab√°zi Dark Webu.`;
                    logActivity(breachMessage, 'var(--color-danger-red)', true);
                    alert(breachMessage + ' P≈ôejdƒõte do Identity Guard pro ≈ôe≈°en√≠.');
                    statusArea.innerHTML = generateBreachWarning();
                } else {
                     statusArea.innerHTML = `<p style="color: var(--color-accent-green); margin-top: 15px;">≈Ω√°dn√° nov√° naru≈°en√≠ nenalezena. Va≈°e data jsou v bezpeƒç√≠.</p>`;
                     logActivity(`Kontrola Identity Guard dokonƒçena. ≈Ω√°dn√° nov√° naru≈°en√≠.`, 'var(--color-accent-green)');
                }
                setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium');
            }, 5000);
        };
        
        const generateBreachWarning = () => {
             if (currentUser.hasBreach) {
                 return `
                    <div class="dashboard-card" style="border: 2px solid var(--color-danger-red); margin-top: 20px;">
                        <h3 style="color: var(--color-danger-red);"><i class="fas fa-exclamation-triangle"></i> AKCE JE VY≈ΩADOV√ÅNA!</h3>
                        <p>Byl nalezen √∫nik dat pro **Prim√°rn√≠ e-mail**.</p>
                        <button class="primary-btn" style="background-color: var(--color-danger-red);" onclick="handleSecureIdentity()">Zabezpeƒçit Nyn√≠ (Zmƒõnit Heslo)</button>
                    </div>
                 `;
             }
             return '';
        };
        
        const handleSecureIdentity = () => {
             currentUser.hasBreach = false;
             currentUser.threatsFound = Math.max(0, currentUser.threatsFound - 1); 
             saveCurrentUserState();
             logActivity(`Identita **Prim√°rn√≠ e-mail** byla √∫spƒõ≈°nƒõ zabezpeƒçena.`, 'var(--color-accent-green)', true);
             document.getElementById('identity-status-area').innerHTML = `<p style="color: var(--color-accent-green); margin-top: 15px;">√önik dat vy≈ôe≈°en! Data jsou opƒõt chr√°nƒõna.</p>`;
             document.getElementById('identity-content').innerHTML = generateIdentityGuardHtml(); // P≈ôekreslen√≠
             setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium');
        };


        // --- CHYTR√ù SKEN (Opraven√Ω) ---
        
        const generateSimulatedThreats = () => {
             let threats = [];
             
             for(let i = 0; i < currentUser.threatsFound; i++) {
                 const randomThreat = SIMULATION_DATA.SIMULATED_THREATS[i % SIMULATION_DATA.SIMULATED_THREATS.length];
                 if (!threats.some(t => t.name === randomThreat.name)) {
                      threats.push({ ...randomThreat, ignored: false, type: 'CRITICAL'});
                 }
             }

             if (Math.random() < 0.2) {
                 threats.push({ name: "SystemCore_54B.dll", type: "PUP (Potenci√°lnƒõ Ne≈æ√°douc√≠)", location: "System32", ignored: false });
             }
             
             if (SIMULATION_DATA.SYSTEM_INFO.PATCH_DATE < new Date(new Date().setDate(new Date().getDate() - 30))) { 
                 threats.push({ name: "Zastaral√Ω Kernel Patch", type: "Vulnerability", location: "OS Core", ignored: false });
             }

             return threats;
        };

        const generateScanThreatsTable = () => {
             if (simulatedThreats.length === 0) return '';
             
             const headerHtml = `
                 <div class="item-row" style="font-weight: bold; padding-bottom: 5px; border-bottom: 2px solid var(--hr-color);">
                     <span style="flex: 2;">N√°lez</span><span style="flex: 1;">Typ</span><span style="flex: 1; text-align: right;">Akce</span>
                 </div>
             `;
             
             const rowsHtml = simulatedThreats.map((threat, index) => `
                 <div class="item-row" style="color: ${threat.ignored ? 'var(--color-warning-yellow)' : 'var(--color-danger-red)'}; opacity: ${threat.ignored ? 0.7 : 1};">
                     <span style="flex: 2;">${threat.name}</span>
                     <span style="flex: 1; font-size: 0.8em;">${threat.type}</span>
                     <span style="flex: 1; text-align: right;">
                         ${threat.ignored 
                             ? '<i class="fas fa-eye-slash" style="color: var(--color-warning-yellow);"> Ignorov√°no</i>'
                             : `<button style="background: none; border: none; color: var(--color-danger-red); cursor: pointer; font-size: 0.9em;" onclick="handleScanThreatAction(${index}, 'delete')">Odstranit</button>`
                         }
                     </span>
                 </div>
             `).join('');
             
             return `
                 <div id="scan-threat-report" class="config-group" style="border: 2px solid var(--color-danger-red);">
                     <h3><i class="fas fa-bug"></i> Detailn√≠ Report Hrozeb</h3>
                     ${headerHtml}
                     ${rowsHtml}
                     <button class="secondary-btn" style="margin-top: 15px;" onclick="logActivity('Simulace exportu zpr√°vy do PDF...', 'var(--color-accent-blue)', true);">Simulovat Export Reportu (PDF)</button>
                 </div>
             `;
        };
        
        const handleScanThreatAction = (index, action) => {
             if (simulatedThreats[index].ignored) return; // Nemƒõnit ignorovan√©
             
             if (action === 'delete') {
                  const threatName = simulatedThreats[index].name;
                  
                  if (threatName.includes('SystemCore_54B.dll')) {
                       logActivity(`CHYBA SYST√âMU: Pokus o smaz√°n√≠ ${threatName} zp≈Øsobil naru≈°en√≠ syst√©mu. Vy≈æadov√°na oprava.`, 'var(--color-danger-red)', true);
                       currentUser.threatsFound = Math.max(currentUser.threatsFound + 2, 5); // Zaji≈°tƒõn√≠ kritick√©ho stavu
                       alert('Kritick√° chyba: Smaz√°n√≠ syst√©mov√©ho souboru naru≈°ilo stabiln√≠ provoz. Okam≈æitƒõ spus≈•te Opravu!');
                       simulatedThreats.splice(index, 1);
                  } else {
                       simulatedThreats.splice(index, 1);
                       logActivity(`Hrozba ${threatName} odstranƒõna.`);
                       currentUser.threatsFound = Math.max(0, currentUser.threatsFound - 1);
                  }
                  
                  saveCurrentUserState();
                  document.getElementById('scan-content').innerHTML = generateScanHtml();
                  setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium');
                  
             } 
        };

        const startScanSimulation = (isRepair = false) => {
             const scanStatus = document.getElementById('scan-status');
             const progressBar = document.getElementById('scan-fill');
             if (!scanStatus || !progressBar) return;
             
             if (isRepair) logActivity(`Spu≈°tƒõna simulace **OPRAVY** syst√©mu.`);
             else logActivity(`Spu≈°tƒõn Chytr√Ω Sken.`);
             
             document.getElementById('start-scan-secondary').disabled = true;
             if (document.getElementById('repair-all-btn')) document.getElementById('repair-all-btn').disabled = true;
             
             scanStatus.innerText = _('scan_status_running');
             progressBar.style.width = '20%';
             
             setTimeout(() => { progressBar.style.width = '70%'; }, 1000);

             setTimeout(() => {
                 progressBar.style.width = '100%';
                 
                 if (isRepair) {
                     simulatedThreats = [];
                     currentUser.threatsFound = 0;
                     scanStatus.innerText = _('repair_done');
                     logActivity(_('repair_done'), 'var(--color-accent-green)', true);
                 } else {
                     simulatedThreats = generateSimulatedThreats();
                     currentUser.threatsFound = simulatedThreats.length;
                     scanStatus.innerText = _('scan_done').replace('%s', currentUser.threatsFound);
                     if (currentUser.threatsFound > 0) addNotification(`Nalezeno ${currentUser.threatsFound} kritick√Ωch hrozeb!`);
                 }
                 
                 document.getElementById('start-scan-secondary').disabled = false;
                 if (document.getElementById('repair-all-btn')) document.getElementById('repair-all-btn').disabled = false;
                 
                 saveCurrentUserState();
                 document.getElementById('scan-content').innerHTML = generateScanHtml();
                 setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium');
                 
             }, 3000);
        };
        
        const handleScanToggleChange = (e, item) => {
             logActivity(`Zmƒõnƒõno nastaven√≠ skenov√°n√≠: ${item.name} je nyn√≠ ${e.target.checked ? 'Aktivn√≠' : 'Neaktivn√≠'}.`);
        };
        
        const handleScheduleChange = (select) => {
             currentUser.scan_schedule = select.value;
             logActivity(`Pl√°n automatick√©ho skenu nastaven na: ${select.value}.`, 'var(--color-accent-blue)');
             saveCurrentUserState();
        };

        const generateScanHtml = () => {
             const isPro = currentUser.isPaid;
             const threatsCount = currentUser.threatsFound;
             
             const scanAreasHtml = SIMULATION_DATA.SCAN_AREAS.map((item, index) => {
                 const control = `<label class="toggle-switch"><input type="checkbox" id="scan-area-${index}" ${item.default ? 'checked' : ''} onchange="handleScanToggleChange(event, '${item.name}')"><span class="slider round"></span></label>`;
                 return `<div class="config-item"><div class="item-info"><strong>${item.name}</strong></div>${control}</div>`;
             }).join('');
             
             const scheduleOptions = SIMULATION_DATA.SCAN_SCHEDULES.map(schedule => 
                `<option value="${schedule}" ${currentUser.scan_schedule === schedule ? 'selected' : ''}>${schedule}</option>`
             ).join('');
             
             const scanStatus = isPro ? `
                 <div id="scan-visuals">
                     <p>Aktu√°ln√≠ stav: <span id="scan-status">${_('scan_status_ready')}</span></p>
                     <div id="scan-progress-bar" style="height: 15px; background-color: var(--input-border); border-radius: 8px; overflow: hidden; margin: 10px 0;"><div id="scan-fill" style="height: 100%; width: 0%; background-color: var(--color-accent-blue); transition: width 0.5s;"></div></div>
                 </div>
                 <div id="scan-results" class="dashboard-card" style="margin-top: 30px;">
                     <h3>Sum√°≈ô v√Ωsledk≈Ø</h3>
                     <p>${_('threats_found')} <span id="threats-count" style="font-weight: bold; color: ${threatsCount > 0 ? 'var(--color-danger-red)' : 'var(--color-accent-green)'};">${threatsCount}</span></p>
                     ${threatsCount > 0 ? 
                         `<button id="repair-all-btn" class="primary-btn" style="background-color: var(--color-danger-red);" onclick="startScanSimulation(true)"><i class="fas fa-wrench"></i> ${_('scan_repair')}</button>` 
                         : ''}
                     <button id="start-scan-secondary" class="primary-btn" style="background-color: var(--color-accent-blue);">${_('scan_run')}</button>
                 </div>
                 ${generateScanThreatsTable()} 
                 
                 <h3 style="margin-top: 20px;"><i class="fas fa-calendar-alt"></i> Pl√°nov√°n√≠ Skenu (Nyn√≠ funkƒçn√≠)</h3>
                 <div class="config-group">
                      <p>Aktu√°lnƒõ nastaveno: <strong>${currentUser.scan_schedule}</strong></p>
                      <select onchange="handleScheduleChange(this)">
                          ${scheduleOptions}
                      </select>
                      <button class="secondary-btn" style="margin-top: 10px;" onclick="logActivity('Simulace p≈ôid√°n√≠ souboru do v√Ωjimek.')">P≈ôidat/Odebrat V√Ωjimku</button>
                 </div>

                 <h3 style="margin-top: 20px;">Typy Skenov√°n√≠ (Nyn√≠ funkƒçn√≠)</h3>
                 <div class="config-group">
                     ${scanAreasHtml}
                 </div>
             ` : `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>`;
             
             return scanStatus;
        };


        // --- MODULY DLE IDE√ç ---

        // Gener√°tor pro App Perm/Scan
        const generateConfigHtml = (items, type) => {
             return items.map((item, index) => {
                const control = `<div class="toggle-switch"><input type="checkbox" id="${type}-${index}" ${item.defaultChecked ? 'checked' : ''}><span class="slider round"></span></div>`;

                return `
                    <div class="config-item">
                        <div class="item-info">
                            <strong>${item.name}</strong>
                            ${item.desc ? `<span>${item.desc}</span>` : ''}
                        </div>
                        ${control}
                    </div>
                `;
             }).join('');
        };
        
        // MODUL OPTIMALIZACE 
        const generateOptimizationHtml = () => {
             const freedSpace = Math.floor(Math.random() * 800) + 200; 
             const processes = Math.floor(Math.random() * 10) + 5; 
             
             return `
                <div class="dashboard-card">
                    <h3><i class="fas fa-broom"></i> Akcelerace a ƒåi≈°tƒõn√≠</h3>
                    <p>Potenci√°lnƒõ zbyteƒçn√© soubory cache: **${freedSpace} MB**</p>
                    <p>Procesy na pozad√≠ zpomaluj√≠c√≠ syst√©m: **${processes}**</p>
                    <p style="color: var(--color-warning-yellow); margin-top: 10px;">Doporuƒçeno spu≈°tƒõn√≠ pro optimalizaci v√Ωkonu.</p>
                    <button class="primary-btn" id="start-optimize-btn" onclick="handleOptimization(this, ${freedSpace}, ${processes})"><i class="fas fa-angle-double-up"></i> Optimalizovat Za≈ô√≠zen√≠</button>
                </div>
                <h3 style="margin-top: 20px;">Detaily Syst√©mov√Ωch Proces≈Ø</h3>
                <div class="config-group">
                     <p>Simulovan√© **RAM** uvolnƒõn√≠: **30%**</p>
                     <p>Optimalizovan√Ω **Start-up** ƒças: **1.2s**</p>
                </div>
             `;
        };
        
        const handleOptimization = (btn, space, proc) => {
             btn.disabled = true;
             btn.innerText = "Prob√≠h√° optimalizace...";
             logActivity(`Spu≈°tƒõna optimalizace v√Ωkonu.`);
             
             setTimeout(() => {
                 btn.innerText = `Dokonƒçeno! Uvolnƒõno ${space} MB a zrychleno ${proc} proces≈Ø.`;
                 btn.style.backgroundColor = 'var(--color-accent-green)';
                 logActivity(`Optimalizace dokonƒçena. Uvolnƒõno ${space} MB.`, 'var(--color-accent-green)', true);
                 setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium'); 
                 
             }, 3000);
        };
        
        // MODUL WEB SHIELD 
        const generateWebShieldHtml = () => {
             return `
                <div class="dashboard-card">
                    <h3><i class="fas fa-link"></i> Kontrola Phishingu v Re√°ln√©m ƒåase</h3>
                    <p style="color: var(--text-muted);">Zadejte URL adresu, kterou chcete ovƒõ≈ôit, zda nen√≠ podvodn√° nebo nebezpeƒçn√°.</p>
                    <input type="text" id="url-input" placeholder="Zadejte celou URL adresu (nap≈ô. https://banka.cz)">
                    <button class="primary-btn" id="check-url-btn" onclick="handleUrlCheck()"><i class="fas fa-search"></i> Zkontrolovat URL</button>
                    <div id="url-result" style="margin-top: 15px;"></div>
                </div>
                <h3 style="margin-top: 20px;">Nastaven√≠ ≈†t√≠tu</h3>
                <div class="config-group">
                     <div class="config-item">
                         <div class="item-info"><strong>Blokov√°n√≠ Malwarov√Ωch Str√°nek</strong></div>
                         <label class="toggle-switch"><input type="checkbox" checked><span class="slider round"></span></label>
                     </div>
                     <div class="config-item">
                         <div class="item-info"><strong>Kontrola HTTPS certifik√°t≈Ø</strong></div>
                         <label class="toggle-switch"><input type="checkbox" checked><span class="slider round"></span></label>
                     </div>
                </div>
             `;
        };
        
        const handleUrlCheck = () => {
             const url = document.getElementById('url-input').value.trim().toLowerCase();
             const resultDiv = document.getElementById('url-result');
             const btn = document.getElementById('check-url-btn');
             
             if (!url) return;
             
             btn.disabled = true;
             btn.innerText = "Analyzuji...";
             
             setTimeout(() => {
                 btn.disabled = false;
                 btn.innerText = "Zkontrolovat URL";
                 
                 const risk = SIMULATION_DATA.PHISHING_URLS[url] || (Math.random() < 0.1 && !url.includes('banka.cz') && !url.includes('google.com'));
                 
                 if (risk) {
                     resultDiv.innerHTML = `<p style="color: var(--color-danger-red); font-weight: bold;"><i class="fas fa-times-circle"></i> DETEKCE: Kritick√© riziko Phishingu! Adresa byla zablokov√°na.</p>`;
                     logActivity(`Kritick√° detekce Phishingu na URL: ${url}.`, 'var(--color-danger-red)', true);
                     currentUser.threatsFound = Math.max(1, currentUser.threatsFound + 1);
                 } else {
                     resultDiv.innerHTML = `<p style="color: var(--color-accent-green); font-weight: bold;"><i class="fas fa-check-circle"></i> BEZPEƒåN√â: URL je d≈Øvƒõryhodn√°.</p>`;
                     logActivity(`URL ${url} oznaƒçena jako bezpeƒçn√°.`);
                 }
                 setDashboardContent(currentUser.isPaid ? 'PRO' : 'Freemium');
             }, 2000);
        };

        // MODUL TREZOR 
        const generateVaultHtml = () => {
             return `
                <div class="dashboard-card">
                    <h3><i class="fas fa-key"></i> ${_('vault_title')}</h3>
                    <p style="color: var(--text-muted);">${_('vault_desc')}</p>
                    
                    <h4 style="margin-top: 20px;">Ulo≈æen√© polo≈æky</h4>
                    <div class="config-group" style="padding: 10px;">
                        <div class="item-row"><span>Heslo pro E-mail</span><span style="color: var(--color-accent-green);">Aktivn√≠</span></div>
                        <div class="item-row"><span>ƒå√≠slo Pasu (Sken)</span><span style="color: var(--color-accent-green);">Aktivn√≠</span></div>
                        <div class="item-row"><span>Heslo pro Soci√°ln√≠ S√≠≈•</span><span style="color: var(--color-accent-green);">Aktivn√≠</span></div>
                    </div>
                    
                    <input type="password" id="vault-master-password" placeholder="Zadejte Master Heslo pro odemƒçen√≠">
                    <button class="primary-btn" onclick="logActivity('Pokus o odemƒçen√≠ trezoru.')"><i class="fas fa-unlock"></i> Odemknout Trezor</button>
                    
                    <button class="secondary-btn" onclick="logActivity('Simulace p≈ôid√°n√≠ nov√© polo≈æky do Trezoru.')" style="margin-top: 10px;">P≈ôidat Novou Polo≈æku</button>
                </div>
             `;
        };
        
        // MODUL Z√ÅLOHOV√ÅN√ç 
        const generateBackupHtml = () => {
             return `
                <div class="dashboard-card">
                    <h3><i class="fas fa-cloud-upload-alt"></i> Cloudov√° Z√°loha</h3>
                    <p>Stav: **Posledn√≠ z√°loha probƒõhla 20. 11. 2025**</p>
                    <p>Velikost: **1.8 GB**</p>
                    <button class="primary-btn" id="start-backup-btn" onclick="handleBackup(this)"><i class="fas fa-cloud-upload-alt"></i> Spustit Novou Z√°lohu</button>
                    
                    <h4 style="margin-top: 20px;">Historie Z√°loh</h4>
                    <div class="config-group" style="padding: 10px;">
                        <div class="item-row"><span>20. 11. 2025 (1.8 GB)</span><button style="background: none; border: none; color: var(--color-accent-blue); cursor: pointer;" onclick="logActivity('Spu≈°tƒõna simulace obnovy dat.')">Obnovit</button></div>
                        <div class="item-row"><span>05. 11. 2025 (1.7 GB)</span><button style="background: none; border: none; color: var(--color-accent-blue); cursor: pointer;">Obnovit</button></div>
                    </div>
                </div>
             `;
        };
        
        const handleBackup = (btn) => {
             btn.disabled = true;
             btn.innerText = "Prob√≠h√° z√°lohov√°n√≠... (12% kompletn√≠)";
             logActivity(`Spu≈°tƒõno Cloudov√© Z√°lohov√°n√≠.`);
             
             setTimeout(() => {
                 btn.innerText = "Dokonƒçeno! (100% kompletn√≠)";
                 btn.style.backgroundColor = 'var(--color-accent-green)';
                 logActivity(`Z√°lohov√°n√≠ dokonƒçeno.`, 'var(--color-accent-green)', true);
             }, 4000);
        };

        // MODUL OCHRANA SOUKROM√ç 
        const generatePrivacyHtml = () => {
            const appHtml = SIMULATION_DATA.APP_PERMISSIONS.map((app, index) => {
                 const currentPermission = app.permissions.join(', ');
                 const isHighRisk = app.type === 'Malware';
                 const isRestricted = app.restricted;
                 
                 const status = isHighRisk ? 
                    `<span style="color: var(--color-danger-red); font-weight: bold;"><i class="fas fa-exclamation-triangle"></i> VYSOK√â RIZIKO</span>` : 
                    `<span style="color: var(--color-warning-yellow);">Norm√°ln√≠ Riziko</span>`;

                 return `
                    <div class="config-item" style="flex-direction: column; align-items: flex-start;">
                        <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
                            <strong>${_('app_perm_title')}: ${app.name}</strong>
                            ${status}
                        </div>
                        <span style="font-size: 0.8em; color: var(--text-muted);">Opr√°vnƒõn√≠: ${currentPermission}</span>
                        <button class="secondary-btn" style="width: auto; margin-top: 5px; background-color: ${isRestricted ? 'var(--color-accent-green)' : 'var(--input-border)'};" 
                            onclick="handlePermissionToggle(this, '${app.name}', ${index})">
                            ${isRestricted ? _('app_perm_toggle_on') : _('app_perm_toggle')}
                        </button>
                    </div>
                 `;
             }).join('');
             
             return `
                <div class="dashboard-card">
                    <h3><i class="fas fa-lock"></i> ${_('app_perm_scan')}</h3>
                    <p style="color: var(--text-muted);">${_('app_perm_info')}</p>
                </div>
                
                <h3 style="margin-top: 20px;">Detaily Opr√°vnƒõn√≠ (Nyn√≠ funkƒçn√≠)</h3>
                <div class="config-group">
                    ${appHtml}
                </div>
                <h3 style="margin-top: 20px;">Wi-Fi Security Scan (PRO)</h3>
                <div class="config-group">
                     <p>Status: **S√≠≈• je chr√°nƒõna (WPA3)**</p>
                     <button class="secondary-btn">Spustit s√≠≈•ov√Ω test</button>
                </div>
             `;
        };
        
        const handlePermissionToggle = (btn, appName, index) => {
             const newRestrictedState = !SIMULATION_DATA.APP_PERMISSIONS[index].restricted;
             SIMULATION_DATA.APP_PERMISSIONS[index].restricted = newRestrictedState;
             
             if (newRestrictedState) {
                 btn.innerText = _('app_perm_toggle_on');
                 btn.style.backgroundColor = 'var(--color-accent-green)';
                 logActivity(`Omezen p≈ô√≠stup pro aplikaci: ${appName}.`, 'var(--color-accent-green)');
             } else {
                 btn.innerText = _('app_perm_toggle');
                 btn.style.backgroundColor = 'var(--input-border)';
                 logActivity(`Obnoven p≈ô√≠stup pro aplikaci: ${appName}.`);
             }
        };
        
        // --- PROFIL A HISTORIE (Vylep≈°en√©) ---
        
        const handleLanguageSwitch = (select) => {
             currentLang = select.value;
             logActivity(`Jazyk p≈ôepnut na: ${select.options[select.selectedIndex].text}.`, 'var(--color-accent-blue)');
             unlockFeaturesUI(currentUser.isPaid ? 'PRO' : 'Freemium', null, 'settings'); 
        };

        const handleThemeSwitch = () => {
             const appWindow = document.getElementById('app-window');
             const themeToggleIcon = document.querySelector('#theme-toggle-btn i');
             
             if (appWindow.classList.contains('dark-mode')) {
                 appWindow.classList.remove('dark-mode');
                 appWindow.classList.add('light-mode');
                 currentUser.currentTheme = 'light';
                 themeToggleIcon.className = 'fas fa-sun';
                 logActivity("T√©ma p≈ôepnuto na: Svƒõtl√Ω re≈æim.", 'var(--color-text-dark)');
             } else {
                 appWindow.classList.remove('light-mode');
                 appWindow.classList.add('dark-mode');
                 currentUser.currentTheme = 'dark';
                 themeToggleIcon.className = 'fas fa-moon';
                 logActivity("T√©ma p≈ôepnuto na: Tmav√Ω re≈æim.", 'var(--color-text-light)');
             }
             saveCurrentUserState();
        };

        const generateSettingsHtml = () => {
            const logs = JSON.parse(localStorage.getItem(ACTIVITY_LOG_KEY)) || [];
            
            const logHtml = logs.length > 0
                ? logs.map(log => `<div class="activity-log-item" style="color: ${log.color};"><strong>${log.timestamp}</strong>: ${log.description}</div>`).join('')
                : `<div class="activity-log-item" style="color: var(--text-muted);">≈Ω√°dn√° zaznamenan√° aktivita.</div>`;
                
            const expirationInfo = currentUser.isPaid 
                ? `<p>PRO Licence platn√° do: <strong style="color: var(--color-accent-green);">${currentUser.license_expiration_date || 'Nezn√°m√© datum'}</strong></p>` 
                : `<p>Licence: <strong style="color: var(--color-danger-red);">Freemium</strong>. <a href="#" onclick="switchModule('paysafe')">P≈ôej√≠t na PRO.</a></p>`;

            return `
                <h3 style="margin-top: 0;"><i class="fas fa-user"></i> Spr√°va Profilu</h3>
                <div class="config-group">
                    <p>U≈æivatelsk√© jm√©no: <strong>${currentUser.username}</strong></p>
                    ${expirationInfo}
                    ${currentUser.isPaid ? `<p>Licenƒçn√≠ kl√≠ƒç: <strong style="color: var(--color-warning-yellow);">${currentUser.license_key || 'N/A'}</strong></p>` : ''}
                    <p>Heslo: <span style="color: var(--color-warning-yellow);">** Skryto pro bezpeƒçnost **</span></p>
                    <button class="secondary-btn" style="margin-top: 10px;" onclick="logActivity('Zmƒõna hesla simulov√°na.')"><i class="fas fa-lock"></i> Zmƒõnit Heslo</button>
                </div>
                
                <h3 style="margin-top: 20px;"><i class="fas fa-info-circle"></i> Technick√© Informace</h3>
                <div class="config-group">
                    <p>Kernel Verze: <strong>${SIMULATION_DATA.SYSTEM_INFO.KERNEL_VERSION}</strong></p>
                    <p>Posledn√≠ Patch: <strong style="color: ${SIMULATION_DATA.SYSTEM_INFO.PATCH_DATE < new Date(new Date().setDate(new Date().getDate() - 30)) ? 'var(--color-danger-red)' : 'var(--color-accent-green)'};">${SIMULATION_DATA.SYSTEM_INFO.PATCH_DATE.toLocaleDateString('cs-CZ')}</strong></p>
                    <p>K√≥d Karant√©ny: <strong>${SIMULATION_DATA.SYSTEM_INFO.QUARANTINE_CODE}</strong></p>
                </div>
                
                <h3 style="margin-top: 20px;"><i class="fas fa-palette"></i> Vzhled a Jazyk</h3>
                <div class="config-group">
                     <p>Aktu√°ln√≠ T√©ma: <strong>${currentUser.currentTheme === 'dark' ? 'Tmav√©' : 'Svƒõtl√©'}</strong></p>
                     <p>P≈ôepnout Jazyk:</p>
                     <select onchange="handleLanguageSwitch(this)">
                        <option value="cs" ${currentLang === 'cs' ? 'selected' : ''}>ƒåe≈°tina</option>
                        <option value="en" ${currentLang === 'en' ? 'selected' : ''}>English</option>
                     </select>
                </div>

                <h3 style="margin-top: 20px;"><i class="fas fa-history"></i> Historie Aktivity</h3>
                <div class="config-group">
                    ${logHtml}
                </div>
                <button class="secondary-btn" onclick="clearActivityLog()"><i class="fas fa-eraser"></i> Vyƒçistit log aktivity</button>
            `;
        };

        const clearActivityLog = () => {
            if (confirm("Opravdu chcete vyƒçistit cel√Ω log aktivity? Tato akce je nevratn√°.")) {
                localStorage.removeItem(ACTIVITY_LOG_KEY);
                logActivity("Log aktivity vyƒçi≈°tƒõn u≈æivatelem.");
                document.getElementById('settings-content').innerHTML = generateSettingsHtml();
            }
        };
        
        // --- HLAVN√ç FUNKCE PRO AKTIVACI ---
        
        const makeFunctional = (isPro) => {
            
            const modulesConfig = {
                'scan': { proHtml: generateScanHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'vpn': { proHtml: generateVpnHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'identity': { proHtml: generateIdentityGuardHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'optimization': { proHtml: generateOptimizationHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'web_shield': { proHtml: generateWebShieldHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'vault': { proHtml: generateVaultHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'backup': { proHtml: generateBackupHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'privacy': { proHtml: generatePrivacyHtml(), freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'payment_shield': { proHtml: document.getElementById('payment-shield-content').innerHTML, freemiumHtml: `<p style="color: var(--color-danger-red);">${_('lock_title')} ${_('lock_msg')}</p><button class="secondary-btn" onclick="switchModule('paysafe')">${_('buy_pro')}</button>` },
                'settings': { proHtml: generateSettingsHtml(), freemiumHtml: generateSettingsHtml() } 
            };

            for (const moduleId in modulesConfig) {
                const moduleContentDiv = document.getElementById(`${moduleId}-content`);
                if (moduleContentDiv) {
                    // Speci√°ln√≠ o≈°et≈ôen√≠ pro modul payment_shield (obsah je definov√°n p≈ô√≠mo v HTML, zde pouze obal√≠me pro freemium)
                    if (moduleId === 'payment_shield' && !isPro) {
                         moduleContentDiv.innerHTML = modulesConfig[moduleId].freemiumHtml;
                    } else if (moduleId !== 'payment_shield') {
                         moduleContentDiv.innerHTML = isPro ? modulesConfig[moduleId].proHtml : modulesConfig[moduleId].freemiumHtml;
                    }
                }
            }

            // P≈ôipojen√≠ handler≈Ø pro PRO funkce
            if (isPro) {
                const vpnToggle = document.getElementById('vpn-toggle');
                if (vpnToggle) vpnToggle.addEventListener('click', () => simulateVpnConnection(vpnToggle));
                
                const scanBtnSecondary = document.getElementById('start-scan-secondary');
                if (scanBtnSecondary) scanBtnSecondary.addEventListener('click', () => startScanSimulation(false));
                
                const identityProtectionBtn = document.getElementById('start-identity-protection-btn');
                if (identityProtectionBtn) identityProtectionBtn.addEventListener('click', () => handleIdentityProtection(identityProtectionBtn));
            }
        };

        const unlockFeaturesUI = (licenseType, message, targetModuleId) => {
            const isPro = licenseType === 'PRO';
            
            // Nastaven√≠ T√©ma
            const appWindow = document.getElementById('app-window');
            appWindow.className = currentUser.currentTheme + '-mode';
            document.querySelector('#theme-toggle-btn i').className = currentUser.currentTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';

            // 1. Nastaven√≠ Hlaviƒçky
            document.getElementById('header-username').innerText = currentUser.username;
            document.getElementById('header-license-status').innerText = isPro ? _('paid_active') : _('freemium_active');
            document.getElementById('header-license-status').className = isPro ? 'status-active' : 'status-inactive';

            // 2. Nastaven√≠ Navigace (z√°mky)
            document.querySelectorAll('.nav-item').forEach(nav => {
                const navModule = nav.getAttribute('data-module');
                
                // Dashboard a Settings jsou dostupn√© v≈ædy
                if (navModule === 'dashboard' || navModule === 'settings') { 
                    nav.classList.remove('locked'); 
                    const icons = { 'dashboard': 'fas fa-home', 'settings': 'fas fa-cogs' };
                    nav.querySelector('i').className = icons[navModule];
                    return; 
                }
                
                if (isPro) { 
                    nav.classList.remove('locked');
                    const icons = { 
                        'scan': 'fas fa-rocket', 'vpn': 'fas fa-globe', 
                        'identity': 'fas fa-user-shield', 'optimization': 'fas fa-tachometer-alt', 
                        'web_shield': 'fas fa-shield-alt', 'vault': 'fas fa-lock',
                        'payment_shield': 'fas fa-money-check-alt'
                    };
                    nav.querySelector('i').className = icons[navModule] || 'fas fa-check';
                } else {
                    nav.classList.add('locked');
                    nav.querySelector('i').className = 'fas fa-lock';
                }
            });
            
            // 3. Nastaven√≠ Modul≈Ø
            setPaysafeModuleContent(); 
            setDashboardContent(licenseType);
            makeFunctional(isPro); 
            updateNotificationUI();

            if (message) alert(message);
            switchModule(targetModuleId);
        };
        
        // --- INICIALIZACE ---
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // P≈Øvodn√≠ handlery
            document.getElementById('show-login-btn').addEventListener('click', () => switchModule('login'));
            document.getElementById('show-register-btn').addEventListener('click', () => switchModule('register'));
            document.getElementById('register-btn').addEventListener('click', handleRegister);
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // P≈Øvodn√≠ navigaƒçn√≠ handlery
            document.querySelectorAll('#bottom-nav .nav-item').forEach(nav => {
                nav.addEventListener('click', (e) => {
                    e.preventDefault();
                    const moduleId = e.currentTarget.getAttribute('data-module');
                    if (e.currentTarget.classList.contains('locked') && (!currentUser || !currentUser.isPaid) && moduleId !== 'settings') { 
                        alert(`${_('lock_title')} ${_('lock_msg')}`);
                    } else {
                        switchModule(moduleId);
                    }
                });
            });

            // Hlavn√≠ spu≈°tƒõn√≠ aplikace
            loadCurrentUserState();

            if (currentUser) {
                const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                unlockFeaturesUI(licenseType, null, 'dashboard');
            } else {
                switchModule('auth_select');
            }
        });
        
        // --- DƒöDICTV√ç P≈ÆVODN√çCH FUNKC√ç (Nesm√≠ b√Ωt odstranƒõny) ---
        const generateVpnServerHtml = () => { /* P≈Øvodn√≠ V8.7 - Funkce pro V8.7, nyn√≠ obsa≈æena v generateVpnHtml */ return ''; };
    </script>
</body>
</html>
