<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Nexus Prime Security - V8.5 (Plnƒõ Funkƒçn√≠ Kybernetick√° Obrana)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* --- CSS STYLING --- */
        :root {
            --color-dark-bg: #1e1e2c; 
            --color-darker-bg: #151520; 
            --color-accent-blue: #007bff; 
            --color-accent-green: #28a745; 
            --color-danger-red: #dc3545;
            --color-warning-yellow: #ffc107;
            --color-text-light: #f0f0f5;
            --color-text-grey: #a0a0b0;
            --color-border: #303040;
        }

        body {
            background-color: var(--color-darker-bg); 
            color: var(--color-text-light);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #app-window {
            width: 400px; 
            height: 700px; 
            background-color: var(--color-dark-bg);
            border-radius: 25px; 
            box-shadow: 0 20px 50px rgba(0 0 0 / 50%), 0 0 0 10px #000; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* HLAVIƒåKA */
        #header {
            background-color: var(--color-darker-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            color: var(--color-text-light);
            font-size: 1.4em;
            font-weight: 700;
        }
        #profile-btn {
            background: none;
            border: none;
            color: var(--color-text-light);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        #profile-btn:hover { color: var(--color-accent-blue); }
        
        #user-info-status {
             font-size: 0.8em;
             line-height: 1.3;
             text-align: right;
        }
        .status-inactive { color: var(--color-danger-red); } 
        .status-active { color: var(--color-accent-green); font-weight: bold; } 

        /* OBSAHOV√Å OBLAST */
        #content-area {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; 
            padding-bottom: 80px; 
        }
        .module { animation: fadeIn 0.5s; }
        .module.hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { color: var(--color-text-light); border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 20px; font-weight: 500; font-size: 1.4em;}
        
        .primary-btn, .secondary-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%; 
            box-sizing: border-box;
            margin-bottom: 10px;
            transition: background-color 0.2s;
        }
        .primary-btn {
            background-color: var(--color-accent-blue);
            color: white;
            font-size: 1.1em;
            margin-top: 15px;
        }
        .secondary-btn {
            background-color: var(--color-border);
            color: var(--color-text-light);
            margin-top: 15px;
        }
        
        /* Formul√°≈ôe */
        .auth-form-container {
             background-color: #2a2a3b;
             padding: 30px 20px;
             border-radius: 12px;
             margin-top: 30px;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            background-color: var(--color-darker-bg);
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        /* NAVIGACE */
        #bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background-color: var(--color-darker-bg);
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 5px 0;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--color-text-grey);
            font-size: 0.75em;
            flex: 1;
            cursor: pointer;
        }
        .nav-item.active { color: var(--color-accent-blue); }
        .nav-item.locked { opacity: 0.6; color: var(--color-danger-red); cursor: not-allowed; }
        .nav-item i { font-size: 1.5em; margin-bottom: 3px; }

        /* --- STYLY PRO KONFIGURACE (Cyber Defense, Identity, Scan) --- */
        .config-group {
             background-color: #2a2a3b;
             padding: 15px;
             border-radius: 10px;
             margin-bottom: 20px;
        }
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #303040;
        }
        .config-item:last-child { border-bottom: none; }
        .item-info strong { display: block; }
        .item-info span { font-size: 0.8em; color: var(--color-text-grey); }
        .config-item:hover { background-color: #35354a; border-radius: 5px; padding: 10px; margin: -5px 0;}

        /* Toggle/Checkbox styly */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 25px;
        }
        .toggle-switch input { display: none; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--color-border); transition: 0.4s; border-radius: 25px;
        }
        .slider:before {
            position: absolute; content: ""; height: 19px; width: 19px; left: 3px; bottom: 3px;
            background-color: var(--color-text-light); transition: 0.4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--color-accent-green); }
        input:checked + .slider:before { transform: translateX(20px); }
        
        /* Historie */
        .activity-log-item {
            background-color: var(--color-darker-bg);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .activity-log-item strong { color: var(--color-accent-blue); }
        
        /* VPN servery */
        .server-list select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            background-color: var(--color-darker-bg);
            color: var(--color-text-light);
            border-radius: 6px;
            margin-top: 10px;
        }

    </style>
</head>
<body>

    <div id="app-window">
        <header id="header">
             <h1 class="logo">Nexus Prime Security</h1>
             <div style="display: flex; align-items: center;">
                 <div id="user-info-status">
                     <span id="header-username">Odhl√°≈°eno</span><br>
                     <span id="header-license-status" class="status-inactive">Neaktivn√≠</span>
                 </div>
                 <button id="profile-btn">
                    üë§
                 </button>
             </div>
        </header>

        <main id="content-area">
            
            <div id="auth_select" class="module hidden">
                <h2>V√≠tejte v Nexus Prime</h2>
                <p style="color: var(--color-text-grey); margin-bottom: 20px;">Zabezpeƒçte sv√© mobiln√≠ za≈ô√≠zen√≠. Pro p≈ô√≠stup k ochranƒõ se p≈ôihlaste nebo vytvo≈ôte nov√Ω √∫ƒçet.</p>
                <div class="auth-form-container">
                    <button id="show-login-btn" class="primary-btn">P≈ôihl√°sit se k √∫ƒçtu</button>
                    <button id="show-register-btn" class="secondary-btn">Vytvo≈ôit √öƒçet</button>
                </div>
            </div>

            <div id="login" class="module hidden">
                <h2>üë§ P≈ôihl√°≈°en√≠ k √∫ƒçtu</h2>
                <div class="auth-form-container">
                    <p id="login-message" style="margin-bottom: 20px; color: var(--color-text-grey);">Zadejte sv√© u≈æivatelsk√© jm√©no a heslo:</p>
                    <div id="login-form">
                        <input type="text" id="login-username" placeholder="U≈æivatelsk√© jm√©no">
                        <input type="password" id="login-password" placeholder="Heslo">
                        <button id="login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                        <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                    </div>
                </div>
            </div>
            
            <div id="register" class="module hidden">
                 <h2>üîë Vytvo≈ôen√≠ Nov√©ho √öƒçtu</h2>
                 <div class="auth-form-container">
                     <p style="margin-bottom: 20px;">Z√≠skejte p≈ô√≠stup k funkc√≠m Freemium verze.</p>
                     <div id="register-form">
                         <input type="text" id="reg-username" placeholder="U≈æivatelsk√© jm√©no">
                         <input type="password" id="reg-password" placeholder="Heslo">
                         <button id="register-btn" class="primary-btn">Vytvo≈ôit √öƒçet a P≈ôihl√°sit se</button>
                         <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                     </div>
                 </div>
            </div>
            
            <div id="dashboard" class="module hidden">
                </div>
            
            <div id="paysafe" class="module hidden">
                <h2>üí≥ Aktivace PRO Verze</h2>
                <div id="paysafe-payment-box" style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    </div>
            </div>
            
            <div id="scan" class="module hidden">
                <h2>üöÄ Chytr√Ω Sken</h2>
                <div id="scan-content" class="premium-feature"></div>
            </div>
            
            <div id="cyber_defense" class="module hidden">
                 <h2>üõ°Ô∏è Kybernetick√° Obrana</h2>
                 <div id="cyber-content" class="premium-feature">
                     </div>
            </div>
            
            <div id="vpn" class="module hidden">
                <h2>üåê VPN Prime</h2>
                <div id="vpn-content" class="premium-feature"></div>
            </div>
            
            <div id="identity" class="module hidden">
                 <h2>üïµÔ∏è Identity Guard</h2>
                <div id="identity-content" class="premium-feature">
                     </div>
            </div>
            
            <div id="settings" class="module hidden">
                <h2>‚öôÔ∏è Profil a Historie</h2>
                <div id="settings-content" class="premium-feature">
                    </div>
            </div>

        </main>
        
        <nav id="bottom-nav">
            <a href="#" class="nav-item active" data-module="dashboard" id="dashboard-nav">
                <i style="font-style: normal;">üè†</i> Home
            </a>
            <a href="#" class="nav-item locked" data-module="scan" id="scan-nav">
                <i style="font-style: normal;">‚ú®</i> Sken
            </a>
            <a href="#" class="nav-item locked" data-module="cyber_defense" id="cyber-nav">
                <i style="font-style: normal;">üîí</i> Obrana
            </a>
            <a href="#" class="nav-item locked" data-module="vpn" id="vpn-nav">
                <i style="font-style: normal;">üîí</i> VPN
            </a>
            <a href="#" class="nav-item locked" data-module="identity" id="identity-nav">
                <i style="font-style: normal;">üîí</i> Identity
            </a>
             <a href="#" class="nav-item locked" data-module="settings" id="settings-nav">
                <i style="font-style: normal;">üîí</i> Profil
            </a>
        </nav>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIKA --- */
        const CURRENT_USER_KEY = 'nexusPrimeCurrentUser';
        const REGISTERED_USERS_KEY = 'nexusPrimeRegisteredUsers';
        const ACTIVITY_LOG_KEY = 'nexusPrimeActivityLog';
        const PRO_PRICE = 7999;
        const SIMULATED_PIN_VALUES = [3610, 3610, 779]; 

        let currentUser = null;
        
        // --- POMOCN√â FUNKCE A TRVALOST DAT ---
        const getRegisteredUsers = () => { return JSON.parse(localStorage.getItem(REGISTERED_USERS_KEY)) || {}; };
        const saveRegisteredUsers = (users) => { localStorage.setItem(REGISTERED_USERS_KEY, JSON.stringify(users)); };
        const saveCurrentUserState = () => { if (currentUser) localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser)); };
        const loadCurrentUserState = () => { 
             const stored = localStorage.getItem(CURRENT_USER_KEY);
             if (stored) {
                 const storedUser = JSON.parse(stored);
                 const users = getRegisteredUsers();
                 const fullUser = users[storedUser.username] || storedUser;
                 
                 currentUser = {
                     ...fullUser,
                     isPaid: storedUser.username === 'Va≈°ek' ? true : fullUser.isPaid || false,
                     remainingAmount: storedUser.username === 'Va≈°ek' ? 0 : storedUser.remainingAmount || PRO_PRICE,
                     pinIndex: storedUser.username === 'Va≈°ek' ? SIMULATED_PIN_VALUES.length : storedUser.pinIndex || 0,
                     password: fullUser.password || 'vasek11' 
                 };
                 return true;
             }
             return false;
        };
        const switchModule = (moduleId) => {
            if (!currentUser && moduleId !== 'auth_select' && moduleId !== 'login' && moduleId !== 'register') {
                alert('Mus√≠te se nejprve p≈ôihl√°sit.');
                moduleId = 'auth_select';
            }
            document.querySelectorAll('.module').forEach(m => m.classList.add('hidden'));
            document.getElementById(moduleId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            const activeNav = document.querySelector(`.nav-item[data-module="${moduleId}"]`) || document.getElementById('dashboard-nav');
            if (activeNav) activeNav.classList.add('active');
        };

        // --- REALISTICK√ù LOG AKTIVIT ---
        const logActivity = (description) => {
            if (!currentUser) return;
            const logEntry = `<strong>${new Date().toLocaleDateString('cs-CZ')} ${new Date().toLocaleTimeString('cs-CZ')}</strong>: ${description}`;
            
            let logs = JSON.parse(localStorage.getItem(ACTIVITY_LOG_KEY)) || [];
            logs.unshift(logEntry); 
            // Omezen√≠ logu na 50 z√°znam≈Ø pro p≈ôehlednost
            localStorage.setItem(ACTIVITY_LOG_KEY, JSON.stringify(logs.slice(0, 50)));
        };

        const clearActivityLog = () => {
            if (confirm("Opravdu chcete vyƒçistit cel√Ω log aktivity? Tato akce je nevratn√°.")) {
                localStorage.removeItem(ACTIVITY_LOG_KEY);
                logActivity("Log aktivity vyƒçi≈°tƒõn u≈æivatelem.");
                // P≈ôenaƒçten√≠ sekce Profilu, aby se zmƒõna projevila
                document.getElementById('settings-content').innerHTML = generateSettingsHtml();
            }
        };


        // --- AUTENTIZACE ---
        const handleRegister = () => { 
             const regUsername = document.getElementById('reg-username').value.trim();
             const regPassword = document.getElementById('reg-password').value.trim();
             const users = getRegisteredUsers();

             if (regUsername.length < 3 || regPassword.length < 5) {
                 alert('Pros√≠m, zadejte platn√© u≈æivatelsk√© jm√©no (min 3 znaky) a heslo (min 5 znak≈Ø).');
                 return;
             }
             if (users[regUsername] || (regUsername === 'Va≈°ek')) {
                  alert(`U≈æivatelsk√© jm√©no "${regUsername}" je ji≈æ obsazeno.`);
                  return;
             }
             
             const newUser = { username: regUsername, password: regPassword, isPaid: false, remainingAmount: PRO_PRICE, pinIndex: 0 };
             users[regUsername] = newUser;
             saveRegisteredUsers(users);
             currentUser = newUser;
             saveCurrentUserState();
             logActivity(`Registrace nov√©ho √∫ƒçtu: ${regUsername}.`);
             unlockFeaturesUI('Freemium', `V√≠tejte, ${regUsername}! V√°≈° √∫ƒçet byl vytvo≈ôen.`, 'dashboard');
        };
        
        const handleLogin = () => { 
             const loginUsername = document.getElementById('login-username').value.trim();
             const loginPassword = document.getElementById('login-password').value.trim();
             const users = getRegisteredUsers();
             
             // Speci√°ln√≠ √∫ƒçet pro testov√°n√≠ PRO verze
             if (loginUsername === 'Va≈°ek' && loginPassword === 'vasek11') {
                  currentUser = { username: 'Va≈°ek', password: 'vasek11', isPaid: true, remainingAmount: 0, pinIndex: SIMULATED_PIN_VALUES.length };
                  saveCurrentUserState();
                  logActivity(`P≈ôihl√°≈°en√≠ u≈æivatele Va≈°ek (PRO licence - Testovac√≠).`);
                  unlockFeaturesUI('PRO', `V√≠tejte zpƒõt, ${currentUser.username}! PRO verze je automaticky aktivov√°na.`, 'dashboard');
                  return;
             }

             const storedUser = users[loginUsername];
             if (storedUser && storedUser.password === loginPassword) {
                  currentUser = storedUser;
                  saveCurrentUserState();
                  const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                  logActivity(`√öspƒõ≈°n√© p≈ôihl√°≈°en√≠ u≈æivatele ${currentUser.username}.`);
                  unlockFeaturesUI(licenseType, `V√≠tejte zpƒõt, ${currentUser.username}!`, 'dashboard');
                  return;
             }

             document.getElementById('login-message').innerText = 'Chyba: Neplatn√© u≈æivatelsk√© jm√©no nebo heslo.';
             document.getElementById('login-message').style.color = 'var(--color-danger-red)';
        };
        
        const handleLogout = () => { 
             logActivity(`Odhl√°≈°en√≠ u≈æivatele ${currentUser.username}.`);
             currentUser = null;
             localStorage.removeItem(CURRENT_USER_KEY);
             document.getElementById('header-username').innerText = 'Odhl√°≈°eno';
             document.getElementById('header-license-status').innerText = 'Neaktivn√≠';
             document.getElementById('header-license-status').className = 'status-inactive';
             document.querySelectorAll('.nav-item').forEach(nav => {
                 const navModule = nav.getAttribute('data-module');
                 if (navModule !== 'dashboard') { nav.classList.add('locked'); nav.querySelector('i').innerHTML = 'üîí'; }
             });
             document.getElementById('dashboard').innerHTML = '';
             switchModule('auth_select');
        };

        // --- PLATEBN√ç MODUL LOGIKA ---
         const updateRemainingDisplay = () => {
             const remainingAmountSpan = document.getElementById('remaining-amount');
             if (!remainingAmountSpan || !currentUser) return;
             
             remainingAmountSpan.innerText = currentUser.remainingAmount.toLocaleString('cs-CZ') + ' Kƒç';

             if (currentUser.remainingAmount <= 0) {
                 remainingAmountSpan.classList.remove('text-remaining');
                 remainingAmountSpan.classList.add('text-paid');
                 
                 currentUser.isPaid = true;
                 
                 const users = getRegisteredUsers();
                 if (users[currentUser.username]) {
                    users[currentUser.username].isPaid = true;
                    users[currentUser.username].remainingAmount = 0;
                    users[currentUser.username].pinIndex = currentUser.pinIndex;
                    saveRegisteredUsers(users);
                 }
                 saveCurrentUserState();
                 logActivity(`Aktivace PRO licence dokonƒçena platbou Paysafecard.`);

                 const paysafeBox = document.getElementById('paysafe-payment-box');
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);">Platba dokonƒçena!</h3>
                    <p>Licence **Nexus PRO** byla √∫spƒõ≈°nƒõ aktivov√°na. V≈°echny pr√©miov√© funkce jsou nyn√≠ odemƒçeny!</p>
                    <button class="primary-btn" onclick="unlockFeaturesUI('PRO', 'Gratulujeme! PRO verze je aktivn√≠.', 'dashboard')">Pokraƒçovat na Dashboard</button>
                 `;
             }
         };
         
         const addLog = (message, color) => {
             const transactionLog = document.getElementById('transaction-log');
             if (!transactionLog) return;
             const p = document.createElement('p');
             p.innerHTML = `<span style="color: ${color};">‚Ä¢ ${message}</span>`;
             transactionLog.insertBefore(p, transactionLog.children[1]); 
             transactionLog.scrollTop = 0;
         };
         
         const handlePaysafePinSubmit = () => {
             const paysafePinInput = document.getElementById('paysafe-pin-input');
             const submitPinBtn = document.getElementById('submit-pin-btn');
             const pin = paysafePinInput.value.trim();
             
             if (pin.length !== 16 || !/^\d+$/.test(pin)) {
                 addLog("Chyba: PIN mus√≠ b√Ωt 16m√≠stn√© ƒç√≠slo.", "var(--color-danger-red)");
                 return;
             }
             
             if (currentUser.pinIndex >= SIMULATED_PIN_VALUES.length || currentUser.isPaid) {
                  addLog("Platba ji≈æ byla dokonƒçena nebo vyƒçerp√°n poƒçet testovac√≠ch PIN≈Ø.", "var(--color-accent-green)");
                  return;
             }

             submitPinBtn.disabled = true;
             paysafePinInput.disabled = true;
             addLog(`Ovƒõ≈ôov√°n√≠ PINu ${pin}...`, "var(--color-warning-yellow)");
             logActivity(`Pokus o zad√°n√≠ PINu Paysafecard (PIN #${currentUser.pinIndex + 1}).`);
             
             setTimeout(() => {
                 let pinValue = SIMULATED_PIN_VALUES[currentUser.pinIndex]; 
                 currentUser.pinIndex++;
                 
                 const amountPaid = Math.min(pinValue, currentUser.remainingAmount);
                 const refund = pinValue - amountPaid;

                 if (currentUser.remainingAmount > 0) {
                     currentUser.remainingAmount -= amountPaid;
                     
                     addLog(`PIN #${currentUser.pinIndex} ovƒõ≈ôen! Pou≈æito: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`, "var(--color-accent-green)");
                     logActivity(`Platba p≈ôijata: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`);
                     if (refund > 0) {
                          addLog(`P≈ôeplatek (${refund.toLocaleString('cs-CZ')} Kƒç) z≈Øst√°v√° na PINu.`, "var(--color-warning-yellow)");
                     }
                 } 
                 
                 updateRemainingDisplay();
                 paysafePinInput.value = '';
                 
                 if (currentUser.remainingAmount > 0) {
                     submitPinBtn.disabled = false;
                     paysafePinInput.disabled = false;
                     paysafePinInput.placeholder = "Zadejte dal≈°√≠ PIN Paysafecard";
                 }
                 saveCurrentUserState(); 

             }, 2500); 
         };
        
        const setPaysafeModuleContent = () => {
             const paysafeBox = document.getElementById('paysafe-payment-box');
             if (!currentUser || currentUser.isPaid) {
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);">PRO licence je aktivn√≠.</h3>
                    <p>Dƒõkujeme. Nemus√≠te prov√°dƒõt ≈æ√°dnou platbu.</p>
                 `;
                 return;
             }

             paysafeBox.innerHTML = `
                <h4>Nexus PRO (Roƒçn√≠ licence): <span style="color: var(--color-accent-blue);">7 999 Kƒç</span></h4>
                <div id="paysafe-status-bar" style="padding: 15px; background-color: #151520; border-radius: 8px; font-size: 1.2em; font-weight: bold; margin-bottom: 20px;">
                    Zb√Ωvaj√≠c√≠ ƒç√°stka k √∫hradƒõ: <span id="remaining-amount" class="text-remaining">${currentUser.remainingAmount.toLocaleString('cs-CZ')} Kƒç</span>
                </div>
                <div class="paysafe-input-area">
                    <input type="text" id="paysafe-pin-input" placeholder="Zadejte 16m√≠stn√Ω PIN Paysafecard" maxlength="16">
                    <button id="submit-pin-btn" class="primary-btn">Ovƒõ≈ôit PIN</button>
                </div>
                <div id="transaction-log"><p>Log transakc√≠:</p></div>
                <button class="secondary-btn" onclick="switchModule('dashboard')">Zpƒõt na Dashboard</button>
             `;
             
             document.getElementById('submit-pin-btn').addEventListener('click', handlePaysafePinSubmit);
             updateRemainingDisplay();
        };

        // --- DASHBOARD ---
        const setDashboardContent = (licenseType) => {
             const isPro = licenseType === 'PRO';
             const color = isPro ? 'var(--color-accent-green)' : 'var(--color-danger-red)';
             const statusText = isPro ? 'Optim√°ln√≠ zabezpeƒçen√≠ PRO!' : 'Vy≈æaduje okam≈æitou akci!';
             const score = isPro ? '100%' : '65%';
             const buttonText = isPro ? 'Spustit PRO Sken' : 'Koupit PRO verzi';
             
             const dashboardModule = document.getElementById('dashboard');
             
             dashboardModule.innerHTML = `
                <h2>Domovsk√° Obrazovka</h2>
                <div id="security-score-card" style="background: linear-gradient(135deg, ${isPro ? '#1e2c1e' : '#2a2a3b'}, ${isPro ? '#152015' : '#1e1e2c'}); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                    <div id="score-gauge" style="border-radius: 50%; border: 8px solid ${color}; display: flex; align-items: center; justify-content: center; width: 120px; height: 120px; font-size: 2em; margin: 0 auto;">${score}</div>
                    <h3 style="margin-top: 15px;">Stav Syst√©mu</h3>
                    <p id="system-status-text" style="color: ${color}; font-size: 1.1em; font-weight: bold;">${statusText}</p>
                    <p id="last-repair-text" style="color: var(--color-text-grey); font-size: 0.9em;">Posledn√≠ oprava: ${isPro ? new Date().toLocaleDateString('cs-CZ') : 'Nikdy'}</p>
                    <button id="start-smart-scan-dashboard" class="primary-btn">${buttonText}</button>
                </div>
                
                <h3 style="margin-top: 20px; font-weight: 500;">P≈ôehled √öƒçtu</h3>
                <div style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    <p>U≈æivatel: <strong>${currentUser.username}</strong></p>
                    <p>Stav licence: <span style="color: ${color};">${isPro ? 'Aktivn√≠ PRO verze' : 'Freemium (Z√°kladn√≠ ochrana)'}</span></p>
                    ${isPro ? '' : `<button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`}
                    <button class="secondary-btn" onclick="handleLogout()">Odhl√°sit se</button>
                </div>
             `;
             
             const scanBtn = document.getElementById('start-smart-scan-dashboard');
             if (scanBtn) {
                 if (isPro) {
                     scanBtn.addEventListener('click', () => {
                         switchModule('scan');
                         logActivity(`Spu≈°tƒõn Chytr√Ω Sken z Dashboardu.`);
                     });
                 } else {
                     scanBtn.addEventListener('click', () => switchModule('paysafe'));
                 }
             }
        };


        // --- LOGIKA PRO ROZ≈†√ç≈òEN√â MODULY (DATA) ---
        const SIMULATION_DATA = {
            IDENTITY_ITEMS: [
                { name: "Prim√°rn√≠ e-mail", type: "email", defaultChecked: true },
                { name: "Z√°lo≈æn√≠ e-mail", type: "email", defaultChecked: false },
                { name: "ƒå√≠slo kreditn√≠ karty (4 cifry)", type: "card", defaultChecked: true },
                { name: "ƒå√≠slo debetn√≠ karty (4 cifry)", type: "card", defaultChecked: false },
                { name: "Rodn√© ƒç√≠slo", type: "social", defaultChecked: true },
                { name: "ƒå√≠slo pasu", type: "document", defaultChecked: false },
                { name: "U≈æivatelsk√© jm√©no (soci√°ln√≠ s√≠tƒõ)", type: "username", defaultChecked: true },
                { name: "Telefonn√≠ ƒç√≠slo", type: "phone", defaultChecked: true },
                { name: "Adresa dom≈Ø", type: "address", defaultChecked: false },
                { name: "P≈ôihla≈°ovac√≠ √∫daje PayPal", type: "account", defaultChecked: false },
                { name: "P≈ôihla≈°ovac√≠ √∫daje Banka X", type: "account", defaultChecked: false },
                { name: "IBAN", type: "financial", defaultChecked: false },
                { name: "Historie vyhled√°v√°n√≠", type: "other", defaultChecked: false },
                { name: "Geolokace za≈ô√≠zen√≠", type: "other", defaultChecked: true },
                { name: "Osobn√≠ fotografie", type: "media", defaultChecked: false },
                { name: "Hlasov√© z√°znamy", type: "media", defaultChecked: false },
                { name: "ƒå√≠slo ≈òidiƒçsk√©ho pr≈Økazu", type: "document", defaultChecked: false },
                { name: "PIN mobiln√≠ho telefonu", type: "other", defaultChecked: true },
                { name: "Heslo spr√°vce s√≠tƒõ", type: "other", defaultChecked: false },
                { name: "D≈Øvƒõryhodn√© aplikace", type: "app", defaultChecked: true },
                { name: "Historie vol√°n√≠", type: "phone", defaultChecked: false },
                { name: "Smlouva o slu≈æb√°ch", type: "document", defaultChecked: false },
            ],

            CYBER_DEFENSE_FEATURES: [
                { name: "Adaptivn√≠ Firewall (L5)", desc: "Dynamicky blokuje hrozby zalo≈æen√© na chov√°n√≠ na s√≠≈•ov√© vrstvƒõ (TCP/UDP).", default: true },
                { name: "Ochrana proti Zero-Day √∫tok≈Øm (AI Deep Learning)", desc: "Vyu≈æ√≠v√° neuronovou s√≠≈• pro detekci dosud nezn√°m√Ωch hrozeb v k√≥du.", default: true },
                { name: "Anti-Phishing Shield (Intenzivn√≠)", desc: "Blokuje podez≈ôel√© e-maily, SMS a webov√© str√°nky s vysokou agresivitou.", default: true },
                { name: "Monitorov√°n√≠ s√≠tƒõ v re√°ln√©m ƒçase", desc: "Upozorn√≠ na podez≈ôel√© odchoz√≠ s√≠≈•ov√© aktivity (Command & Control servery).", default: true },
                { name: "Ochrana webov√© kamery (Hardwarov√© blokov√°n√≠)", desc: "Zabr√°n√≠ neopr√°vnƒõn√©mu p≈ô√≠stupu k webkame≈ôe z aplikac√≠ t≈ôet√≠ch stran.", default: true },
                { name: "Ochrana mikrofonu (Monitoring API)", desc: "Monitoruje p≈ô√≠stup k mikrofonu a varuje p≈ôi aktivaci nezn√°mou aplikac√≠.", default: true },
                { name: "Zabezpeƒçen√© stahov√°n√≠ (Cloud Scan)", desc: "Automaticky skenuje sta≈æen√© soubory v cloudu p≈ôed ulo≈æen√≠m na disk.", default: true },
                { name: "Anti-Keylogger (≈†ifrov√°n√≠ kl√°vesnice)", desc: "Chr√°n√≠ p≈ôed zaznamen√°v√°n√≠m stisk≈Ø kl√°ves, zejm√©na p≈ôi zad√°v√°n√≠ hesel.", default: true },
                { name: "Wi-Fi Security Audit (WPA3-Ready)", desc: "Kontroluje slabiny Wi-Fi p≈ôipojen√≠, vƒçetnƒõ DNS a ARP spoofingu.", default: true },
                { name: "Deep Scan Cache", desc: "Odstra≈àuje skryt√© ≈°kodliv√© k√≥dy, scripty a data z doƒçasn√Ωch soubor≈Ø prohl√≠≈æeƒç≈Ø.", default: true },
                { name: "Ochrana p≈ôed Ransomware (Reverzn√≠ ≈°ifrov√°n√≠)", desc: "Vytv√°≈ô√≠ z√°lo≈æn√≠ verze soubor≈Ø v re√°ln√©m ƒçase pro rychlou obnovu.", default: true },
                { name: "Rodiƒçovsk√° kontrola (Pokroƒçil√© Filtry)", desc: "Nastavuje ƒçasov√© limity a filtry obsahu pro dƒõtsk√© √∫ƒçty.", default: false },
                { name: "Automatick√° aktualizace hrozeb", desc: "Udr≈æuje datab√°zi hrozeb v≈ædy aktu√°ln√≠ bez z√°sahu u≈æivatele.", default: true },
                { name: "Sandboxing aplikac√≠ (Virtu√°ln√≠ prost≈ôed√≠)", desc: "Izoluje podez≈ôel√©, nov√© nebo neovƒõ≈ôen√© aplikace v bezpeƒçn√©m prost≈ôed√≠.", default: true },
                { name: "≈†ifrov√°n√≠ datov√Ωch tok≈Ø (TLS/SSL Enforce)", desc: "Zaji≈°≈•uje bezpeƒçn√Ω, ≈°ifrovan√Ω p≈ôenos v≈°ech dat p≈ôi komunikaci.", default: true },
                { name: "Blokov√°n√≠ reklam a tracker≈Ø (Agresivn√≠ re≈æim)", desc: "Zvy≈°uje rychlost a soukrom√≠ blokov√°n√≠m invazivn√≠ch reklam.", default: true },
                { name: "Ochrana bankovnictv√≠ (Izolovan√Ω prohl√≠≈æeƒç)", desc: "Zabezpeƒçuje finanƒçn√≠ transakce spu≈°tƒõn√≠m port√°lu v izolovan√©m oknƒõ.", default: true },
                { name: "Anti-Spyware modul (Heuristick√° detekce)", desc: "Hled√° a odstra≈àuje ≈°pion√°≈æn√≠ software na z√°kladƒõ chov√°n√≠ a podpis≈Ø.", default: true },
                { name: "Aktivn√≠ ochrana slo≈æek (Pouze whitelist)", desc: "Znemo≈æ≈àuje z√°pis do vybran√Ωch slo≈æek kromƒõ povolen√Ωch aplikac√≠.", default: true },
                { name: "Simulace √∫tok≈Ø (Honeypot Lure)", desc: "Oklame hackery fale≈°n√Ωmi daty a odhal√≠ jejich IP adresu.", default: false },
                { name: "Web Reputation Filter", desc: "Blokuje str√°nky s n√≠zkou d≈Øvƒõryhodnost√≠ nebo ned√°vno nahl√°≈°en√© jako ≈°kodliv√©.", default: true },
                { name: "Ochrana proti IoT hrozb√°m (Device Fingerprinting)", desc: "Zabezpeƒçuje p≈ôipojen√° chytr√° za≈ô√≠zen√≠ v dom√°c√≠ s√≠ti (kamera, termostat).", default: true },
                { name: "Detekce neleg√°ln√≠ tƒõ≈æby kryptomƒõn (CPU Monitor)", desc: "Chr√°n√≠ p≈ôed zneu≈æit√≠m CPU pro neleg√°ln√≠ tƒõ≈æbu p≈ôi prohl√≠≈æen√≠ webu.", default: true },
                { name: "Obousmƒõrn√Ω Firewall (Full-Packet Inspection)", desc: "Kontrola p≈ô√≠choz√≠ho i odchoz√≠ho provozu na √∫rovni cel√Ωch paket≈Ø.", default: true },
                { name: "Monitorov√°n√≠ zmƒõn registru/OS", desc: "Upozorn√≠ na neopr√°vnƒõn√© zmƒõny v kritick√Ωch syst√©mov√Ωch kl√≠ƒç√≠ch.", default: true },
                { name: "Integrace s Cloud Protection (Real-Time)", desc: "Spolupr√°ce s cloudov√Ωmi datab√°zemi hrozeb pro okam≈æit√© reakce.", default: true },
                { name: "VPN Kill Switch", desc: "Automaticky odpoj√≠ za≈ô√≠zen√≠ od internetu, pokud dojde k v√Ωpadku VPN spojen√≠.", default: true },
                { name: "Optimalizace v√Ωkonu skenov√°n√≠", desc: "Optimalizuje vyu≈æit√≠ zdroj≈Ø p≈ôi skenov√°n√≠, aby se zpomalil syst√©m.", default: true },
                { name: "Blokov√°n√≠ P2P/Torrent provozu (Voliteln√©)", desc: "Umo≈æ≈àuje blokovat ve≈°ker√Ω ne≈°ifrovan√Ω P2P provoz pro vy≈°≈°√≠ bezpeƒçnost.", default: false },
                { name: "Ochrana Bluetooth a USB za≈ô√≠zen√≠", desc: "Skenuje p≈ôipojovan√° za≈ô√≠zen√≠ na firmware/autorun hrozby.", default: true },
                { name: "Behavior√°ln√≠ anal√Ωza aplikac√≠", desc: "Identifikuje ≈°kodliv√© chov√°n√≠ u jinak 'leg√°ln√≠ch' aplikac√≠.", default: true },
                { name: "D≈Øvƒõryhodn√© z√≥ny (Whitelist s√≠tƒõ)", desc: "Definuje bezpeƒçn√© Wi-Fi s√≠tƒõ, kde se aplikuj√≠ m√≠rnƒõj≈°√≠ pravidla.", default: true },
                { name: "Anti-Exploit modul", desc: "Br√°n√≠ zneu≈æit√≠ zranitelnost√≠ v popul√°rn√≠ch aplikac√≠ch a prohl√≠≈æeƒç√≠ch.", default: true },
                { name: "Ochrana proti DNS zlomysln√©mu p≈ôesmƒõrov√°n√≠", desc: "Zaji≈°≈•uje, ≈æe DNS dotazy nejsou p≈ôesmƒõrov√°ny na podvodn√© servery.", default: true },
                { name: "Modul prevence ztr√°ty dat (DLP light)", desc: "Detekuje, kdy≈æ citliv√° data opou≈°t√≠ za≈ô√≠zen√≠ ne≈°ifrovanƒõ.", default: false },
                { name: "Vynucen√≠ siln√©ho hesla pro aplikace", desc: "Doporuƒçuje a vynucuje silnƒõj≈°√≠ hesla pro syst√©mov√© slu≈æby.", default: false },
                { name: "Detekce Root/Jailbreak pokus≈Ø", desc: "Upozorn√≠ na pokusy o z√≠sk√°n√≠ vy≈°≈°√≠ch opr√°vnƒõn√≠ k prolomen√≠ zabezpeƒçen√≠.", default: true },
                { name: "Biometrick√° ochrana p≈ô√≠stupu", desc: "Vynucuje otisk prstu/obliƒçeje pro p≈ô√≠stup do aplikace.", default: true },
                { name: "Vzd√°len√© smaz√°n√≠ dat (Wipe)", desc: "Umo≈æ≈àuje vzd√°lenƒõ smazat data p≈ôi ztr√°tƒõ za≈ô√≠zen√≠.", default: false },
                { name: "≈†ifrov√°n√≠ intern√≠ho √∫lo≈æi≈°tƒõ (AES-256)", desc: "Vynucuje pln√© ≈°ifrov√°n√≠ datov√©ho disku (pokud OS podporuje).", default: true },
                { name: "Hypervisor Protection", desc: "Izoluje kritick√© syst√©mov√© komponenty na nejni≈æ≈°√≠ √∫rovni OS.", default: true },
                { name: "AI detekce Fake News", desc: "Varuje p≈ôed str√°nkami a obsahem s vysok√Ωm rizikem dezinformac√≠.", default: false },
            ],
            
            SCAN_AREAS: [
                { name: "Syst√©mov√© soubory (j√°dro OS)", default: true },
                { name: "Aplikace t≈ôet√≠ch stran", default: true },
                { name: "Registry a datab√°ze", default: true },
                { name: "Doƒçasn√© soubory a mezipamƒõ≈•", default: true },
                { name: "Stahov√°n√≠ a dokumenty", default: false },
                { name: "Plocha a pracovn√≠ adres√°≈ôe", default: false },
                { name: "E-mailov√° data a p≈ô√≠lohy", default: false },
                { name: "S√≠tƒõ Wi-Fi a Bluetooth", default: true },
                { name: "Pamƒõ≈• RAM (bƒõ≈æ√≠c√≠ procesy)", default: true },
                { name: "Roz≈°√≠≈ôen√≠ prohl√≠≈æeƒç≈Ø", default: true },
                { name: "Cookies a sledovac√≠ skripty", default: true },
                { name: "Virtu√°ln√≠ disky", default: false },
                { name: "IoT za≈ô√≠zen√≠ v s√≠ti", default: true },
                { name: "Zastaral√Ω software", default: true },
                { name: "≈†ifrovan√© jednotky", default: false },
                { name: "Cloudov√© √∫lo≈æi≈°tƒõ (metadata)", default: false },
                { name: "Hardwarov√© ovladaƒçe", default: true },
                { name: "Soubory s kl√≠ƒçi (≈°ifrov√°n√≠)", default: true },
                { name: "Soubory protokolu (Log files)", default: true },
                { name: "Syst√©mov√© promƒõnn√©", default: true },
                { name: "Mobiln√≠ galerie (metadata)", default: false },
                { name: "Nezabezpeƒçen√© API", default: false },
            ],
            
            VPN_SERVERS: [
                "Automaticky (Nejrychlej≈°√≠)", "ƒåesk√° republika (Praha 1)", "ƒåesk√° republika (Brno)", 
                "Nƒõmecko (Frankfurt)", "Polsko (Var≈°ava)", "Rakousko (V√≠de≈à)", "Slovensko (Bratislava)", 
                "USA (New York)", "USA (Los Angeles)", "Kanada (Toronto)", "Velk√° Brit√°nie (Lond√Ωn)", 
                "Francie (Pa≈ô√≠≈æ)", "≈†panƒõlsko (Madrid)", "It√°lie (Mil√°n)", "Nizozemsko (Amsterdam)", 
                "≈†v√Ωcarsko (Curych)", "≈†v√©dsko (Stockholm)", "Japonsko (Tokio)", "Austr√°lie (Sydney)", 
                "Braz√≠lie (S√£o Paulo)", "Ji≈æn√≠ Korea (Soul)", "Indie (Bombaj)", "Turecko (Istanbul)", 
                "Ji≈æn√≠ Afrika (Kapsk√© Mƒõsto)", "Singapur"
            ]
        };
        
        // --- FUNKCE PRO GENERACI HTML ROZ≈†√ç≈òEN√ùCH MODUL≈Æ ---

        const generateConfigHtml = (items, type) => {
             return items.map((item, index) => {
                const control = type === 'scan' || type === 'identity' 
                    ? `<input type="checkbox" id="${type}-${index}" ${item.defaultChecked ? 'checked' : ''}>`
                    : `<label class="toggle-switch"><input type="checkbox" id="${type}-${index}" ${item.default ? 'checked' : ''}><span class="slider"></span></label>`;

                return `
                    <div class="config-item">
                        <div class="item-info">
                            <strong>${item.name}</strong>
                            ${item.desc ? `<span>${item.desc}</span>` : ''}
                        </div>
                        ${control}
                    </div>
                `;
             }).join('');
        };
        
        // OPRAVENO A PONECH√ÅNO
        const generateCyberDefenseHtml = () => {
             return `<p style="margin-bottom: 20px;">Zapnƒõte a vypnƒõte pokroƒçil√© moduly kybernetick√© obrany. Aktivace v≈°ech funkc√≠ zaruƒçuje **Maxim√°ln√≠ PRO ochranu**.</p>
                     <div class="config-group">
                        ${generateConfigHtml(SIMULATION_DATA.CYBER_DEFENSE_FEATURES, 'cyber')}
                     </div>`;
        };
        
        // OPRAVENO A PONECH√ÅNO
        const generateIdentityGuardHtml = () => {
             return `<p style="margin-bottom: 20px;">Vyberte, kter√© osobn√≠ √∫daje chcete monitorovat v Dark Webu.</p>
                     <div class="config-group">
                        ${generateConfigHtml(SIMULATION_DATA.IDENTITY_ITEMS, 'identity')}
                     </div>
                     <button id="start-dark-web-scan" class="primary-btn" style="margin-top: 15px;">Spustit Dark Web Sken</button>`;
        };

        const generateVpnServerHtml = () => {
             const options = SIMULATION_DATA.VPN_SERVERS.map(server => 
                 `<option value="${server.replace(/\s/g, '-')}" ${server.includes('Automaticky') ? 'selected' : ''}>${server}</option>`
             ).join('');

             return `
                <div class="server-list">
                    <label for="vpn-server-select" style="display: block; margin-bottom: 5px;">Vybrat Server:</label>
                    <select id="vpn-server-select">
                        ${options}
                    </select>
                </div>
             `;
        };

        const generateSettingsHtml = () => {
            const logs = JSON.parse(localStorage.getItem(ACTIVITY_LOG_KEY)) || [];
            
            const logHtml = logs.length > 0
                ? logs.map(log => `<div class="activity-log-item">${log}</div>`).join('')
                : '<div class="activity-log-item" style="color: var(--color-text-grey);">≈Ω√°dn√° zaznamenan√° aktivita.</div>';


            return `
                <h3 style="margin-top: 0;">Spr√°va Profilu</h3>
                <div class="config-group">
                    <p>U≈æivatelsk√© jm√©no: <strong>${currentUser.username}</strong></p>
                    <p>Heslo: <span style="color: var(--color-warning-yellow);">** Skryto pro bezpeƒçnost **</span></p>
                    <button class="secondary-btn" style="margin-top: 10px;">Zmƒõnit Heslo</button>
                </div>
                
                <h3>Historie Aktivity (Pravdiv√© Z√°znamy)</h3>
                <div class="config-group">
                    ${logHtml}
                </div>
                <button class="secondary-btn" onclick="clearActivityLog()">Vyƒçistit log aktivity</button>
            `;
        };
        
        let isVpnConnected = false;
        
        const simulateVpnConnection = (vpnToggleBtn) => {
             const selectedServer = document.getElementById('vpn-server-select').value.replace(/-/g, ' ');
             const vpnStatusHeader = document.querySelector('#vpn-content h3');
             const vpnStatusP = document.querySelector('#vpn-content p');
             
             if (!isVpnConnected) {
                vpnToggleBtn.disabled = true;
                vpnToggleBtn.innerText = 'P≈ôipojov√°n√≠...';
                vpnToggleBtn.style.backgroundColor = 'var(--color-warning-yellow)';
                vpnStatusHeader.innerText = `Stav: P≈ôipojov√°n√≠...`;
                vpnStatusP.innerText = 'Navazuji ≈°ifrovan√© spojen√≠.';
                
                logActivity(`Pokus o p≈ôipojen√≠ k VPN serveru: ${selectedServer}.`);
                
                setTimeout(() => {
                    isVpnConnected = true;
                    vpnToggleBtn.disabled = false;
                    vpnToggleBtn.innerText = 'Odpojit';
                    vpnToggleBtn.style.backgroundColor = 'var(--color-danger-red)';
                    vpnStatusHeader.innerText = `Stav: P≈ôipojeno (${selectedServer})`;
                    vpnStatusP.innerText = 'IP Adresa: XXX.XXX.XXX (Maskov√°no)';
                    logActivity(`√öspƒõ≈°nƒõ p≈ôipojeno k VPN: ${selectedServer}.`);
                }, 3500);
            } else {
                isVpnConnected = false;
                vpnToggleBtn.innerText = 'P≈ôipojit';
                vpnToggleBtn.style.backgroundColor = 'var(--color-accent-blue)';
                vpnStatusHeader.innerText = 'Stav: Odpojeno';
                vpnStatusP.innerText = 'Kliknƒõte pro zabezpeƒçen√≠ spojen√≠.';
                logActivity(`Odpojeno od VPN serveru: ${selectedServer}.`);
            }
        };

        const startScanSimulation = (isRepair = false) => {
             const scanStatus = document.getElementById('scan-status');
             const progressBar = document.getElementById('scan-fill');
             if (!scanStatus || !progressBar) return;
             
             logActivity(`Spu≈°tƒõna simulace skenov√°n√≠ (${isRepair ? 'oprava' : 'bƒõ≈æn√Ω sken'}).`);
             
             scanStatus.innerText = 'Skenov√°n√≠ prob√≠h√°...';
             progressBar.style.width = '20%';
             
             setTimeout(() => {
                 progressBar.style.width = '70%';
             }, 1000);

             setTimeout(() => {
                 progressBar.style.width = '100%';
                 scanStatus.innerText = isRepair ? 'Oprava dokonƒçena!' : 'Skenov√°n√≠ dokonƒçeno! Nalezeno 3 hrozby.';
                 document.getElementById('threats-count').innerText = isRepair ? '0' : '3';
                 logActivity(`Skenov√°n√≠ dokonƒçeno. Nalezeno hrozeb: ${isRepair ? '0' : '3'}.`);
             }, 3000);
        };

        // OPRAVENO: Zaji≈°tƒõno, ≈æe cyber_defense dostane spr√°vn√Ω HTML obsah.
        const makeFunctional = (isPro) => {
            
            const modulesConfig = {
                'scan': {
                    proHtml: `
                        <div id="scan-visuals">
                            <p>Aktu√°ln√≠ stav: <span id="scan-status">P≈ôipraveno ke spu≈°tƒõn√≠.</span></p>
                            <div id="scan-progress-bar" style="height: 15px; background-color: var(--color-border); border-radius: 8px; overflow: hidden; margin: 10px 0;"><div id="scan-fill" style="height: 100%; width: 0%; background-color: var(--color-accent-blue); transition: width 0.5s;"></div></div>
                        </div>
                        <div id="scan-results" style="margin-top: 30px; background-color: #2a2a3b; padding: 15px; border-radius: 8px;">
                            <h3>Sum√°≈ô v√Ωsledk≈Ø</h3><p>Nalezen√© hrozby: <span id="threats-count" style="font-weight: bold; color: var(--color-danger-red);">0</span></p>
                            <button id="start-scan-secondary" class="primary-btn">Spustit Sken</button>
                        </div>
                        <h3 style="margin-top: 20px;">Vybrat typy skenov√°n√≠</h3>
                        <div class="config-group">
                            ${generateConfigHtml(SIMULATION_DATA.SCAN_AREAS, 'scan')}
                        </div>
                    `,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Pro skenov√°n√≠ cel√©ho syst√©mu je vy≈æadov√°na **PRO licence**.</p><button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`
                },
                'cyber_defense': {
                    proHtml: generateCyberDefenseHtml(), 
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence** a p≈ô√≠stup ke 40+ obrann√Ωm funkc√≠m.</p><button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`
                },
                'vpn': {
                    proHtml: `
                        <div class="premium-feature">
                            <div><h3>Stav: Odpojeno</h3><p style="color: var(--color-text-grey);">Kliknƒõte pro zabezpeƒçen√≠ spojen√≠ a vyberte server.</p></div>
                            ${generateVpnServerHtml()}
                            <button class="primary-btn" id="vpn-toggle">P≈ôipojit</button>
                        </div>
                    `,
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p><button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`
                },
                'identity': {
                    proHtml: generateIdentityGuardHtml(),
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence** pro skenov√°n√≠ Dark Webu.</p><button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`
                },
                'settings': { 
                    proHtml: generateSettingsHtml(),
                    freemiumHtml: `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence** pro p≈ô√≠stup k pokroƒçil√©mu logu aktivity.</p><button class="secondary-btn" onclick="switchModule('paysafe')">Koupit PRO licenci</button>`
                }
            };

            for (const moduleId in modulesConfig) {
                const moduleContentDiv = document.getElementById(`${moduleId}-content`);
                if (moduleContentDiv) {
                    moduleContentDiv.innerHTML = isPro ? modulesConfig[moduleId].proHtml : modulesConfig[moduleId].freemiumHtml;
                }
            }

            // P≈ôipojen√≠ handler≈Ø pro PRO funkce
            if (isPro) {
                const vpnToggle = document.getElementById('vpn-toggle');
                if (vpnToggle) vpnToggle.addEventListener('click', () => simulateVpnConnection(vpnToggle));
                
                const scanBtnSecondary = document.getElementById('start-scan-secondary');
                if (scanBtnSecondary) scanBtnSecondary.addEventListener('click', () => startScanSimulation(false));
                
                const darkWebScanBtn = document.getElementById('start-dark-web-scan');
                if (darkWebScanBtn) darkWebScanBtn.addEventListener('click', () => logActivity("Spu≈°tƒõn Dark Web Sken (Identity Guard)."));

                // P≈ôipojen√≠ logiky pro simulovan√© zmƒõny v konfiguraci
                 document.querySelectorAll('.toggle-switch input, #scan-content input[type="checkbox"], #identity-content input[type="checkbox"]').forEach(input => {
                     input.addEventListener('change', (e) => {
                         const state = e.target.checked ? 'zapnuto' : 'vypnuto';
                         const featureName = e.target.closest('.config-item').querySelector('strong').innerText;
                         logActivity(`Zmƒõna konfigurace: ${featureName} nastaveno na stav: ${state}.`);
                     });
                 });
            }
        };

        const unlockFeaturesUI = (licenseType, message, targetModuleId) => {
            const isPro = licenseType === 'PRO';

            // 1. Nastaven√≠ Hlaviƒçky
            document.getElementById('header-username').innerText = currentUser.username;
            document.getElementById('header-license-status').innerText = isPro ? 'PRO aktivn√≠' : 'Freemium';
            document.getElementById('header-license-status').className = isPro ? 'status-active' : 'status-inactive';

            // 2. Nastaven√≠ Navigace (z√°mky)
            document.querySelectorAll('.nav-item').forEach(nav => {
                const navModule = nav.getAttribute('data-module');
                
                if (navModule === 'dashboard') { nav.classList.remove('locked'); nav.querySelector('i').innerHTML = 'üè†'; return; }
                
                if (isPro) {
                    nav.classList.remove('locked');
                    const icons = { 'scan': 'üöÄ', 'cyber_defense': 'üõ°Ô∏è', 'vpn': 'üåê', 'identity': 'üïµÔ∏è', 'settings': '‚öôÔ∏è' };
                    nav.querySelector('i').innerHTML = icons[navModule] || '‚úÖ';
                } else {
                    nav.classList.add('locked');
                    nav.querySelector('i').innerHTML = 'üîí';
                }
            });
            
            // 3. Nastaven√≠ Dashboardu a funkƒçnosti
            setPaysafeModuleContent(); 
            setDashboardContent(licenseType);
            makeFunctional(isPro); 

            if (message) alert(message);
            switchModule(targetModuleId);
        };
        
        // --- INICIALIZACE ---
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // P≈ôipojen√≠ handler≈Ø pro autentizaci
            document.getElementById('profile-btn').addEventListener('click', () => switchModule('settings')); 
            document.getElementById('show-login-btn').addEventListener('click', () => switchModule('login'));
            document.getElementById('show-register-btn').addEventListener('click', () => switchModule('register'));
            document.getElementById('register-btn').addEventListener('click', handleRegister);
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // P≈ôipojen√≠ navigaƒçn√≠ch handler≈Ø
            document.querySelectorAll('#bottom-nav .nav-item').forEach(nav => {
                nav.addEventListener('click', (e) => {
                    e.preventDefault();
                    const moduleId = e.currentTarget.getAttribute('data-module');
                    if (e.currentTarget.classList.contains('locked') && (!currentUser || !currentUser.isPaid)) { 
                        alert("Tato funkce je uzamƒçena v Freemium verzi. Kupte PRO licenci!");
                    } else {
                        switchModule(moduleId);
                    }
                });
            });

            // Hlavn√≠ spu≈°tƒõn√≠ aplikace
            loadCurrentUserState();

            if (currentUser) {
                const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                unlockFeaturesUI(licenseType, null, 'dashboard');
            } else {
                switchModule('auth_select');
            }
        });
    </script>
</body>
</html>
