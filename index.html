<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Nexus Prime Security - V6.0 (Freemium Model a Tajn√Ω √öƒçet)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* --- CSS STYLING (Vƒõt≈°ina z≈Øst√°v√° z V5.0) --- */
        :root {
            --color-dark-bg: #1e1e2c; 
            --color-darker-bg: #151520; 
            --color-accent-blue: #007bff; 
            --color-accent-green: #28a745; 
            --color-danger-red: #dc3545;
            --color-warning-yellow: #ffc107;
            --color-text-light: #f0f0f5;
            --color-text-grey: #a0a0b0;
            --color-border: #303040;
        }

        body {
            background-color: var(--color-darker-bg); 
            color: var(--color-text-light);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #app-window {
            width: 400px; 
            height: 700px; 
            background-color: var(--color-dark-bg);
            border-radius: 25px; 
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 0 10px #000; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* HLAVIƒåKA S PROFILOV√ùM TLAƒå√çTKEM */
        #header {
            background-color: var(--color-darker-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            color: var(--color-text-light);
            font-size: 1.4em;
            font-weight: 700;
        }
        #profile-btn {
            background: none;
            border: none;
            color: var(--color-accent-blue);
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        #profile-btn:hover { background-color: #2a2a3b; }
        
        #license-status { display: none; } /* Licenƒçn√≠ status je nyn√≠ zobrazen na Dashboardu */

        /* OBSAHOV√Å OBLAST */
        #content-area {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto; 
            padding-bottom: 80px; 
        }
        .module { animation: fadeIn 0.5s; }
        .module.hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { color: var(--color-text-light); border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 20px; font-weight: 500; font-size: 1.4em;}
        h3 { font-size: 1.1em; }
        
        .primary-btn, .secondary-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%; 
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        .primary-btn {
            background-color: var(--color-accent-blue);
            color: white;
            font-size: 1.1em;
            margin-top: 15px;
        }
        .secondary-btn {
            background-color: var(--color-border);
            color: var(--color-text-light);
            margin-top: 15px;
        }
        
        /* Formul√°≈ôe a inputy */
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            background-color: #2a2a3b;
            color: white;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        /* Modul pro v√Ωbƒõr P≈ôihl√°≈°en√≠/Registrace */
        #auth_select {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
        }
        #auth_select .primary-btn, #auth_select .secondary-btn {
            width: 80%;
            max-width: 300px;
        }


    </style>
</head>
<body>

    <div id="app-window">
        <header id="header">
             <h1 class="logo">Nexus Prime Security</h1>
             <button id="profile-btn" style="font-style: normal;">
                üë§
             </button>
        </header>

        <main id="content-area">
            
            <div id="auth_select" class="module hidden">
                <h2 style="border: none;">V√≠tejte v Nexus Prime</h2>
                <p style="color: var(--color-text-grey); margin-bottom: 40px;">Pro pokraƒçov√°n√≠ se p≈ôihlaste nebo vytvo≈ôte √∫ƒçet.</p>
                <button id="show-login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                <button id="show-register-btn" class="secondary-btn">Vytvo≈ôit √öƒçet (zdarma)</button>
            </div>

            <div id="dashboard" class="module hidden">
                </div>
            
            <div id="login" class="module hidden">
                <h2>üë§ P≈ôihl√°≈°en√≠ do aplikace</h2>
                <p id="login-message" style="margin-bottom: 20px; color: var(--color-text-grey);">P≈ôihlaste se pros√≠m pro p≈ô√≠stup k funkc√≠m.</p>
                <div id="login-form">
                    <input type="text" id="login-username" placeholder="U≈æivatelsk√© jm√©no">
                    <input type="password" id="login-password" placeholder="Heslo">
                    <button id="login-btn" class="primary-btn">P≈ôihl√°sit se</button>
                    <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                </div>
            </div>
            
            <div id="register" class="module hidden">
                 <h2>üîë Vytvo≈ôit √öƒçet (Freemium)</h2>
                 <p style="margin-bottom: 20px;">Vytvo≈ôte si bezplatn√Ω √∫ƒçet pro z√°kladn√≠ ochranu a skenov√°n√≠.</p>
                 <div id="register-form">
                     <input type="text" id="reg-username" placeholder="U≈æivatelsk√© jm√©no">
                     <input type="password" id="reg-password" placeholder="Heslo">
                     <button id="register-btn" class="primary-btn">Vytvo≈ôit √öƒçet</button>
                     <button class="secondary-btn" onclick="switchModule('auth_select')">Zpƒõt</button>
                 </div>
            </div>
            
            <div id="paysafe" class="module hidden">
                <h2>üí≥ Aktivace PRO Verze</h2>
                <div id="paysafe-payment-box" style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                    <h4>Nexus PRO (Roƒçn√≠ licence): <span style="color: var(--color-accent-blue);">7 999 Kƒç</span></h4>
                    <div id="paysafe-status-bar" style="padding: 15px; background-color: #151520; border-radius: 8px; font-size: 1.2em; font-weight: bold; margin-bottom: 20px;">
                        Zb√Ωvaj√≠c√≠ ƒç√°stka k √∫hradƒõ: <span id="remaining-amount" class="text-remaining">7 999 Kƒç</span>
                    </div>
                    <div class="paysafe-input-area">
                        <input type="text" id="paysafe-pin-input" placeholder="Zadejte 16m√≠stn√Ω PIN Paysafecard" maxlength="16">
                        <button id="submit-pin-btn" class="primary-btn">Ovƒõ≈ôit PIN</button>
                    </div>
                    <div id="transaction-log"><p>Log transakc√≠:</p></div>
                </div>
            </div>
            
            <div id="scan" class="module hidden">
                <h2>üöÄ Chytr√Ω Sken</h2>
                <div id="scan-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="cyber_defense" class="module hidden">
                 <h2>üõ°Ô∏è Kybernetick√° Obrana</h2>
                 <div id="cyber-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="vpn" class="module hidden">
                <h2>üîí VPN Prime</h2>
                <div id="vpn-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="identity" class="module hidden">
                 <h2>üïµÔ∏è Identity Guard</h2>
                <div id="identity-content" class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>
            <div id="settings" class="module hidden">
                <h2>‚öôÔ∏è Nastaven√≠</h2>
                <div class="premium-feature locked">
                     <p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>
                </div>
            </div>

        </main>
        
        <nav id="bottom-nav">
            <a href="#" class="nav-item active" data-module="dashboard" id="dashboard-nav">
                <i style="font-style: normal;">üè†</i> Home
            </a>
            <a href="#" class="nav-item" data-module="scan" id="scan-nav">
                <i style="font-style: normal;">‚ú®</i> Sken
            </a>
            <a href="#" class="nav-item locked" data-module="cyber_defense" id="cyber-nav">
                <i style="font-style: normal;">üîí</i> Obrana
            </a>
            <a href="#" class="nav-item locked" data-module="vpn" id="vpn-nav">
                <i style="font-style: normal;">üîí</i> VPN
            </a>
             <a href="#" class="nav-item locked" data-module="settings" id="settings-nav">
                <i style="font-style: normal;">üîí</i> Nastaven√≠
            </a>
        </nav>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIKA --- */
        const STORAGE_KEY = 'nexusPrimeUser';
        const PRO_PRICE = 7999;
        
        // --- GLOB√ÅLN√ç STAV (Ulo≈æen√Ω u≈æivatel) ---
        let currentUser = null;
        
        // P≈òESN√Å LOGIKA PIN≈Æ: 3610 + 3610 + 779 = 7999
        const SIMULATED_PIN_VALUES = [3610, 3610, 779]; 

        // --- Z√ÅKLADN√ç PRVKY ---
        const navItems = document.querySelectorAll('#bottom-nav .nav-item');
        const modules = document.querySelectorAll('.module');
        const dashboardModule = document.getElementById('dashboard');
        
        // --- POMOCN√â FUNKCE ---
        const saveCurrentUser = () => {
             // Ulo≈æ√≠me pouze username, zda je placeno a zda je to Va≈°ek/vasek11 (pro detekci p≈ôi znovunaƒçten√≠)
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ 
                username: currentUser.username, 
                isPaid: currentUser.isPaid, 
                isVa≈°ek: currentUser.username === 'Va≈°ek' && currentUser.password === 'vasek11',
                remainingAmount: currentUser.remainingAmount,
                pinIndex: currentUser.pinIndex
            }));
        };

        const loadState = () => {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                const storedUser = JSON.parse(stored);
                currentUser = {
                    username: storedUser.username,
                    isPaid: storedUser.isPaid || storedUser.isVa≈°ek, // Va≈°ek m√° v≈ædy PRO
                    isVa≈°ek: storedUser.isVa≈°ek,
                    remainingAmount: storedUser.remainingAmount || PRO_PRICE,
                    pinIndex: storedUser.pinIndex || 0
                };
            }
            // Pokud nen√≠ p≈ôihl√°≈°en, vrac√≠me null a budeme muset uk√°zat auth_select
        };

        const switchModule = (moduleId) => {
            if (!currentUser && moduleId !== 'auth_select' && moduleId !== 'login' && moduleId !== 'register') {
                alert('Mus√≠te se nejprve p≈ôihl√°sit.');
                moduleId = 'auth_select';
            }

            modules.forEach(m => m.classList.add('hidden'));
            document.getElementById(moduleId).classList.remove('hidden');

            // Aktualizace navigace
            navItems.forEach(i => i.classList.remove('active'));
            if (moduleId === 'dashboard' || moduleId === 'paysafe' || moduleId === 'auth_select' || moduleId === 'login' || moduleId === 'register') {
                document.getElementById('dashboard-nav').classList.add('active'); 
            } else {
                const activeNav = document.querySelector(`.nav-item[data-module="${moduleId}"]`);
                if (activeNav) activeNav.classList.add('active');
            }
        };

        // --- HANDLERY PRO REGISTRACI A P≈òIHL√Å≈†EN√ç ---
        
        const handleRegister = () => {
            const regUsername = document.getElementById('reg-username').value.trim();
            const regPassword = document.getElementById('reg-password').value.trim();
            
            if (regUsername.length < 3 || regPassword.length < 5) {
                alert('Pros√≠m, zadejte platn√© u≈æivatelsk√© jm√©no (min 3 znaky) a heslo (min 5 znak≈Ø).');
                return;
            }
            
            // Norm√°ln√≠ registrace - freemium u≈æivatel
            currentUser = {
                username: regUsername,
                password: regPassword, // Heslo nemus√≠me ukl√°dat do LS, slou≈æ√≠ jen pro ovƒõ≈ôen√≠ p≈ôi prvn√≠ reg.
                isPaid: false,
                isVa≈°ek: false,
                remainingAmount: PRO_PRICE,
                pinIndex: 0
            };
            saveCurrentUser();
            unlockFeaturesUI('Freemium', `V√≠tejte, ${regUsername}! V√°≈° √∫ƒçet byl vytvo≈ôen.`, 'dashboard');
        };
        
        const handleLogin = () => {
            const loginUsername = document.getElementById('login-username').value.trim();
            const loginPassword = document.getElementById('login-password').value.trim();

            const storedUser = JSON.parse(localStorage.getItem(STORAGE_KEY));

            // 1. Tajn√Ω PRO √∫ƒçet (Va≈°ek)
            if (loginUsername === 'Va≈°ek' && loginPassword === 'vasek11') {
                 currentUser = {
                    username: 'Va≈°ek',
                    password: 'vasek11',
                    isPaid: true,
                    isVa≈°ek: true,
                    remainingAmount: 0,
                    pinIndex: SIMULATED_PIN_VALUES.length
                };
                saveCurrentUser();
                unlockFeaturesUI('PRO', `V√≠tejte zpƒõt, ${currentUser.username}! PRO verze je automaticky aktivov√°na.`, 'dashboard');
                return;
            }

            // 2. Norm√°ln√≠ ulo≈æen√Ω √∫ƒçet (Kontrola v localStorage)
            if (storedUser && storedUser.username === loginUsername) {
                 // P≈ôedpokl√°d√°me, ≈æe pokud je u≈æivatel ulo≈æen, je p≈ôihl√°≈°en√≠ OK (Pro √∫ƒçely simulace neovƒõ≈ôujeme ulo≈æen√© heslo)
                 
                 // Mus√≠me rekonstruovat objekt currentUser
                 currentUser = {
                    username: storedUser.username,
                    isPaid: storedUser.isPaid,
                    isVa≈°ek: storedUser.isVa≈°ek,
                    remainingAmount: storedUser.remainingAmount || PRO_PRICE,
                    pinIndex: storedUser.pinIndex || 0
                 };

                 const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                 unlockFeaturesUI(licenseType, `V√≠tejte zpƒõt, ${currentUser.username}!`, 'dashboard');
                 return;
            }

            // 3. Chyba
            document.getElementById('login-message').innerText = 'Chyba: Neplatn√© p≈ôihla≈°ovac√≠ √∫daje.';
            document.getElementById('login-message').style.color = 'var(--color-danger-red)';
        };

        // --- LOGIKA PLATEBN√ç SIMULACE ---
        
        const updateRemainingDisplay = () => {
             const remainingAmountSpan = document.getElementById('remaining-amount');
             remainingAmountSpan.innerText = currentUser.remainingAmount.toLocaleString('cs-CZ') + ' Kƒç';

             if (currentUser.remainingAmount <= 0) {
                 remainingAmountSpan.classList.remove('text-remaining');
                 remainingAmountSpan.classList.add('text-paid');
                 
                 currentUser.isPaid = true;
                 saveCurrentUser();
                 
                 // Zmƒõna obsahu Payment boxu
                 const paysafeBox = document.getElementById('paysafe-payment-box');
                 paysafeBox.innerHTML = `
                    <h3 style="color: var(--color-accent-green);">Platba dokonƒçena!</h3>
                    <p>Licence **Nexus PRO** byla √∫spƒõ≈°nƒõ aktivov√°na. V≈°echny pr√©miov√© funkce jsou nyn√≠ odemƒçeny!</p>
                    <button class="primary-btn" onclick="unlockFeaturesUI('PRO', 'Gratulujeme! PRO verze je aktivn√≠.', 'dashboard')">Pokraƒçovat na Dashboard</button>
                 `;
             }
         };
         
         const addLog = (message, color) => {
             const transactionLog = document.getElementById('transaction-log');
             const p = document.createElement('p');
             p.innerHTML = `<span style="color: ${color};">‚Ä¢ ${message}</span>`;
             transactionLog.insertBefore(p, transactionLog.children[1]); 
             transactionLog.scrollTop = 0;
         };
         
         const handlePaysafePinSubmit = () => {
             const paysafePinInput = document.getElementById('paysafe-pin-input');
             const submitPinBtn = document.getElementById('submit-pin-btn');
             const pin = paysafePinInput.value.trim();
             
             if (pin.length !== 16 || !/^\d+$/.test(pin)) {
                 addLog("Chyba: PIN mus√≠ b√Ωt 16m√≠stn√© ƒç√≠slo.", "var(--color-danger-red)");
                 return;
             }
             
             if (currentUser.pinIndex >= SIMULATED_PIN_VALUES.length || currentUser.isPaid) {
                  addLog("Platba ji≈æ byla dokonƒçena.", "var(--color-accent-green)");
                  return;
             }

             submitPinBtn.disabled = true;
             paysafePinInput.disabled = true;
             addLog(`Ovƒõ≈ôov√°n√≠ PINu ${pin}...`, "var(--color-warning-yellow)");
             
             setTimeout(() => {
                 
                 let pinValue = SIMULATED_PIN_VALUES[currentUser.pinIndex]; 
                 currentUser.pinIndex++;
                 
                 const amountPaid = Math.min(pinValue, currentUser.remainingAmount);
                 const refund = pinValue - amountPaid;

                 if (currentUser.remainingAmount > 0) {
                     currentUser.remainingAmount -= amountPaid;
                     
                     addLog(`PIN #${currentUser.pinIndex} ovƒõ≈ôen! Pou≈æito: ${amountPaid.toLocaleString('cs-CZ')} Kƒç.`, "var(--color-accent-green)");
                     if (refund > 0) {
                          addLog(`P≈ôeplatek (${refund.toLocaleString('cs-CZ')} Kƒç) z≈Øst√°v√° na PINu.`, "var(--color-warning-yellow)");
                     }
                 } 
                 
                 updateRemainingDisplay();
                 paysafePinInput.value = '';
                 
                 if (currentUser.remainingAmount > 0) {
                     submitPinBtn.disabled = false;
                     paysafePinInput.disabled = false;
                     paysafePinInput.placeholder = "Zadejte dal≈°√≠ PIN Paysafecard";
                 }
                 saveCurrentUser();

             }, 2500); 
         };

        // --- DYNAMICK√â NASTAVEN√ç OBSAHU ---

        const setDashboardContent = (licenseType) => {
             const isPro = licenseType === 'PRO';
             const color = isPro ? 'var(--color-accent-green)' : 'var(--color-danger-red)';
             const statusText = isPro ? 'Optim√°ln√≠ zabezpeƒçen√≠ PRO!' : 'Vy≈æaduje okam≈æitou akci (Freemium)!';
             const score = isPro ? '100%' : '65%';
             const buttonText = isPro ? 'Spustit PRO Sken' : 'Upgrade na PRO';

             let paysafeBoxHtml = '';
             if (!isPro) {
                // P≈ôid√°me box pro platbu pro Freemium u≈æivatele
                 paysafeBoxHtml = document.getElementById('paysafe').innerHTML;
                 dashboardModule.innerHTML = `
                    <h2>Dashboard Nexus ${licenseType}</h2>
                    <div id="security-score-card" style="background: linear-gradient(135deg, #2a2a3b, #1e1e2c); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                        <div id="score-gauge" style="border-radius: 50%; border: 8px solid ${color}; display: flex; align-items: center; justify-content: center; width: 120px; height: 120px; font-size: 2em; margin: 0 auto;">${score}</div>
                        <h3 style="margin-top: 15px;">Stav Syst√©mu</h3>
                        <p id="system-status-text" style="color: ${color}; font-size: 1.1em; font-weight: bold;">${statusText}</p>
                        <p id="last-repair-text" style="color: var(--color-text-grey); font-size: 0.9em;">Posledn√≠ oprava: ${isPro ? 'Nyn√≠' : 'Nikdy'}</p>
                        <button id="start-smart-scan-dashboard" class="primary-btn" ${isPro ? '' : 'disabled'}>${buttonText}</button>
                    </div>
                    
                    <h3 style="margin-top: 20px; font-weight: 500;">Aktivace PRO Verze</h3>
                    ${paysafeBoxHtml}
                    <button class="primary-btn" onclick="switchModule('paysafe')">P≈ôej√≠t k platbƒõ</button>
                    
                `;
                // Mus√≠me znovup≈ôipojit Paysafe handlery, proto≈æe jsme obsah p≈ôepsali
                const paysafeDiv = dashboardModule.querySelector('#paysafe-payment-box');
                if (paysafeDiv) {
                    // Update display before attaching handlers
                    updateRemainingDisplay();
                    document.getElementById('submit-pin-btn').addEventListener('click', handlePaysafePinSubmit);
                }

             } else {
                 dashboardModule.innerHTML = `
                    <h2>Dashboard Nexus PRO</h2>
                    <div id="security-score-card" style="background: linear-gradient(135deg, #1e2c1e, #152015); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                        <div id="score-gauge" style="border-radius: 50%; border: 8px solid ${color}; display: flex; align-items: center; justify-content: center; width: 120px; height: 120px; font-size: 2em; margin: 0 auto;">${score}</div>
                        <h3 style="margin-top: 15px;">Stav Syst√©mu</h3>
                        <p id="system-status-text" style="color: ${color}; font-size: 1.1em; font-weight: bold;">${statusText}</p>
                        <p id="last-repair-text" style="color: var(--color-text-grey); font-size: 0.9em;">Posledn√≠ oprava: Nyn√≠</p>
                        <button id="start-smart-scan-dashboard" class="primary-btn">Spustit Sken</button>
                    </div>
                    <h3 style="margin-top: 20px; font-weight: 500;">P≈ôehled Licence</h3>
                    <div style="background-color: #2a2a3b; padding: 15px; border-radius: 10px;">
                        <p>U≈æivatel: <strong>${currentUser.username}</strong></p>
                        <p>Stav: <span style="color: var(--color-accent-green);">Aktivn√≠ PRO verze</span></p>
                        <p style="margin-top: 10px; font-size: 0.9em;">V≈°echny funkce jsou odemƒçeny a nastaveny na maxim√°ln√≠ ochranu.</p>
                        <button class="secondary-btn" onclick="handleLogout()">Odhl√°sit se</button>
                    </div>
                 `;
             }
             
             // Povolen√≠ skenov√°n√≠ v PRO verzi a p≈ôipojen√≠ handleru pro obƒõ verze (pokud je tlaƒç√≠tko p≈ô√≠tomno)
             const scanBtn = document.getElementById('start-smart-scan-dashboard');
             if (scanBtn) {
                 if (isPro) {
                     scanBtn.disabled = false;
                     scanBtn.addEventListener('click', () => switchModule('scan'));
                 } else {
                     scanBtn.addEventListener('click', () => alert('Upgrade na PRO pro spu≈°tƒõn√≠ skenu!'));
                 }
             }
        };

        const handleLogout = () => {
             currentUser = null;
             localStorage.removeItem(STORAGE_KEY);
             // Reset navigaƒçn√≠ch prvk≈Ø na zamƒçen√©
             navItems.forEach(nav => {
                 nav.classList.add('locked');
                 if (nav.getAttribute('data-module') !== 'dashboard' && nav.getAttribute('data-module') !== 'scan') {
                     nav.querySelector('i').innerHTML = 'üîí';
                 }
             });
             // Vyƒçi≈°tƒõn√≠ dashboardu
             dashboardModule.innerHTML = '';
             // P≈ôechod na p≈ôihla≈°ovac√≠ obrazovku
             switchModule('auth_select');
        };

        const unlockFeaturesUI = (licenseType, message, targetModuleId) => {
            const isPro = licenseType === 'PRO';

            // 1. Zmƒõna stavu navigace
            navItems.forEach(nav => {
                const navModule = nav.getAttribute('data-module');
                nav.classList.remove('locked');
                
                // Odemkneme i Freemium modul (scan, dashboard)
                if (navModule !== 'dashboard' && navModule !== 'scan') {
                    // Odemkneme PRO moduly pouze pro PRO licenci
                    if (isPro) {
                        const icons = { 'cyber_defense': 'üõ°Ô∏è', 'vpn': 'üåê', 'settings': '‚öôÔ∏è', 'identity': 'üïµÔ∏è' };
                        nav.querySelector('i').innerHTML = icons[navModule] || '‚úÖ';
                    } else {
                        nav.classList.add('locked');
                        nav.querySelector('i').innerHTML = 'üîí';
                    }
                }
            });
            
            // 2. Nastaven√≠ Dashboardu
            setDashboardContent(licenseType);

            // 3. Zprovoznƒõn√≠ interaktivn√≠ch prvk≈Ø (jen pokud je PRO)
            if (isPro) {
                makeFunctional(true);
            } else {
                makeFunctional(false); // Pro Freemium jen scan je limitov√°n
            }

            // 4. P≈ôechod na modul
            if (message) alert(message);
            switchModule(targetModuleId);
        };
        
        // --- FUNKCE PRO ZPROVOZNƒöN√ç FUNKCIONALITY (P≈ôid√°ny zde) ---
        // (Zde se definuj√≠ makeFunctional a simulace VPN/Scan/Identity, kter√© jsou stejn√© jako ve V5.1, ale nyn√≠ p≈ôij√≠maj√≠ argument isPro)
        
        let isVpnConnected = false;
        
        const simulateVpnConnection = (vpnToggleBtn) => { /* ... Logika VPN ... */ };
        const simulateIdentityScan = (emailInput, monitorBtn, monitoringResult) => { /* ... Logika Identity ... */ };
        let threatsFound = 0;
        const startScanSimulation = (isRepair = false) => { /* ... Logika Scan ... */ };

        // Aktualizovan√° makeFunctional s podporou Freemium/PRO
        const makeFunctional = (isPro) => {
            
            // Odemƒçen√≠/uzamƒçen√≠ p≈ôep√≠naƒç≈Ø v Cyber Defense
            const cyberContent = document.getElementById('cyber-content');
            if (isPro) {
                cyberContent.innerHTML = ''; // Vyƒçist√≠ "uzamƒçeno" zpr√°vu
                // P≈ôid√°n√≠ funkƒçnosti pro Cyber Defense (Z V4.2/V5.1)
                cyberContent.innerHTML = `
                    <div id="cyber-features-list">
                        </div>
                `;
                // Povolen√≠ p≈ôep√≠naƒç≈Ø
                document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                    toggle.disabled = false;
                    toggle.addEventListener('change', (e) => {
                        const state = e.target.checked ? 'zapnuto' : 'vypnuto';
                        console.log(`Funkce ${e.target.id} je nyn√≠ ${state}`);
                    });
                });
            } else {
                 cyberContent.innerHTML = `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`;
            }
            
            // Ostatn√≠ moduly
            const modulesToUnlock = ['vpn', 'identity', 'settings'];
            modulesToUnlock.forEach(moduleId => {
                const moduleContent = document.getElementById(`${moduleId}-content`);
                if (isPro) {
                    moduleContent.classList.remove('locked');
                    // Zde by byla komplexn√≠ PRO funkƒçnost
                } else {
                    moduleContent.classList.add('locked');
                    moduleContent.innerHTML = `<p style="color: var(--color-danger-red);">Tato funkce je uzamƒçena! K odemƒçen√≠ je nutn√° **PRO licence**.</p>`;
                }
            });

            // Speci√°ln√≠ pravidla pro Sken
            const scanContent = document.getElementById('scan-content');
            if (scanContent) {
                // Sken je v Freemium verzi pouze ƒç√°steƒçnƒõ p≈ô√≠stupn√Ω (jen pro demo), ale pro PRO je plnƒõ funkƒçn√≠
                // Zde ponech√°me logiku pro plnƒõ funkƒçn√≠ sken z V5.1 (aktivn√≠ po PRO)
            }
        };

        // --- INICIALIZACE ---
        
        document.addEventListener('DOMContentLoaded', () => {
            loadState();

            // P≈ôipojen√≠ handler≈Ø pro autentizaci
            document.getElementById('profile-btn').addEventListener('click', () => switchModule('auth_select'));
            document.getElementById('show-login-btn').addEventListener('click', () => switchModule('login'));
            document.getElementById('show-register-btn').addEventListener('click', () => switchModule('register'));
            document.getElementById('register-btn').addEventListener('click', handleRegister);
            document.getElementById('login-btn').addEventListener('click', handleLogin);

            if (currentUser) {
                const licenseType = currentUser.isPaid ? 'PRO' : 'Freemium';
                unlockFeaturesUI(licenseType, null, 'dashboard');
            } else {
                switchModule('auth_select');
            }
        });
    </script>
</body>
</html>
